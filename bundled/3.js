const e=({base:e=``,routes:t=[],...n}={})=>({__proto__:new Proxy({},{get:(n,r,i,a)=>(n,...o)=>t.push([r.toUpperCase(),RegExp(`^${(a=(e+n).replace(/\/+(\/|$)/g,`$1`)).replace(/(\/?\.?):(\w+)\+/g,`($1(?<$2>*))`).replace(/(\/?\.?):(\w+)/g,`($1(?<$2>[^$1/]+?))`).replace(/\./g,`\\.`).replace(/(\/?)\*/g,`($1.*)?`)}/*$`),o,a])&&i}),routes:t,...n,async fetch(e,...n){let r,i,a=new URL(e.url),o=e.query={__proto__:null};for(let[e,t]of a.searchParams)o[e]=o[e]?[].concat(o[e],t):t;for(let[o,s,c,l]of t)if((o==e.method||`ALL`==o)&&(i=a.pathname.match(s))){e.params=i.groups||{},e.route=l;for(let t of c)if(null!=(r=await t(e.proxy??e,...n)))return r}}}),t=({base:e=``,routes:t=[],...n}={})=>({__proto__:new Proxy({},{get:(n,r,i,a)=>(n,...o)=>t.push([r.toUpperCase?.(),RegExp(`^${(a=(e+n).replace(/\/+(\/|$)/g,`$1`)).replace(/(\/?\.?):(\w+)\+/g,`($1(?<$2>*))`).replace(/(\/?\.?):(\w+)/g,`($1(?<$2>[^$1/]+?))`).replace(/\./g,`\\.`).replace(/(\/?)\*/g,`($1.*)?`)}/*$`),o,a])&&i}),routes:t,...n,async fetch(e,...r){let i,a,o=new URL(e.url),s=e.query={__proto__:null};for(let[e,t]of o.searchParams)s[e]=s[e]?[].concat(s[e],t):t;e:try{for(let t of n.before||[])if(null!=(i=await t(e.proxy??e,...r)))break e;t:for(let[n,s,c,l]of t)if((n==e.method||`ALL`==n)&&(a=o.pathname.match(s))){e.params=a.groups||{},e.route=l;for(let t of c)if(null!=(i=await t(e.proxy??e,...r)))break t}}catch(t){if(!n.catch)throw t;i=await n.catch(t,e.proxy??e,...r)}try{for(let t of n.finally||[])i=await t(i,e.proxy??e,...r)??i}catch(t){if(!n.catch)throw t;i=await n.catch(t,e.proxy??e,...r)}return i}}),n=(e=`text/plain; charset=utf-8`,t)=>(n,r={})=>{if(void 0===n||n instanceof Response)return n;const i=new Response(t?.(n)??n,r.url?void 0:r);return i.headers.set(`content-type`,e),i},r=n(`application/json; charset=utf-8`,JSON.stringify),i=e=>({400:`Bad Request`,401:`Unauthorized`,403:`Forbidden`,404:`Not Found`,500:`Internal Server Error`})[e]||`Unknown Error`,a=(e=500,t)=>{if(e instanceof Error){const{message:n,...r}=e;e=e.status||500,t={error:n||i(e),...r}}return t={status:e,...`object`==typeof t?t:{error:t||i(e)}},r(t,{status:e})},o=e=>{e.proxy=new Proxy(e.proxy??e,{get:(t,n)=>t[n]?.bind?.(e)??t[n]??t?.params?.[n]})},s=({format:e=r,missing:n=(()=>a(404)),finally:i=[],before:s=[],...c}={})=>t({before:[o,...s],catch:a,finally:[(e,...t)=>e??n(...t),e,...i],...c});const c=(e,t)=>new Response(null,{...t,status:e}),l=n(`text/plain; charset=utf-8`,String),u=n(`text/html`),d=n(`image/jpeg`),f=n(`image/png`),p=n(`image/webp`),m=async e=>{e.content=e.body?await e.clone().json().catch((()=>e.clone().formData())).catch((()=>e.text())):void 0},h=e=>{e.cookies=(e.headers.get(`Cookie`)||``).split(/;\s*/).map((e=>e.split(/=(.+)/))).reduce(((e,[t,n])=>n?(e[t]=n,e):e),{})},g=(e={})=>{const{origin:t=`*`,credentials:n=!1,allowMethods:r=`*`,allowHeaders:i,exposeHeaders:a,maxAge:o}=e,s=e=>{const r=e?.headers.get(`origin`);return!0===t?r:t instanceof RegExp?t.test(r)?r:void 0:Array.isArray(t)?t.includes(r)?r:void 0:t instanceof Function?t(r):`*`==t&&n?r:t},c=(e,t)=>{for(const[n,r]of Object.entries(t))r&&e.headers.append(n,r);return e};return{corsify:(e,t)=>e?.headers?.get(`access-control-allow-origin`)||101==e.status?e:c(e.clone(),{"access-control-allow-origin":s(t),"access-control-allow-credentials":n}),preflight:e=>{if(`OPTIONS`==e.method){const t=new Response(null,{status:204});return c(t,{"access-control-allow-origin":s(e),"access-control-allow-methods":r?.join?.(`,`)??r,"access-control-expose-headers":a?.join?.(`,`)??a,"access-control-allow-headers":i?.join?.(`,`)??i??e.headers.get(`access-control-request-headers`),"access-control-max-age":o,"access-control-allow-credentials":n})}}}};const _=e=>new Response(e);e().get(`/`,()=>_(`Hi`)).get(`/user/:id`,o,e=>_(e.id)).post(`/body`,async e=>r(e.json())).fetch(new Request(`http://127.0.0.1`));