var e=Object.create;var t=Object.defineProperty;var n=Object.getOwnPropertyDescriptor;var r=Object.getOwnPropertyNames;var i=Object.getPrototypeOf;var a=Object.prototype.hasOwnProperty;var o=(e,t)=>()=>(e&&(t=e(e=0)),t);var s=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var c=(e,n)=>{for(var r in n)t(e,r,{get:n[r],enumerable:true})};var l=(e,i,o,s)=>{if(i&&typeof i===`object`||typeof i===`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++){d=c[l];if(!a.call(e,d)&&d!==o)t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable})}return e};var u=(n,r,a)=>(a=n!=null?e(i(n)):{},l(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:true}):a,n));function d(e){return y(e)&&!f(e)&&!ne(e)&&Symbol.asyncIterator in e}function f(e){return Array.isArray(e)}function p(e){return typeof e===`bigint`}function m(e){return typeof e===`boolean`}function h(e){return e instanceof globalThis.Date}function g(e){return typeof e===`function`}function _(e){return y(e)&&!f(e)&&!ne(e)&&Symbol.iterator in e}function ee(e){return e===null}function v(e){return typeof e===`number`}function y(e){return typeof e===`object`&&e!==null}function te(e){return e instanceof globalThis.RegExp}function b(e){return typeof e===`string`}function x(e){return typeof e===`symbol`}function ne(e){return e instanceof globalThis.Uint8Array}function S(e){return e===void 0}function re(e){return e.map(e=>ce(e))}function ie(e){return new Date(e.getTime())}function ae(e){return new Uint8Array(e)}function oe(e){return new RegExp(e.source,e.flags)}function se(e){const t={};for(const n of Object.getOwnPropertyNames(e))t[n]=ce(e[n]);for(const n of Object.getOwnPropertySymbols(e))t[n]=ce(e[n]);return t}function ce(e){return f(e)?re(e):h(e)?ie(e):ne(e)?ae(e):te(e)?oe(e):y(e)?se(e):e}function C(e){return ce(e)}function le(e,t){return t===void 0?C(e):C({...t,...e})}function ue(e){return O(e)&&globalThis.Symbol.asyncIterator in e}function de(e){return O(e)&&globalThis.Symbol.iterator in e}function w(e){return e instanceof globalThis.Promise}function T(e){return e instanceof Date&&globalThis.Number.isFinite(e.getTime())}function fe(e){return e instanceof globalThis.Map}function pe(e){return e instanceof globalThis.Set}function E(e){return globalThis.ArrayBuffer.isView(e)}function me(e){return e instanceof globalThis.Uint8Array}function D(e,t){return t in e}function O(e){return e!==null&&typeof e===`object`}function k(e){return globalThis.Array.isArray(e)&&!globalThis.ArrayBuffer.isView(e)}function he(e){return e===void 0}function ge(e){return e===null}function _e(e){return typeof e===`boolean`}function A(e){return typeof e===`number`}function ve(e){return globalThis.Number.isInteger(e)}function ye(e){return typeof e===`bigint`}function be(e){return typeof e===`string`}function xe(e){return typeof e===`function`}function Se(e){return typeof e===`symbol`}function Ce(e){return ye(e)||_e(e)||ge(e)||A(e)||be(e)||Se(e)||he(e)}var we;(function(e){e.InstanceMode=`default`;e.ExactOptionalPropertyTypes=false;e.AllowArrayObject=false;e.AllowNaN=false;e.AllowNullVoid=false;function t(t,n){return e.ExactOptionalPropertyTypes?n in t:t[n]!==void 0}e.IsExactOptionalProperty=t;function n(t){const n=O(t);return e.AllowArrayObject?n:n&&!k(t)}e.IsObjectLike=n;function r(e){return n(e)&&!(e instanceof Date)&&!(e instanceof Uint8Array)}e.IsRecordLike=r;function i(t){return e.AllowNaN?A(t):Number.isFinite(t)}e.IsNumberLike=i;function a(t){const n=he(t);return e.AllowNullVoid?n||t===null:n}e.IsVoidLike=a})(we||(we={}));function Te(e){return globalThis.Object.freeze(e).map(e=>Ae(e))}function Ee(e){return e}function De(e){return e}function Oe(e){return e}function ke(e){const t={};for(const n of Object.getOwnPropertyNames(e))t[n]=Ae(e[n]);for(const n of Object.getOwnPropertySymbols(e))t[n]=Ae(e[n]);return globalThis.Object.freeze(t)}function Ae(e){return f(e)?Te(e):h(e)?Ee(e):ne(e)?De(e):te(e)?Oe(e):y(e)?ke(e):e}function j(e,t){const n=t!==void 0?{...t,...e}:e;switch(we.InstanceMode){case`freeze`:return Ae(n);case`clone`:return C(n);default:return n}}var je=class extends Error{constructor(e){super(e)}};const Me=Symbol.for(`TypeBox.Transform`);const Ne=Symbol.for(`TypeBox.Readonly`);const Pe=Symbol.for(`TypeBox.Optional`);const Fe=Symbol.for(`TypeBox.Hint`);const M=Symbol.for(`TypeBox.Kind`);function Ie(e){return y(e)&&e[Ne]===`Readonly`}function Le(e){return y(e)&&e[Pe]===`Optional`}function Re(e){return N(e,`Any`)}function ze(e){return N(e,`Argument`)}function Be(e){return N(e,`Array`)}function Ve(e){return N(e,`AsyncIterator`)}function He(e){return N(e,`BigInt`)}function Ue(e){return N(e,`Boolean`)}function We(e){return N(e,`Computed`)}function Ge(e){return N(e,`Constructor`)}function Ke(e){return N(e,`Date`)}function qe(e){return N(e,`Function`)}function Je(e){return N(e,`Integer`)}function Ye(e){return N(e,`Intersect`)}function Xe(e){return N(e,`Iterator`)}function N(e,t){return y(e)&&M in e&&e[M]===t}function Ze(e){return m(e)||v(e)||b(e)}function Qe(e){return N(e,`Literal`)}function $e(e){return N(e,`MappedKey`)}function et(e){return N(e,`MappedResult`)}function tt(e){return N(e,`Never`)}function nt(e){return N(e,`Not`)}function rt(e){return N(e,`Null`)}function it(e){return N(e,`Number`)}function at(e){return N(e,`Object`)}function ot(e){return N(e,`Promise`)}function st(e){return N(e,`Record`)}function ct(e){return N(e,`Ref`)}function lt(e){return N(e,`RegExp`)}function ut(e){return N(e,`String`)}function dt(e){return N(e,`Symbol`)}function ft(e){return N(e,`TemplateLiteral`)}function pt(e){return N(e,`This`)}function P(e){return y(e)&&Me in e}function mt(e){return N(e,`Tuple`)}function ht(e){return N(e,`Undefined`)}function gt(e){return N(e,`Union`)}function _t(e){return N(e,`Uint8Array`)}function vt(e){return N(e,`Unknown`)}function yt(e){return N(e,`Unsafe`)}function bt(e){return N(e,`Void`)}function xt(e){return y(e)&&M in e&&b(e[M])}function St(e){return Re(e)||ze(e)||Be(e)||Ue(e)||He(e)||Ve(e)||We(e)||Ge(e)||Ke(e)||qe(e)||Je(e)||Ye(e)||Xe(e)||Qe(e)||$e(e)||et(e)||tt(e)||nt(e)||rt(e)||it(e)||at(e)||ot(e)||st(e)||ct(e)||lt(e)||ut(e)||dt(e)||ft(e)||pt(e)||mt(e)||ht(e)||gt(e)||_t(e)||vt(e)||yt(e)||bt(e)||xt(e)}const Ct=[`Argument`,`Any`,`Array`,`AsyncIterator`,`BigInt`,`Boolean`,`Computed`,`Constructor`,`Date`,`Enum`,`Function`,`Integer`,`Intersect`,`Iterator`,`Literal`,`MappedKey`,`MappedResult`,`Not`,`Null`,`Number`,`Object`,`Promise`,`Record`,`Ref`,`RegExp`,`String`,`Symbol`,`TemplateLiteral`,`This`,`Tuple`,`Undefined`,`Union`,`Uint8Array`,`Unknown`,`Void`];function wt(e){try{new RegExp(e);return true}catch{return false}}function Tt(e){if(!b(e))return false;for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);if(n>=7&&n<=13||n===27||n===127)return false}return true}function Et(e){return Ot(e)||z(e)}function Dt(e){return S(e)||p(e)}function F(e){return S(e)||v(e)}function Ot(e){return S(e)||m(e)}function I(e){return S(e)||b(e)}function kt(e){return S(e)||b(e)&&Tt(e)&&wt(e)}function At(e){return S(e)||b(e)&&Tt(e)}function jt(e){return S(e)||z(e)}function Mt(e){return y(e)&&e[Pe]===`Optional`}function Nt(e){return L(e,`Any`)&&I(e.$id)}function Pt(e){return L(e,`Argument`)&&v(e.index)}function Ft(e){return L(e,`Array`)&&e.type===`array`&&I(e.$id)&&z(e.items)&&F(e.minItems)&&F(e.maxItems)&&Ot(e.uniqueItems)&&jt(e.contains)&&F(e.minContains)&&F(e.maxContains)}function It(e){return L(e,`AsyncIterator`)&&e.type===`AsyncIterator`&&I(e.$id)&&z(e.items)}function Lt(e){return L(e,`BigInt`)&&e.type===`bigint`&&I(e.$id)&&Dt(e.exclusiveMaximum)&&Dt(e.exclusiveMinimum)&&Dt(e.maximum)&&Dt(e.minimum)&&Dt(e.multipleOf)}function Rt(e){return L(e,`Boolean`)&&e.type===`boolean`&&I(e.$id)}function zt(e){return L(e,`Computed`)&&b(e.target)&&f(e.parameters)&&e.parameters.every(e=>z(e))}function Bt(e){return L(e,`Constructor`)&&e.type===`Constructor`&&I(e.$id)&&f(e.parameters)&&e.parameters.every(e=>z(e))&&z(e.returns)}function Vt(e){return L(e,`Date`)&&e.type===`Date`&&I(e.$id)&&F(e.exclusiveMaximumTimestamp)&&F(e.exclusiveMinimumTimestamp)&&F(e.maximumTimestamp)&&F(e.minimumTimestamp)&&F(e.multipleOfTimestamp)}function Ht(e){return L(e,`Function`)&&e.type===`Function`&&I(e.$id)&&f(e.parameters)&&e.parameters.every(e=>z(e))&&z(e.returns)}function Ut(e){return L(e,`Integer`)&&e.type===`integer`&&I(e.$id)&&F(e.exclusiveMaximum)&&F(e.exclusiveMinimum)&&F(e.maximum)&&F(e.minimum)&&F(e.multipleOf)}function Wt(e){return y(e)&&Object.entries(e).every(([e,t])=>Tt(e)&&z(t))}function Gt(e){return L(e,`Intersect`)&&(b(e.type)&&e.type!==`object`?false:true)&&f(e.allOf)&&e.allOf.every(e=>z(e)&&!pn(e))&&I(e.type)&&(Ot(e.unevaluatedProperties)||jt(e.unevaluatedProperties))&&I(e.$id)}function Kt(e){return L(e,`Iterator`)&&e.type===`Iterator`&&I(e.$id)&&z(e.items)}function L(e,t){return y(e)&&M in e&&e[M]===t}function qt(e){return Xt(e)&&b(e.const)}function Jt(e){return Xt(e)&&v(e.const)}function Yt(e){return Xt(e)&&m(e.const)}function Xt(e){return L(e,`Literal`)&&I(e.$id)&&Zt(e.const)}function Zt(e){return m(e)||v(e)||b(e)}function Qt(e){return L(e,`MappedKey`)&&f(e.keys)&&e.keys.every(e=>v(e)||b(e))}function $t(e){return L(e,`MappedResult`)&&Wt(e.properties)}function en(e){return L(e,`Never`)&&y(e.not)&&Object.getOwnPropertyNames(e.not).length===0}function tn(e){return L(e,`Not`)&&z(e.not)}function nn(e){return L(e,`Null`)&&e.type===`null`&&I(e.$id)}function rn(e){return L(e,`Number`)&&e.type===`number`&&I(e.$id)&&F(e.exclusiveMaximum)&&F(e.exclusiveMinimum)&&F(e.maximum)&&F(e.minimum)&&F(e.multipleOf)}function R(e){return L(e,`Object`)&&e.type===`object`&&I(e.$id)&&Wt(e.properties)&&Et(e.additionalProperties)&&F(e.minProperties)&&F(e.maxProperties)}function an(e){return L(e,`Promise`)&&e.type===`Promise`&&I(e.$id)&&z(e.item)}function on(e){return L(e,`Record`)&&e.type===`object`&&I(e.$id)&&Et(e.additionalProperties)&&y(e.patternProperties)&&(e=>{const t=Object.getOwnPropertyNames(e.patternProperties);return t.length===1&&wt(t[0])&&y(e.patternProperties)&&z(e.patternProperties[t[0]])})(e)}function sn(e){return L(e,`Ref`)&&I(e.$id)&&b(e.$ref)}function cn(e){return L(e,`RegExp`)&&I(e.$id)&&b(e.source)&&b(e.flags)&&F(e.maxLength)&&F(e.minLength)}function ln(e){return L(e,`String`)&&e.type===`string`&&I(e.$id)&&F(e.minLength)&&F(e.maxLength)&&kt(e.pattern)&&At(e.format)}function un(e){return L(e,`Symbol`)&&e.type===`symbol`&&I(e.$id)}function dn(e){return L(e,`TemplateLiteral`)&&e.type===`string`&&b(e.pattern)&&e.pattern[0]===`^`&&e.pattern[e.pattern.length-1]===`$`}function fn(e){return L(e,`This`)&&I(e.$id)&&b(e.$ref)}function pn(e){return y(e)&&Me in e}function mn(e){return L(e,`Tuple`)&&e.type===`array`&&I(e.$id)&&v(e.minItems)&&v(e.maxItems)&&e.minItems===e.maxItems&&(S(e.items)&&S(e.additionalItems)&&e.minItems===0||f(e.items)&&e.items.every(e=>z(e)))}function hn(e){return L(e,`Undefined`)&&e.type===`undefined`&&I(e.$id)}function gn(e){return L(e,`Union`)&&I(e.$id)&&y(e)&&f(e.anyOf)&&e.anyOf.every(e=>z(e))}function _n(e){return L(e,`Uint8Array`)&&e.type===`Uint8Array`&&I(e.$id)&&F(e.minByteLength)&&F(e.maxByteLength)}function vn(e){return L(e,`Unknown`)&&I(e.$id)}function yn(e){return L(e,`Unsafe`)}function bn(e){return L(e,`Void`)&&e.type===`void`&&I(e.$id)}function xn(e){return y(e)&&M in e&&b(e[M])&&!Ct.includes(e[M])}function z(e){return y(e)&&(Nt(e)||Pt(e)||Ft(e)||Rt(e)||Lt(e)||It(e)||zt(e)||Bt(e)||Vt(e)||Ht(e)||Ut(e)||Gt(e)||Kt(e)||Xt(e)||Qt(e)||$t(e)||en(e)||tn(e)||nn(e)||rn(e)||R(e)||an(e)||on(e)||sn(e)||cn(e)||ln(e)||un(e)||dn(e)||fn(e)||mn(e)||hn(e)||gn(e)||_n(e)||vn(e)||yn(e)||bn(e)||xn(e))}const Sn=`(true|false)`;const Cn=`(0|[1-9][0-9]*)`;const wn=`(.*)`;const Tn=`(?!.*)`;const En=`^${Sn}$`;const Dn=`^${Cn}$`;const On=`^${wn}$`;const kn=`^${Tn}$`;const An=new Map;function jn(e){return An.has(e)}function Mn(e,t){An.set(e,t)}function Nn(e){return An.get(e)}const Pn=new Map;function Fn(e){return Pn.has(e)}function In(e,t){Pn.set(e,t)}function Ln(e){return Pn.get(e)}function Rn(e,t){return e.includes(t)}function zn(e){return[...new Set(e)]}function Bn(e,t){return e.filter(e=>t.includes(e))}function Vn(e,t){return e.reduce((e,t)=>{return Bn(e,t)},t)}function Hn(e){return e.length===1?e[0]:e.length>1?Vn(e.slice(1),e[0]):[]}function Un(e){const t=[];for(const n of e)t.push(...n);return t}function Wn(e){return j({[M]:`Any`},e)}function Gn(e,t){return j({[M]:`Array`,type:`array`,items:e},t)}function Kn(e){return j({[M]:`Argument`,index:e})}function qn(e,t){return j({[M]:`AsyncIterator`,type:`AsyncIterator`,items:e},t)}function Jn(e,t,n){return j({[M]:`Computed`,target:e,parameters:t},n)}function Yn(e,t){const{[t]:n,...r}=e;return r}function Xn(e,t){return t.reduce((e,t)=>Yn(e,t),e)}function Zn(e){return j({[M]:`Never`,not:{}},e)}function Qn(e){return j({[M]:`MappedResult`,properties:e})}function $n(e,t,n){return j({[M]:`Constructor`,type:`Constructor`,parameters:e,returns:t},n)}function er(e,t,n){return j({[M]:`Function`,type:`Function`,parameters:e,returns:t},n)}function tr(e,t){return j({[M]:`Union`,anyOf:e},t)}function nr(e){return e.some(e=>Le(e))}function rr(e){return e.map(e=>Le(e)?ir(e):e)}function ir(e){return Xn(e,[Pe])}function ar(e,t){const n=nr(e);return n?Gi(tr(rr(e),t)):tr(rr(e),t)}function or(e,t){return e.length===1?j(e[0],t):e.length===0?Zn(t):ar(e,t)}function sr(e,t){return e.length===0?Zn(t):e.length===1?j(e[0],t):tr(e,t)}var cr=class extends je{};function lr(e){return e.replace(/\\\$/g,`$`).replace(/\\\*/g,`*`).replace(/\\\^/g,`^`).replace(/\\\|/g,`|`).replace(/\\\(/g,`(`).replace(/\\\)/g,`)`)}function ur(e,t,n){return e[t]===n&&e.charCodeAt(t-1)!==92}function dr(e,t){return ur(e,t,`(`)}function fr(e,t){return ur(e,t,`)`)}function pr(e,t){return ur(e,t,`|`)}function mr(e){if(!(dr(e,0)&&fr(e,e.length-1)))return false;let t=0;for(let n=0;n<e.length;n++){if(dr(e,n))t+=1;if(fr(e,n))t-=1;if(t===0&&n!==e.length-1)return false}return true}function hr(e){return e.slice(1,e.length-1)}function gr(e){let t=0;for(let n=0;n<e.length;n++){if(dr(e,n))t+=1;if(fr(e,n))t-=1;if(pr(e,n)&&t===0)return true}return false}function _r(e){for(let t=0;t<e.length;t++)if(dr(e,t))return true;return false}function vr(e){let[t,n]=[0,0];const r=[];for(let i=0;i<e.length;i++){if(dr(e,i))t+=1;if(fr(e,i))t-=1;if(pr(e,i)&&t===0){const t=e.slice(n,i);if(t.length>0)r.push(br(t));n=i+1}}const i=e.slice(n);if(i.length>0)r.push(br(i));if(r.length===0)return{type:`const`,const:``};if(r.length===1)return r[0];return{type:`or`,expr:r}}function yr(e){function t(e,t){if(!dr(e,t))throw new cr(`TemplateLiteralParser: Index must point to open parens`);let n=0;for(let r=t;r<e.length;r++){if(dr(e,r))n+=1;if(fr(e,r))n-=1;if(n===0)return[t,r]}throw new cr(`TemplateLiteralParser: Unclosed group parens in expression`)}function n(e,t){for(let n=t;n<e.length;n++)if(dr(e,n))return[t,n];return[t,e.length]}const r=[];for(let i=0;i<e.length;i++)if(dr(e,i)){const[n,a]=t(e,i);const o=e.slice(n,a+1);r.push(br(o));i=a}else{const[t,a]=n(e,i);const o=e.slice(t,a);if(o.length>0)r.push(br(o));i=a-1}return r.length===0?{type:`const`,const:``}:r.length===1?r[0]:{type:`and`,expr:r}}function br(e){return mr(e)?br(hr(e)):gr(e)?vr(e):_r(e)?yr(e):{type:`const`,const:lr(e)}}function xr(e){return br(e.slice(1,e.length-1))}var Sr=class extends je{};function Cr(e){return e.type===`or`&&e.expr.length===2&&e.expr[0].type===`const`&&e.expr[0].const===`0`&&e.expr[1].type===`const`&&e.expr[1].const===`[1-9][0-9]*`}function wr(e){return e.type===`or`&&e.expr.length===2&&e.expr[0].type===`const`&&e.expr[0].const===`true`&&e.expr[1].type===`const`&&e.expr[1].const===`false`}function Tr(e){return e.type===`const`&&e.const===`.*`}function Er(e){return Cr(e)||Tr(e)?false:wr(e)?true:e.type===`and`?e.expr.every(e=>Er(e)):e.type===`or`?e.expr.every(e=>Er(e)):e.type===`const`?true:(()=>{throw new Sr(`Unknown expression type`)})()}function Dr(e){const t=xr(e.pattern);return Er(t)}var Or=class extends je{};function*kr(e){if(e.length===1)return yield*e[0];for(const t of e[0])for(const n of kr(e.slice(1)))yield`${t}${n}`}function*Ar(e){return yield*kr(e.expr.map(e=>[...Nr(e)]))}function*jr(e){for(const t of e.expr)yield*Nr(t)}function*Mr(e){return yield e.const}function*Nr(e){return e.type===`and`?yield*Ar(e):e.type===`or`?yield*jr(e):e.type===`const`?yield*Mr(e):(()=>{throw new Or(`Unknown expression`)})()}function Pr(e){const t=xr(e.pattern);return Er(t)?[...Nr(t)]:[]}function Fr(e,t){return j({[M]:`Literal`,const:e,type:typeof e},t)}function Ir(e){return j({[M]:`Boolean`,type:`boolean`},e)}function Lr(e){return j({[M]:`BigInt`,type:`bigint`},e)}function Rr(e){return j({[M]:`Number`,type:`number`},e)}function zr(e){return j({[M]:`String`,type:`string`},e)}function*Br(e){const t=e.trim().replace(/"|'/g,``);return t===`boolean`?yield Ir():t===`number`?yield Rr():t===`bigint`?yield Lr():t===`string`?yield zr():yield(()=>{const e=t.split(`|`).map(e=>Fr(e.trim()));return e.length===0?Zn():e.length===1?e[0]:or(e)})()}function*Vr(e){if(e[1]!==`{`){const t=Fr(`$`);const n=Hr(e.slice(1));return yield*[t,...n]}for(let t=2;t<e.length;t++)if(e[t]===`}`){const n=Br(e.slice(2,t));const r=Hr(e.slice(t+1));return yield*[...n,...r]}yield Fr(e)}function*Hr(e){for(let t=0;t<e.length;t++)if(e[t]===`$`){const n=Fr(e.slice(0,t));const r=Vr(e.slice(t));return yield*[n,...r]}yield Fr(e)}function Ur(e){return[...Hr(e)]}var Wr=class extends je{};function Gr(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}function Kr(e,t){return ft(e)?e.pattern.slice(1,e.pattern.length-1):gt(e)?`(${e.anyOf.map(e=>Kr(e,t)).join(`|`)})`:it(e)?`${t}${Cn}`:Je(e)?`${t}${Cn}`:He(e)?`${t}${Cn}`:ut(e)?`${t}${wn}`:Qe(e)?`${t}${Gr(e.const.toString())}`:Ue(e)?`${t}${Sn}`:(()=>{throw new Wr(`Unexpected Kind '${e[M]}'`)})()}function qr(e){return`^${e.map(e=>Kr(e,``)).join(``)}\$`}function Jr(e){const t=Pr(e);const n=t.map(e=>Fr(e));return or(n)}function Yr(e,t){const n=b(e)?qr(Ur(e)):qr(e);return j({[M]:`TemplateLiteral`,type:`string`,pattern:n},t)}function Xr(e){const t=Pr(e);return t.map(e=>e.toString())}function Zr(e){const t=[];for(const n of e)t.push(...$r(n));return t}function Qr(e){return[e.toString()]}function $r(e){return[...new Set(ft(e)?Xr(e):gt(e)?Zr(e.anyOf):Qe(e)?Qr(e.const):it(e)?[`[number]`]:Je(e)?[`[number]`]:[])]}function ei(e,t,n){const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=mi(e,$r(t[i]),n);return r}function ti(e,t,n){return ei(e,t.properties,n)}function ni(e,t,n){const r=ti(e,t,n);return Qn(r)}function ri(e,t){return e.map(e=>di(e,t))}function ii(e){return e.filter(e=>!tt(e))}function ai(e,t){return ea(ii(ri(e,t)))}function oi(e){return e.some(e=>tt(e))?[]:e}function si(e,t){return or(oi(ri(e,t)))}function ci(e,t){return t in e?e[t]:t===`[number]`?or(e):Zn()}function li(e,t){return t===`[number]`?e:Zn()}function ui(e,t){return t in e?e[t]:Zn()}function di(e,t){return Ye(e)?ai(e.allOf,t):gt(e)?si(e.anyOf,t):mt(e)?ci(e.items??[],t):Be(e)?li(e.items,t):at(e)?ui(e.properties,t):Zn()}function fi(e,t){return t.map(t=>di(e,t))}function pi(e,t){return or(fi(e,t))}function mi(e,t,n){if(ct(e)||ct(t)){const n=`Index types using Ref parameters require both Type and Key to be of TSchema`;if(!St(e)||!St(t))throw new je(n);return Jn(`Index`,[e,t])}if(et(t))return ni(e,t,n);if($e(t))return vi(e,t,n);return j(St(t)?pi(e,$r(t)):pi(e,t),n)}function hi(e,t,n){return{[t]:mi(e,[t],C(n))}}function gi(e,t,n){return t.reduce((t,r)=>{return{...t,...hi(e,r,n)}},{})}function _i(e,t,n){return gi(e,t.keys,n)}function vi(e,t,n){const r=_i(e,t,n);return Qn(r)}function yi(e,t){return j({[M]:`Iterator`,type:`Iterator`,items:e},t)}function bi(e){const t=[];for(let n in e)if(!Le(e[n]))t.push(n);return t}function xi(e,t){const n=bi(e);const r=n.length>0?{[M]:`Object`,type:`object`,properties:e,required:n}:{[M]:`Object`,type:`object`,properties:e};return j(r,t)}var Si=xi;function Ci(e,t){return j({[M]:`Promise`,type:`Promise`,item:e},t)}function wi(e){return j(Xn(e,[Ne]))}function Ti(e){return j({...e,[Ne]:`Readonly`})}function Ei(e,t){return t===false?wi(e):Ti(e)}function Di(e,t){const n=t??true;return et(e)?Ai(e,n):Ei(e,n)}function Oi(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=Di(e[r],t);return n}function ki(e,t){return Oi(e.properties,t)}function Ai(e,t){const n=ki(e,t);return Qn(n)}function ji(e,t){return j(e.length>0?{[M]:`Tuple`,type:`array`,items:e,additionalItems:false,minItems:e.length,maxItems:e.length}:{[M]:`Tuple`,type:`array`,minItems:e.length,maxItems:e.length},t)}function Mi(e,t){return e in t?zi(e,t[e]):Qn(t)}function Ni(e){return{[e]:Fr(e)}}function Pi(e){const t={};for(const n of e)t[n]=Fr(n);return t}function Fi(e,t){return Rn(t,e)?Ni(e):Pi(t)}function Ii(e,t){const n=Fi(e,t);return Mi(e,n)}function Li(e,t){return t.map(t=>zi(e,t))}function Ri(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(t))n[r]=zi(e,t[r]);return n}function zi(e,t){const n={...t};return Le(t)?Gi(zi(e,Xn(t,[Pe]))):Ie(t)?Di(zi(e,Xn(t,[Ne]))):et(t)?Mi(e,t.properties):$e(t)?Ii(e,t.keys):Ge(t)?$n(Li(e,t.parameters),zi(e,t.returns),n):qe(t)?er(Li(e,t.parameters),zi(e,t.returns),n):Ve(t)?qn(zi(e,t.items),n):Xe(t)?yi(zi(e,t.items),n):Ye(t)?ta(Li(e,t.allOf),n):gt(t)?sr(Li(e,t.anyOf),n):mt(t)?ji(Li(e,t.items??[]),n):at(t)?Si(Ri(e,t.properties),n):Be(t)?Gn(zi(e,t.items),n):ot(t)?Ci(zi(e,t.item),n):t}function Bi(e,t){const n={};for(const r of e)n[r]=zi(r,t);return n}function Vi(e,t,n){const r=St(e)?$r(e):e;const i=t({[M]:`MappedKey`,keys:r});const a=Bi(r,i);return Si(a,n)}function Hi(e){return j(Xn(e,[Pe]))}function Ui(e){return j({...e,[Pe]:`Optional`})}function Wi(e,t){return t===false?Hi(e):Ui(e)}function Gi(e,t){const n=t??true;return et(e)?Ji(e,n):Wi(e,n)}function Ki(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=Gi(e[r],t);return n}function qi(e,t){return Ki(e.properties,t)}function Ji(e,t){const n=qi(e,t);return Qn(n)}function Yi(e,t={}){const n=e.every(e=>at(e));const r=St(t.unevaluatedProperties)?{unevaluatedProperties:t.unevaluatedProperties}:{};return j(t.unevaluatedProperties===false||St(t.unevaluatedProperties)||n?{...r,[M]:`Intersect`,type:`object`,allOf:e}:{...r,[M]:`Intersect`,allOf:e},t)}function Xi(e){return e.every(e=>Le(e))}function Zi(e){return Xn(e,[Pe])}function Qi(e){return e.map(e=>Le(e)?Zi(e):e)}function $i(e,t){return Xi(e)?Gi(Yi(Qi(e),t)):Yi(Qi(e),t)}function ea(e,t={}){if(e.length===1)return j(e[0],t);if(e.length===0)return Zn(t);if(e.some(e=>P(e)))throw new Error(`Cannot intersect transform types`);return $i(e,t)}function ta(e,t){if(e.length===1)return j(e[0],t);if(e.length===0)return Zn(t);if(e.some(e=>P(e)))throw new Error(`Cannot intersect transform types`);return Yi(e,t)}function na(...e){const[t,n]=typeof e[0]===`string`?[e[0],e[1]]:[e[0].$id,e[1]];if(typeof t!==`string`)throw new je(`Ref: $ref must be a string`);return j({[M]:`Ref`,$ref:t},n)}function ra(e,t){return Jn(`Awaited`,[Jn(e,t)])}function ia(e){return Jn(`Awaited`,[na(e)])}function aa(e){return ta(ca(e))}function oa(e){return sr(ca(e))}function sa(e){return la(e)}function ca(e){return e.map(e=>la(e))}function la(e,t){return j(We(e)?ra(e.target,e.parameters):Ye(e)?aa(e.allOf):gt(e)?oa(e.anyOf):ot(e)?sa(e.item):ct(e)?ia(e.$ref):e,t)}function ua(e){const t=[];for(const n of e)t.push(_a(n));return t}function da(e){const t=ua(e);const n=Un(t);return n}function fa(e){const t=ua(e);const n=Hn(t);return n}function pa(e){return e.map((e,t)=>t.toString())}function ma(e){return[`[number]`]}function ha(e){return globalThis.Object.getOwnPropertyNames(e)}function ga(e){if(!va)return[];const t=globalThis.Object.getOwnPropertyNames(e);return t.map(e=>{return e[0]===`^`&&e[e.length-1]===`$`?e.slice(1,e.length-1):e})}function _a(e){return Ye(e)?da(e.allOf):gt(e)?fa(e.anyOf):mt(e)?pa(e.items??[]):Be(e)?ma(e.items):at(e)?ha(e.properties):st(e)?ga(e.patternProperties):[]}let va=false;function ya(e){va=true;const t=_a(e);va=false;const n=t.map(e=>`(${e})`);return`^(${n.join(`|`)})$`}function ba(e,t){return Jn(`KeyOf`,[Jn(e,t)])}function xa(e){return Jn(`KeyOf`,[na(e)])}function Sa(e,t){const n=_a(e);const r=Ca(n);const i=or(r);return j(i,t)}function Ca(e){return e.map(e=>e===`[number]`?Rr():Fr(e))}function wa(e,t){return We(e)?ba(e.target,e.parameters):ct(e)?xa(e.$ref):et(e)?Da(e,t):Sa(e,t)}function Ta(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=wa(e[r],C(t));return n}function Ea(e,t){return Ta(e.properties,t)}function Da(e,t){const n=Ea(e,t);return Qn(n)}function Oa(e){const t=_a(e);const n=fi(e,t);return t.map((e,r)=>[t[r],n[r]])}function ka(e){const t=[];for(const n of e)t.push(..._a(n));return zn(t)}function Aa(e){return e.filter(e=>!tt(e))}function ja(e,t){const n=[];for(const r of e)n.push(...fi(r,[t]));return Aa(n)}function Ma(e,t){const n={};for(const r of t)n[r]=ea(ja(e,r));return n}function Na(e,t){const n=ka(e);const r=Ma(e,n);const i=Si(r,t);return i}function Pa(e){return j({[M]:`Date`,type:`Date`},e)}function Fa(e){return j({[M]:`Null`,type:`null`},e)}function Ia(e){return j({[M]:`Symbol`,type:`symbol`},e)}function La(e){return j({[M]:`Undefined`,type:`undefined`},e)}function Ra(e){return j({[M]:`Uint8Array`,type:`Uint8Array`},e)}function za(e){return j({[M]:`Unknown`},e)}function Ba(e){return e.map(e=>Ua(e,false))}function Va(e){const t={};for(const n of globalThis.Object.getOwnPropertyNames(e))t[n]=Di(Ua(e[n],false));return t}function Ha(e,t){return t===true?e:Di(e)}function Ua(e,t){return d(e)?Ha(Wn(),t):_(e)?Ha(Wn(),t):f(e)?Di(ji(Ba(e))):ne(e)?Ra():h(e)?Pa():y(e)?Ha(Si(Va(e)),t):g(e)?Ha(er([],za()),t):S(e)?La():ee(e)?Fa():x(e)?Ia():p(e)?Lr():v(e)?Fr(e):m(e)?Fr(e):b(e)?Fr(e):Si({})}function Wa(e,t){return j(Ua(e,true),t)}function Ga(e,t){return Ge(e)?ji(e.parameters,t):Zn(t)}function Ka(e,t){if(S(e))throw new Error(`Enum undefined or empty`);const n=globalThis.Object.getOwnPropertyNames(e).filter(e=>isNaN(e)).map(t=>e[t]);const r=[...new Set(n)];const i=r.map(e=>Fr(e));return sr(i,{...t,[Fe]:`Enum`})}var qa=class extends je{};var B;(function(e){e[e[`Union`]=0]=`Union`;e[e[`True`]=1]=`True`;e[e[`False`]=2]=`False`})(B||(B={}));function Ja(e){return e===B.False?e:B.True}function Ya(e){throw new qa(e)}function Xa(e){return en(e)||Gt(e)||gn(e)||vn(e)||Nt(e)}function Za(e,t){return en(t)?go(e,t):Gt(t)?fo(e,t):gn(t)?$o(e,t):vn(t)?ts(e,t):Nt(t)?Qa(e,t):Ya(`StructuralRight`)}function Qa(e,t){return B.True}function $a(e,t){return Gt(t)?fo(e,t):gn(t)&&t.anyOf.some(e=>Nt(e)||vn(e))?B.True:gn(t)?B.Union:vn(t)?B.True:Nt(t)?B.True:B.Union}function eo(e,t){return vn(e)?B.False:Nt(e)?B.Union:en(e)?B.True:B.False}function to(e,t){return R(t)&&No(t)?B.True:Xa(t)?Za(e,t):!Ft(t)?B.False:Ja(V(e.items,t.items))}function no(e,t){return Xa(t)?Za(e,t):!It(t)?B.False:Ja(V(e.items,t.items))}function ro(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):Lt(t)?B.True:B.False}function io(e,t){return Yt(e)?B.True:Rt(e)?B.True:B.False}function ao(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):Rt(t)?B.True:B.False}function oo(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):!Bt(t)?B.False:e.parameters.length>t.parameters.length?B.False:!e.parameters.every((e,n)=>Ja(V(t.parameters[n],e))===B.True)?B.False:Ja(V(e.returns,t.returns))}function so(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):Vt(t)?B.True:B.False}function co(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):!Ht(t)?B.False:e.parameters.length>t.parameters.length?B.False:!e.parameters.every((e,n)=>Ja(V(t.parameters[n],e))===B.True)?B.False:Ja(V(e.returns,t.returns))}function lo(e,t){return Xt(e)&&v(e.const)?B.True:rn(e)||Ut(e)?B.True:B.False}function uo(e,t){return Ut(t)||rn(t)?B.True:Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):B.False}function fo(e,t){return t.allOf.every(t=>V(e,t)===B.True)?B.True:B.False}function po(e,t){return e.allOf.some(e=>V(e,t)===B.True)?B.True:B.False}function mo(e,t){return Xa(t)?Za(e,t):!Kt(t)?B.False:Ja(V(e.items,t.items))}function ho(e,t){return Xt(t)&&t.const===e.const?B.True:Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):ln(t)?Wo(e,t):rn(t)?xo(e,t):Ut(t)?lo(e,t):Rt(t)?io(e,t):B.False}function go(e,t){return B.False}function _o(e,t){return B.True}function vo(e){let[t,n]=[e,0];while(true){if(!tn(t))break;t=t.not;n+=1}return n%2===0?t:za()}function yo(e,t){return tn(e)?V(vo(e),t):tn(t)?V(e,vo(t)):Ya(`Invalid fallthrough for Not`)}function bo(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):nn(t)?B.True:B.False}function xo(e,t){return Jt(e)?B.True:rn(e)||Ut(e)?B.True:B.False}function So(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):Ut(t)||rn(t)?B.True:B.False}function Co(e,t){return Object.getOwnPropertyNames(e.properties).length===t}function wo(e){return No(e)}function To(e){return Co(e,0)||Co(e,1)&&`description`in e.properties&&gn(e.properties.description)&&e.properties.description.anyOf.length===2&&(ln(e.properties.description.anyOf[0])&&hn(e.properties.description.anyOf[1])||ln(e.properties.description.anyOf[1])&&hn(e.properties.description.anyOf[0]))}function Eo(e){return Co(e,0)}function Do(e){return Co(e,0)}function Oo(e){return Co(e,0)}function ko(e){return Co(e,0)}function Ao(e){return No(e)}function jo(e){const t=Rr();return Co(e,0)||Co(e,1)&&`length`in e.properties&&Ja(V(e.properties[`length`],t))===B.True}function Mo(e){return Co(e,0)}function No(e){const t=Rr();return Co(e,0)||Co(e,1)&&`length`in e.properties&&Ja(V(e.properties[`length`],t))===B.True}function Po(e){const t=er([Wn()],Wn());return Co(e,0)||Co(e,1)&&`then`in e.properties&&Ja(V(e.properties[`then`],t))===B.True}function Fo(e,t){return V(e,t)===B.False?B.False:Mt(e)&&!Mt(t)?B.False:B.True}function Io(e,t){return vn(e)?B.False:Nt(e)?B.Union:en(e)||qt(e)&&wo(t)||Jt(e)&&Eo(t)||Yt(e)&&Do(t)||un(e)&&To(t)||Lt(e)&&Oo(t)||ln(e)&&wo(t)||un(e)&&To(t)||rn(e)&&Eo(t)||Ut(e)&&Eo(t)||Rt(e)&&Do(t)||_n(e)&&Ao(t)||Vt(e)&&ko(t)||Bt(e)&&Mo(t)||Ht(e)&&jo(t)?B.True:on(e)&&ln(zo(e))?(()=>{return t[Fe]===`Record`?B.True:B.False})():on(e)&&rn(zo(e))?(()=>{return Co(t,0)?B.True:B.False})():B.False}function Lo(e,t){return Xa(t)?Za(e,t):on(t)?Vo(e,t):!R(t)?B.False:(()=>{for(const n of Object.getOwnPropertyNames(t.properties)){if(!(n in e.properties)&&!Mt(t.properties[n]))return B.False;if(Mt(t.properties[n]))return B.True;if(Fo(e.properties[n],t.properties[n])===B.False)return B.False}return B.True})()}function Ro(e,t){return Xa(t)?Za(e,t):R(t)&&Po(t)?B.True:!an(t)?B.False:Ja(V(e.item,t.item))}function zo(e){return Dn in e.patternProperties?Rr():On in e.patternProperties?zr():Ya(`Unknown record key pattern`)}function Bo(e){return Dn in e.patternProperties?e.patternProperties[Dn]:On in e.patternProperties?e.patternProperties[On]:Ya(`Unable to get record value schema`)}function Vo(e,t){const[n,r]=[zo(t),Bo(t)];return qt(e)&&rn(n)&&Ja(V(e,r))===B.True?B.True:_n(e)&&rn(n)?V(e,r):ln(e)&&rn(n)?V(e,r):Ft(e)&&rn(n)?V(e,r):R(e)?(()=>{for(const t of Object.getOwnPropertyNames(e.properties))if(Fo(r,e.properties[t])===B.False)return B.False;return B.True})():B.False}function Ho(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):!on(t)?B.False:V(Bo(e),Bo(t))}function Uo(e,t){const n=cn(e)?zr():e;const r=cn(t)?zr():t;return V(n,r)}function Wo(e,t){return Xt(e)&&b(e.const)?B.True:ln(e)?B.True:B.False}function Go(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):ln(t)?B.True:B.False}function Ko(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):un(t)?B.True:B.False}function qo(e,t){return dn(e)?V(Jr(e),t):dn(t)?V(e,Jr(t)):Ya(`Invalid fallthrough for TemplateLiteral`)}function Jo(e,t){return Ft(t)&&e.items!==void 0&&e.items.every(e=>V(e,t.items)===B.True)}function Yo(e,t){return en(e)?B.True:vn(e)?B.False:Nt(e)?B.Union:B.False}function Xo(e,t){return Xa(t)?Za(e,t):R(t)&&No(t)?B.True:Ft(t)&&Jo(e,t)?B.True:!mn(t)?B.False:S(e.items)&&!S(t.items)||!S(e.items)&&S(t.items)?B.False:S(e.items)&&!S(t.items)?B.True:e.items.every((e,n)=>V(e,t.items[n])===B.True)?B.True:B.False}function Zo(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):_n(t)?B.True:B.False}function Qo(e,t){return Xa(t)?Za(e,t):R(t)?Io(e,t):on(t)?Vo(e,t):bn(t)?rs(e,t):hn(t)?B.True:B.False}function $o(e,t){return t.anyOf.some(t=>V(e,t)===B.True)?B.True:B.False}function es(e,t){return e.anyOf.every(e=>V(e,t)===B.True)?B.True:B.False}function ts(e,t){return B.True}function ns(e,t){return en(t)?go(e,t):Gt(t)?fo(e,t):gn(t)?$o(e,t):Nt(t)?Qa(e,t):ln(t)?Wo(e,t):rn(t)?xo(e,t):Ut(t)?lo(e,t):Rt(t)?io(e,t):Ft(t)?eo(e,t):mn(t)?Yo(e,t):R(t)?Io(e,t):vn(t)?B.True:B.False}function rs(e,t){return hn(e)?B.True:hn(e)?B.True:B.False}function os(e,t){return Gt(t)?fo(e,t):gn(t)?$o(e,t):vn(t)?ts(e,t):Nt(t)?Qa(e,t):R(t)?Io(e,t):bn(t)?B.True:B.False}function V(e,t){return dn(e)||dn(t)?qo(e,t):cn(e)||cn(t)?Uo(e,t):tn(e)||tn(t)?yo(e,t):Nt(e)?$a(e,t):Ft(e)?to(e,t):Lt(e)?ro(e,t):Rt(e)?ao(e,t):It(e)?no(e,t):Bt(e)?oo(e,t):Vt(e)?so(e,t):Ht(e)?co(e,t):Ut(e)?uo(e,t):Gt(e)?po(e,t):Kt(e)?mo(e,t):Xt(e)?ho(e,t):en(e)?_o(e,t):nn(e)?bo(e,t):rn(e)?So(e,t):R(e)?Lo(e,t):on(e)?Ho(e,t):ln(e)?Go(e,t):un(e)?Ko(e,t):mn(e)?Xo(e,t):an(e)?Ro(e,t):_n(e)?Zo(e,t):hn(e)?Qo(e,t):gn(e)?es(e,t):vn(e)?ns(e,t):bn(e)?os(e,t):Ya(`Unknown left type operand '${e[M]}'`)}function ss(e,t){return V(e,t)}function cs(e,t,n,r,i){const a={};for(const o of globalThis.Object.getOwnPropertyNames(e))a[o]=fs(e[o],t,n,r,C(i));return a}function ls(e,t,n,r,i){return cs(e.properties,t,n,r,i)}function us(e,t,n,r,i){const a=ls(e,t,n,r,i);return Qn(a)}function ds(e,t,n,r){const i=ss(e,t);return i===B.Union?sr([n,r]):i===B.True?n:r}function fs(e,t,n,r,i){return et(e)?us(e,t,n,r,i):$e(e)?j(gs(e,t,n,r,i)):j(ds(e,t,n,r),i)}function ps(e,t,n,r,i){return{[e]:fs(Fr(e),t,n,r,C(i))}}function ms(e,t,n,r,i){return e.reduce((e,a)=>{return{...e,...ps(a,t,n,r,i)}},{})}function hs(e,t,n,r,i){return ms(e.keys,t,n,r,i)}function gs(e,t,n,r,i){const a=hs(e,t,n,r,i);return Qn(a)}function _s(e){return e.allOf.every(e=>bs(e))}function vs(e){return e.anyOf.some(e=>bs(e))}function ys(e){return!bs(e.not)}function bs(e){return e[M]===`Intersect`?_s(e):e[M]===`Union`?vs(e):e[M]===`Not`?ys(e):e[M]===`Undefined`?true:false}function xs(e,t){return Cs(Jr(e),t)}function Ss(e,t){const n=e.filter(e=>ss(e,t)===B.False);return n.length===1?n[0]:sr(n)}function Cs(e,t,n={}){if(ft(e))return j(xs(e,t),n);if(et(e))return j(Es(e,t),n);return j(gt(e)?Ss(e.anyOf,t):ss(e,t)!==B.False?Zn():e,n)}function ws(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=Cs(e[r],t);return n}function Ts(e,t){return ws(e.properties,t)}function Es(e,t){const n=Ts(e,t);return Qn(n)}function Ds(e,t){return ks(Jr(e),t)}function Os(e,t){const n=e.filter(e=>ss(e,t)!==B.False);return n.length===1?n[0]:sr(n)}function ks(e,t,n){if(ft(e))return j(Ds(e,t),n);if(et(e))return j(Ms(e,t),n);return j(gt(e)?Os(e.anyOf,t):ss(e,t)!==B.False?e:Zn(),n)}function As(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=ks(e[r],t);return n}function js(e,t){return As(e.properties,t)}function Ms(e,t){const n=js(e,t);return Qn(n)}function Ns(e,t){return Ge(e)?j(e.returns,t):Zn(t)}function Ps(e){return Di(Gi(e))}function Fs(e,t,n){return j({[M]:`Record`,type:`object`,patternProperties:{[e]:t}},n)}function Is(e,t,n){const r={};for(const n of e)r[n]=t;return Si(r,{...n,[Fe]:`Record`})}function Ls(e,t,n){return Dr(e)?Is($r(e),t,n):Fs(e.pattern,t,n)}function Rs(e,t,n){return Is($r(sr(e)),t,n)}function zs(e,t,n){return Is([e.toString()],t,n)}function Bs(e,t,n){return Fs(e.source,t,n)}function Vs(e,t,n){const r=S(e.pattern)?On:e.pattern;return Fs(r,t,n)}function Hs(e,t,n){return Fs(On,t,n)}function Us(e,t,n){return Fs(kn,t,n)}function Ws(e,t,n){return Si({true:t,false:t},n)}function Gs(e,t,n){return Fs(Dn,t,n)}function Ks(e,t,n){return Fs(Dn,t,n)}function qs(e,t,n={}){return gt(e)?Rs(e.anyOf,t,n):ft(e)?Ls(e,t,n):Qe(e)?zs(e.const,t,n):Ue(e)?Ws(e,t,n):Je(e)?Gs(e,t,n):it(e)?Ks(e,t,n):lt(e)?Bs(e,t,n):ut(e)?Vs(e,t,n):Re(e)?Hs(e,t,n):tt(e)?Us(e,t,n):Zn(n)}function Js(e){return globalThis.Object.getOwnPropertyNames(e.patternProperties)[0]}function Ys(e){const t=Js(e);return t===On?zr():t===Dn?Rr():zr({pattern:t})}function Xs(e){return e.patternProperties[Js(e)]}function Zs(e,t){t.parameters=dc(e,t.parameters);t.returns=fc(e,t.returns);return t}function Qs(e,t){t.parameters=dc(e,t.parameters);t.returns=fc(e,t.returns);return t}function $s(e,t){t.allOf=dc(e,t.allOf);return t}function ec(e,t){t.anyOf=dc(e,t.anyOf);return t}function tc(e,t){if(S(t.items))return t;t.items=dc(e,t.items);return t}function nc(e,t){t.items=fc(e,t.items);return t}function rc(e,t){t.items=fc(e,t.items);return t}function ic(e,t){t.items=fc(e,t.items);return t}function ac(e,t){t.item=fc(e,t.item);return t}function oc(e,t){const n=uc(e,t.properties);return{...t,...Si(n)}}function sc(e,t){const n=fc(e,Ys(t));const r=fc(e,Xs(t));const i=qs(n,r);return{...t,...i}}function cc(e,t){return t.index in e?e[t.index]:za()}function lc(e,t){const n=Ie(t);const r=Le(t);const i=fc(e,t);return n&&r?Ps(i):n&&!r?Di(i):!n&&r?Gi(i):i}function uc(e,t){return globalThis.Object.getOwnPropertyNames(t).reduce((n,r)=>{return{...n,[r]:lc(e,t[r])}},{})}function dc(e,t){return t.map(t=>fc(e,t))}function fc(e,t){return Ge(t)?Zs(e,t):qe(t)?Qs(e,t):Ye(t)?$s(e,t):gt(t)?ec(e,t):mt(t)?tc(e,t):Be(t)?nc(e,t):Ve(t)?rc(e,t):Xe(t)?ic(e,t):ot(t)?ac(e,t):at(t)?oc(e,t):st(t)?sc(e,t):ze(t)?cc(e,t):t}function pc(e,t){return fc(t,le(e))}function mc(e){return j({[M]:`Integer`,type:`integer`},e)}function hc(e,t,n){return{[e]:Ec(Fr(e),t,C(n))}}function gc(e,t,n){const r=e.reduce((e,r)=>{return{...e,...hc(r,t,n)}},{});return r}function _c(e,t,n){return gc(e[`keys`],t,n)}function vc(e,t,n){const r=_c(e,t,n);return Qn(r)}function yc(e){const[t,n]=[e.slice(0,1),e.slice(1)];return[t.toLowerCase(),n].join(``)}function bc(e){const[t,n]=[e.slice(0,1),e.slice(1)];return[t.toUpperCase(),n].join(``)}function xc(e){return e.toUpperCase()}function Sc(e){return e.toLowerCase()}function Cc(e,t,n){const r=xr(e.pattern);const i=Er(r);if(!i)return{...e,pattern:wc(e.pattern,t)};const a=[...Nr(r)];const o=a.map(e=>Fr(e));const s=Tc(o,t);const c=sr(s);return Yr([c],n)}function wc(e,t){return typeof e===`string`?t===`Uncapitalize`?yc(e):t===`Capitalize`?bc(e):t===`Uppercase`?xc(e):t===`Lowercase`?Sc(e):e:e.toString()}function Tc(e,t){return e.map(e=>Ec(e,t))}function Ec(e,t,n={}){return $e(e)?vc(e,t,n):ft(e)?Cc(e,t,n):gt(e)?sr(Tc(e.anyOf,t),n):Qe(e)?Fr(wc(e.const,t),n):j(e,n)}function Dc(e,t={}){return Ec(e,`Capitalize`,t)}function Oc(e,t={}){return Ec(e,`Lowercase`,t)}function kc(e,t={}){return Ec(e,`Uncapitalize`,t)}function Ac(e,t={}){return Ec(e,`Uppercase`,t)}function jc(e,t,n){const r={};for(const i of globalThis.Object.getOwnPropertyNames(e))r[i]=Vc(e[i],t,C(n));return r}function Mc(e,t,n){return jc(e.properties,t,n)}function Nc(e,t,n){const r=Mc(e,t,n);return Qn(r)}function Pc(e,t){return e.map(e=>Bc(e,t))}function Fc(e,t){return e.map(e=>Bc(e,t))}function Ic(e,t){const{[t]:n,...r}=e;return r}function Lc(e,t){return t.reduce((e,t)=>Ic(e,t),e)}function Rc(e,t){const n=Xn(e,[Me,`$id`,`required`,`properties`]);const r=Lc(e[`properties`],t);return Si(r,n)}function zc(e){const t=e.reduce((e,t)=>Ze(t)?[...e,Fr(t)]:e,[]);return sr(t)}function Bc(e,t){return Ye(e)?ta(Pc(e.allOf,t)):gt(e)?sr(Fc(e.anyOf,t)):at(e)?Rc(e,t):Si({})}function Vc(e,t,n){const r=f(t)?zc(t):t;const i=St(t)?$r(t):t;const a=ct(e);const o=ct(t);return et(e)?Nc(e,i,n):$e(t)?Gc(e,t,n):a&&o?Jn(`Omit`,[e,r],n):!a&&o?Jn(`Omit`,[e,r],n):a&&!o?Jn(`Omit`,[e,r],n):j({...Bc(e,i),...n})}function Hc(e,t,n){return{[t]:Vc(e,[t],C(n))}}function Uc(e,t,n){return t.reduce((t,r)=>{return{...t,...Hc(e,r,n)}},{})}function Wc(e,t,n){return Uc(e,t.keys,n)}function Gc(e,t,n){const r=Wc(e,t,n);return Qn(r)}function Kc(e,t,n){const r={};for(const i of globalThis.Object.getOwnPropertyNames(e))r[i]=tl(e[i],t,C(n));return r}function qc(e,t,n){return Kc(e.properties,t,n)}function Jc(e,t,n){const r=qc(e,t,n);return Qn(r)}function Yc(e,t){return e.map(e=>el(e,t))}function Xc(e,t){return e.map(e=>el(e,t))}function Zc(e,t){const n={};for(const r of t)if(r in e)n[r]=e[r];return n}function Qc(e,t){const n=Xn(e,[Me,`$id`,`required`,`properties`]);const r=Zc(e[`properties`],t);return Si(r,n)}function $c(e){const t=e.reduce((e,t)=>Ze(t)?[...e,Fr(t)]:e,[]);return sr(t)}function el(e,t){return Ye(e)?ta(Yc(e.allOf,t)):gt(e)?sr(Xc(e.anyOf,t)):at(e)?Qc(e,t):Si({})}function tl(e,t,n){const r=f(t)?$c(t):t;const i=St(t)?$r(t):t;const a=ct(e);const o=ct(t);return et(e)?Jc(e,i,n):$e(t)?al(e,t,n):a&&o?Jn(`Pick`,[e,r],n):!a&&o?Jn(`Pick`,[e,r],n):a&&!o?Jn(`Pick`,[e,r],n):j({...el(e,i),...n})}function nl(e,t,n){return{[t]:tl(e,[t],C(n))}}function rl(e,t,n){return t.reduce((t,r)=>{return{...t,...nl(e,r,n)}},{})}function il(e,t,n){return rl(e,t.keys,n)}function al(e,t,n){const r=il(e,t,n);return Qn(r)}function ol(e,t){return Jn(`Partial`,[Jn(e,t)])}function sl(e){return Jn(`Partial`,[na(e)])}function cl(e){const t={};for(const n of globalThis.Object.getOwnPropertyNames(e))t[n]=Gi(e[n]);return t}function ll(e){const t=Xn(e,[Me,`$id`,`required`,`properties`]);const n=cl(e[`properties`]);return Si(n,t)}function ul(e){return e.map(e=>dl(e))}function dl(e){return We(e)?ol(e.target,e.parameters):ct(e)?sl(e.$ref):Ye(e)?ta(ul(e.allOf)):gt(e)?sr(ul(e.anyOf)):at(e)?ll(e):He(e)?e:Ue(e)?e:Je(e)?e:Qe(e)?e:rt(e)?e:it(e)?e:ut(e)?e:dt(e)?e:ht(e)?e:Si({})}function fl(e,t){if(et(e))return hl(e,t);else return j({...dl(e),...t})}function pl(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=fl(e[r],C(t));return n}function ml(e,t){return pl(e.properties,t)}function hl(e,t){const n=ml(e,t);return Qn(n)}function gl(e,t){return Jn(`Required`,[Jn(e,t)])}function _l(e){return Jn(`Required`,[na(e)])}function vl(e){const t={};for(const n of globalThis.Object.getOwnPropertyNames(e))t[n]=Xn(e[n],[Pe]);return t}function yl(e){const t=Xn(e,[Me,`$id`,`required`,`properties`]);const n=vl(e[`properties`]);return Si(n,t)}function bl(e){return e.map(e=>xl(e))}function xl(e){return We(e)?gl(e.target,e.parameters):ct(e)?_l(e.$ref):Ye(e)?ta(bl(e.allOf)):gt(e)?sr(bl(e.anyOf)):at(e)?yl(e):He(e)?e:Ue(e)?e:Je(e)?e:Qe(e)?e:rt(e)?e:it(e)?e:ut(e)?e:dt(e)?e:ht(e)?e:Si({})}function Sl(e,t){if(et(e))return Tl(e,t);else return j({...xl(e),...t})}function Cl(e,t){const n={};for(const r of globalThis.Object.getOwnPropertyNames(e))n[r]=Sl(e[r],t);return n}function wl(e,t){return Cl(e.properties,t)}function Tl(e,t){const n=wl(e,t);return Qn(n)}function El(e,t){return t.map(t=>{return ct(t)?Dl(e,t.$ref):Jl(e,t)})}function Dl(e,t){return t in e?ct(e[t])?Dl(e,e[t].$ref):Jl(e,e[t]):Zn()}function Ol(e){return la(e[0])}function kl(e){return mi(e[0],e[1])}function Al(e){return wa(e[0])}function jl(e){return fl(e[0])}function Ml(e){return Vc(e[0],e[1])}function Nl(e){return tl(e[0],e[1])}function Pl(e){return Sl(e[0])}function Fl(e,t,n){const r=El(e,n);return t===`Awaited`?Ol(r):t===`Index`?kl(r):t===`KeyOf`?Al(r):t===`Partial`?jl(r):t===`Omit`?Ml(r):t===`Pick`?Nl(r):t===`Required`?Pl(r):Zn()}function Il(e,t){return Gn(Jl(e,t))}function Ll(e,t){return qn(Jl(e,t))}function Rl(e,t,n){return $n(ql(e,t),Jl(e,n))}function zl(e,t,n){return er(ql(e,t),Jl(e,n))}function Bl(e,t){return ta(ql(e,t))}function Vl(e,t){return yi(Jl(e,t))}function Hl(e,t){return Si(globalThis.Object.keys(t).reduce((n,r)=>{return{...n,[r]:Jl(e,t[r])}},{}))}function Ul(e,t){const[n,r]=[Jl(e,Xs(t)),Js(t)];const i=le(t);i.patternProperties[r]=n;return i}function Wl(e,t){return ct(t)?{...Dl(e,t.$ref),[Me]:t[Me]}:t}function Gl(e,t){return ji(ql(e,t))}function Kl(e,t){return sr(ql(e,t))}function ql(e,t){return t.map(t=>Jl(e,t))}function Jl(e,t){return Le(t)?j(Jl(e,Xn(t,[Pe])),t):Ie(t)?j(Jl(e,Xn(t,[Ne])),t):P(t)?j(Wl(e,t),t):Be(t)?j(Il(e,t.items),t):Ve(t)?j(Ll(e,t.items),t):We(t)?j(Fl(e,t.target,t.parameters)):Ge(t)?j(Rl(e,t.parameters,t.returns),t):qe(t)?j(zl(e,t.parameters,t.returns),t):Ye(t)?j(Bl(e,t.allOf),t):Xe(t)?j(Vl(e,t.items),t):at(t)?j(Hl(e,t.properties),t):st(t)?j(Ul(e,t)):mt(t)?j(Gl(e,t.items||[]),t):gt(t)?j(Kl(e,t.anyOf),t):t}function Yl(e,t){return t in e?Jl(e,e[t]):Zn()}function Xl(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,n)=>{return{...t,[n]:Yl(e,n)}},{})}var Zl=class{constructor(e){const t=Xl(e);const n=this.WithIdentifiers(t);this.$defs=n}Import(e,t){const n={...this.$defs,[e]:j(this.$defs[e],t)};return j({[M]:`Import`,$defs:n,$ref:e})}WithIdentifiers(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,n)=>{return{...t,[n]:{...e[n],$id:n}}},{})}};function Ql(e){return new Zl(e)}function $l(e,t){return j({[M]:`Not`,not:e},t)}function eu(e,t){return qe(e)?ji(e.parameters,t):Zn()}let tu=0;function nu(e,t={}){if(S(t.$id))t.$id=`T${tu++}`;const n=le(e({[M]:`This`,$ref:`${t.$id}`}));n.$id=t.$id;return j({[Fe]:`Recursive`,...n},t)}function ru(e,t){const n=b(e)?new globalThis.RegExp(e):e;return j({[M]:`RegExp`,type:`RegExp`,source:n.source,flags:n.flags},t)}function iu(e){return Ye(e)?e.allOf:gt(e)?e.anyOf:mt(e)?e.items??[]:[]}function au(e){return iu(e)}function ou(e,t){return qe(e)?j(e.returns,t):Zn(t)}var su=class{constructor(e){this.schema=e}Decode(e){return new cu(this.schema,e)}};var cu=class{constructor(e,t){this.schema=e;this.decode=t}EncodeTransform(e,t){const n=n=>t[Me].Encode(e(n));const r=e=>this.decode(t[Me].Decode(e));const i={Encode:n,Decode:r};return{...t,[Me]:i}}EncodeSchema(e,t){const n={Decode:this.decode,Encode:e};return{...t,[Me]:n}}Encode(e){return P(this.schema)?this.EncodeTransform(e,this.schema):this.EncodeSchema(e,this.schema)}};function lu(e){return new su(e)}function uu(e={}){return j({[M]:e[M]??`Unsafe`},e)}function du(e){return j({[M]:`Void`,type:`void`},e)}var fu={};c(fu,{Any:()=>Wn,Argument:()=>Kn,Array:()=>Gn,AsyncIterator:()=>qn,Awaited:()=>la,BigInt:()=>Lr,Boolean:()=>Ir,Capitalize:()=>Dc,Composite:()=>Na,Const:()=>Wa,Constructor:()=>$n,ConstructorParameters:()=>Ga,Date:()=>Pa,Enum:()=>Ka,Exclude:()=>Cs,Extends:()=>fs,Extract:()=>ks,Function:()=>er,Index:()=>mi,InstanceType:()=>Ns,Instantiate:()=>pc,Integer:()=>mc,Intersect:()=>ta,Iterator:()=>yi,KeyOf:()=>wa,Literal:()=>Fr,Lowercase:()=>Oc,Mapped:()=>Vi,Module:()=>Ql,Never:()=>Zn,Not:()=>$l,Null:()=>Fa,Number:()=>Rr,Object:()=>Si,Omit:()=>Vc,Optional:()=>Gi,Parameters:()=>eu,Partial:()=>fl,Pick:()=>tl,Promise:()=>Ci,Readonly:()=>Di,ReadonlyOptional:()=>Ps,Record:()=>qs,Recursive:()=>nu,Ref:()=>na,RegExp:()=>ru,Required:()=>Sl,Rest:()=>au,ReturnType:()=>ou,String:()=>zr,Symbol:()=>Ia,TemplateLiteral:()=>Yr,Transform:()=>lu,Tuple:()=>ji,Uint8Array:()=>Ra,Uncapitalize:()=>kc,Undefined:()=>La,Union:()=>sr,Unknown:()=>za,Unsafe:()=>uu,Uppercase:()=>Ac,Void:()=>du});const pu=fu;function mu(e){switch(e.errorType){case U.ArrayContains:return`Expected array to contain at least one matching value`;case U.ArrayMaxContains:return`Expected array to contain no more than ${e.schema.maxContains} matching values`;case U.ArrayMinContains:return`Expected array to contain at least ${e.schema.minContains} matching values`;case U.ArrayMaxItems:return`Expected array length to be less or equal to ${e.schema.maxItems}`;case U.ArrayMinItems:return`Expected array length to be greater or equal to ${e.schema.minItems}`;case U.ArrayUniqueItems:return`Expected array elements to be unique`;case U.Array:return`Expected array`;case U.AsyncIterator:return`Expected AsyncIterator`;case U.BigIntExclusiveMaximum:return`Expected bigint to be less than ${e.schema.exclusiveMaximum}`;case U.BigIntExclusiveMinimum:return`Expected bigint to be greater than ${e.schema.exclusiveMinimum}`;case U.BigIntMaximum:return`Expected bigint to be less or equal to ${e.schema.maximum}`;case U.BigIntMinimum:return`Expected bigint to be greater or equal to ${e.schema.minimum}`;case U.BigIntMultipleOf:return`Expected bigint to be a multiple of ${e.schema.multipleOf}`;case U.BigInt:return`Expected bigint`;case U.Boolean:return`Expected boolean`;case U.DateExclusiveMinimumTimestamp:return`Expected Date timestamp to be greater than ${e.schema.exclusiveMinimumTimestamp}`;case U.DateExclusiveMaximumTimestamp:return`Expected Date timestamp to be less than ${e.schema.exclusiveMaximumTimestamp}`;case U.DateMinimumTimestamp:return`Expected Date timestamp to be greater or equal to ${e.schema.minimumTimestamp}`;case U.DateMaximumTimestamp:return`Expected Date timestamp to be less or equal to ${e.schema.maximumTimestamp}`;case U.DateMultipleOfTimestamp:return`Expected Date timestamp to be a multiple of ${e.schema.multipleOfTimestamp}`;case U.Date:return`Expected Date`;case U.Function:return`Expected function`;case U.IntegerExclusiveMaximum:return`Expected integer to be less than ${e.schema.exclusiveMaximum}`;case U.IntegerExclusiveMinimum:return`Expected integer to be greater than ${e.schema.exclusiveMinimum}`;case U.IntegerMaximum:return`Expected integer to be less or equal to ${e.schema.maximum}`;case U.IntegerMinimum:return`Expected integer to be greater or equal to ${e.schema.minimum}`;case U.IntegerMultipleOf:return`Expected integer to be a multiple of ${e.schema.multipleOf}`;case U.Integer:return`Expected integer`;case U.IntersectUnevaluatedProperties:return`Unexpected property`;case U.Intersect:return`Expected all values to match`;case U.Iterator:return`Expected Iterator`;case U.Literal:return`Expected ${typeof e.schema.const===`string`?`'${e.schema.const}'`:e.schema.const}`;case U.Never:return`Never`;case U.Not:return`Value should not match`;case U.Null:return`Expected null`;case U.NumberExclusiveMaximum:return`Expected number to be less than ${e.schema.exclusiveMaximum}`;case U.NumberExclusiveMinimum:return`Expected number to be greater than ${e.schema.exclusiveMinimum}`;case U.NumberMaximum:return`Expected number to be less or equal to ${e.schema.maximum}`;case U.NumberMinimum:return`Expected number to be greater or equal to ${e.schema.minimum}`;case U.NumberMultipleOf:return`Expected number to be a multiple of ${e.schema.multipleOf}`;case U.Number:return`Expected number`;case U.Object:return`Expected object`;case U.ObjectAdditionalProperties:return`Unexpected property`;case U.ObjectMaxProperties:return`Expected object to have no more than ${e.schema.maxProperties} properties`;case U.ObjectMinProperties:return`Expected object to have at least ${e.schema.minProperties} properties`;case U.ObjectRequiredProperty:return`Expected required property`;case U.Promise:return`Expected Promise`;case U.RegExp:return`Expected string to match regular expression`;case U.StringFormatUnknown:return`Unknown format '${e.schema.format}'`;case U.StringFormat:return`Expected string to match '${e.schema.format}' format`;case U.StringMaxLength:return`Expected string length less or equal to ${e.schema.maxLength}`;case U.StringMinLength:return`Expected string length greater or equal to ${e.schema.minLength}`;case U.StringPattern:return`Expected string to match '${e.schema.pattern}'`;case U.String:return`Expected string`;case U.Symbol:return`Expected symbol`;case U.TupleLength:return`Expected tuple to have ${e.schema.maxItems||0} elements`;case U.Tuple:return`Expected tuple`;case U.Uint8ArrayMaxByteLength:return`Expected byte length less or equal to ${e.schema.maxByteLength}`;case U.Uint8ArrayMinByteLength:return`Expected byte length greater or equal to ${e.schema.minByteLength}`;case U.Uint8Array:return`Expected Uint8Array`;case U.Undefined:return`Expected undefined`;case U.Union:return`Expected union value`;case U.Void:return`Expected void`;case U.Kind:return`Expected kind '${e.schema[M]}'`;default:return`Unknown error type`}}let hu=mu;function gu(){return hu}var _u=class extends je{constructor(e){super(`Unable to dereference schema with $id '${e.$ref}'`);this.schema=e}};function vu(e,t){const n=t.find(t=>t.$id===e.$ref);if(n===void 0)throw new _u(e);return bu(n,t)}function yu(e,t){if(!be(e.$id)||t.some(t=>t.$id===e.$id))return t;t.push(e);return t}function bu(e,t){return e[M]===`This`||e[M]===`Ref`?vu(e,t):e}var xu=class extends je{constructor(e){super(`Unable to hash value`);this.value=e}};var Su;(function(e){e[e[`Undefined`]=0]=`Undefined`;e[e[`Null`]=1]=`Null`;e[e[`Boolean`]=2]=`Boolean`;e[e[`Number`]=3]=`Number`;e[e[`String`]=4]=`String`;e[e[`Object`]=5]=`Object`;e[e[`Array`]=6]=`Array`;e[e[`Date`]=7]=`Date`;e[e[`Uint8Array`]=8]=`Uint8Array`;e[e[`Symbol`]=9]=`Symbol`;e[e[`BigInt`]=10]=`BigInt`})(Su||(Su={}));let Cu=BigInt(`14695981039346656037`);const[wu,Tu]=[BigInt(`1099511628211`),BigInt(`18446744073709551616`)];const Eu=Array.from({length:256}).map((e,t)=>BigInt(t));const Du=new Float64Array(1);const Ou=new DataView(Du.buffer);const ku=new Uint8Array(Du.buffer);function*Au(e){const t=e===0?1:Math.ceil(Math.floor(Math.log2(e)+1)/8);for(let n=0;n<t;n++)yield e>>8*(t-1-n)&255}function ju(e){Uu(Su.Array);for(const t of e)Hu(t)}function Mu(e){Uu(Su.Boolean);Uu(e?1:0)}function Nu(e){Uu(Su.BigInt);Ou.setBigInt64(0,e);for(const e of ku)Uu(e)}function Pu(e){Uu(Su.Date);Hu(e.getTime())}function Fu(e){Uu(Su.Null)}function Iu(e){Uu(Su.Number);Ou.setFloat64(0,e);for(const e of ku)Uu(e)}function Lu(e){Uu(Su.Object);for(const t of globalThis.Object.getOwnPropertyNames(e).sort()){Hu(t);Hu(e[t])}}function Ru(e){Uu(Su.String);for(let t=0;t<e.length;t++)for(const n of Au(e.charCodeAt(t)))Uu(n)}function zu(e){Uu(Su.Symbol);Hu(e.description)}function Bu(e){Uu(Su.Uint8Array);for(let t=0;t<e.length;t++)Uu(e[t])}function Vu(e){return Uu(Su.Undefined)}function Hu(e){if(k(e))return ju(e);if(_e(e))return Mu(e);if(ye(e))return Nu(e);if(T(e))return Pu(e);if(ge(e))return Fu(e);if(A(e))return Iu(e);if(O(e))return Lu(e);if(be(e))return Ru(e);if(Se(e))return zu(e);if(me(e))return Bu(e);if(he(e))return Vu(e);throw new xu(e)}function Uu(e){Cu=Cu^Eu[e];Cu=Cu*wu%Tu}function Wu(e){Cu=BigInt(`14695981039346656037`);Hu(e);return Cu}var Gu=class extends je{constructor(e){super(`Unknown type`);this.schema=e}};function Ku(e){return e[M]===`Any`||e[M]===`Unknown`}function H(e){return e!==void 0}function qu(e,t,n){return true}function Ju(e,t,n){return true}function Yu(e,t,n){if(!k(n))return false;if(H(e.minItems)&&!(n.length>=e.minItems))return false;if(H(e.maxItems)&&!(n.length<=e.maxItems))return false;if(!n.every(n=>Dd(e.items,t,n)))return false;if(e.uniqueItems===true&&!function(){const e=new Set;for(const t of n){const n=Wu(t);if(e.has(n))return false;else e.add(n)}return true}())return false;if(!(H(e.contains)||A(e.minContains)||A(e.maxContains)))return true;const r=H(e.contains)?e.contains:Zn();const i=n.reduce((e,n)=>Dd(r,t,n)?e+1:e,0);if(i===0)return false;if(A(e.minContains)&&i<e.minContains)return false;if(A(e.maxContains)&&i>e.maxContains)return false;return true}function Xu(e,t,n){return ue(n)}function Zu(e,t,n){if(!ye(n))return false;if(H(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum))return false;if(H(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum))return false;if(H(e.maximum)&&!(n<=e.maximum))return false;if(H(e.minimum)&&!(n>=e.minimum))return false;if(H(e.multipleOf)&&!(n%e.multipleOf===BigInt(0)))return false;return true}function Qu(e,t,n){return _e(n)}function $u(e,t,n){return Dd(e.returns,t,n.prototype)}function ed(e,t,n){if(!T(n))return false;if(H(e.exclusiveMaximumTimestamp)&&!(n.getTime()<e.exclusiveMaximumTimestamp))return false;if(H(e.exclusiveMinimumTimestamp)&&!(n.getTime()>e.exclusiveMinimumTimestamp))return false;if(H(e.maximumTimestamp)&&!(n.getTime()<=e.maximumTimestamp))return false;if(H(e.minimumTimestamp)&&!(n.getTime()>=e.minimumTimestamp))return false;if(H(e.multipleOfTimestamp)&&!(n.getTime()%e.multipleOfTimestamp===0))return false;return true}function td(e,t,n){return xe(n)}function nd(e,t,n){const r=globalThis.Object.values(e.$defs);const i=e.$defs[e.$ref];return Dd(i,[...t,...r],n)}function rd(e,t,n){if(!ve(n))return false;if(H(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum))return false;if(H(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum))return false;if(H(e.maximum)&&!(n<=e.maximum))return false;if(H(e.minimum)&&!(n>=e.minimum))return false;if(H(e.multipleOf)&&!(n%e.multipleOf===0))return false;return true}function id(e,t,n){const r=e.allOf.every(e=>Dd(e,t,n));if(e.unevaluatedProperties===false){const t=new RegExp(ya(e));const i=Object.getOwnPropertyNames(n).every(e=>t.test(e));return r&&i}else if(St(e.unevaluatedProperties)){const i=new RegExp(ya(e));const a=Object.getOwnPropertyNames(n).every(r=>i.test(r)||Dd(e.unevaluatedProperties,t,n[r]));return r&&a}else return r}function ad(e,t,n){return de(n)}function od(e,t,n){return n===e.const}function sd(e,t,n){return false}function cd(e,t,n){return!Dd(e.not,t,n)}function ld(e,t,n){return ge(n)}function ud(e,t,n){if(!we.IsNumberLike(n))return false;if(H(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum))return false;if(H(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum))return false;if(H(e.minimum)&&!(n>=e.minimum))return false;if(H(e.maximum)&&!(n<=e.maximum))return false;if(H(e.multipleOf)&&!(n%e.multipleOf===0))return false;return true}function dd(e,t,n){if(!we.IsObjectLike(n))return false;if(H(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties))return false;if(H(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return false;const r=Object.getOwnPropertyNames(e.properties);for(const i of r){const r=e.properties[i];if(e.required&&e.required.includes(i)){if(!Dd(r,t,n[i]))return false;if((bs(r)||Ku(r))&&!(i in n))return false}else if(we.IsExactOptionalProperty(n,i)&&!Dd(r,t,n[i]))return false}if(e.additionalProperties===false){const t=Object.getOwnPropertyNames(n);if(e.required&&e.required.length===r.length&&t.length===r.length)return true;else return t.every(e=>r.includes(e))}else if(typeof e.additionalProperties===`object`){const i=Object.getOwnPropertyNames(n);return i.every(i=>r.includes(i)||Dd(e.additionalProperties,t,n[i]))}else return true}function fd(e,t,n){return w(n)}function pd(e,t,n){if(!we.IsRecordLike(n))return false;if(H(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties))return false;if(H(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return false;const[r,i]=Object.entries(e.patternProperties)[0];const a=new RegExp(r);const o=Object.entries(n).every(([e,n])=>{return a.test(e)?Dd(i,t,n):true});const s=typeof e.additionalProperties===`object`?Object.entries(n).every(([n,r])=>{return!a.test(n)?Dd(e.additionalProperties,t,r):true}):true;const c=e.additionalProperties===false?Object.getOwnPropertyNames(n).every(e=>{return a.test(e)}):true;return o&&s&&c}function md(e,t,n){return Dd(bu(e,t),t,n)}function hd(e,t,n){const r=new RegExp(e.source,e.flags);if(H(e.minLength)){if(!(n.length>=e.minLength))return false}if(H(e.maxLength)){if(!(n.length<=e.maxLength))return false}return r.test(n)}function gd(e,t,n){if(!be(n))return false;if(H(e.minLength)){if(!(n.length>=e.minLength))return false}if(H(e.maxLength)){if(!(n.length<=e.maxLength))return false}if(H(e.pattern)){const t=new RegExp(e.pattern);if(!t.test(n))return false}if(H(e.format)){if(!jn(e.format))return false;const t=Nn(e.format);return t(n)}return true}function _d(e,t,n){return Se(n)}function vd(e,t,n){return be(n)&&new RegExp(e.pattern).test(n)}function yd(e,t,n){return Dd(bu(e,t),t,n)}function bd(e,t,n){if(!k(n))return false;if(e.items===void 0&&!(n.length===0))return false;if(!(n.length===e.maxItems))return false;if(!e.items)return true;for(let r=0;r<e.items.length;r++)if(!Dd(e.items[r],t,n[r]))return false;return true}function xd(e,t,n){return he(n)}function Sd(e,t,n){return e.anyOf.some(e=>Dd(e,t,n))}function Cd(e,t,n){if(!me(n))return false;if(H(e.maxByteLength)&&!(n.length<=e.maxByteLength))return false;if(H(e.minByteLength)&&!(n.length>=e.minByteLength))return false;return true}function wd(e,t,n){return true}function Td(e,t,n){return we.IsVoidLike(n)}function Ed(e,t,n){if(!Fn(e[M]))return false;const r=Ln(e[M]);return r(e,n)}function Dd(e,t,n){const r=H(e.$id)?yu(e,t):t;const i=e;switch(i[M]){case`Any`:return qu(i,r,n);case`Argument`:return Ju(i,r,n);case`Array`:return Yu(i,r,n);case`AsyncIterator`:return Xu(i,r,n);case`BigInt`:return Zu(i,r,n);case`Boolean`:return Qu(i,r,n);case`Constructor`:return $u(i,r,n);case`Date`:return ed(i,r,n);case`Function`:return td(i,r,n);case`Import`:return nd(i,r,n);case`Integer`:return rd(i,r,n);case`Intersect`:return id(i,r,n);case`Iterator`:return ad(i,r,n);case`Literal`:return od(i,r,n);case`Never`:return sd(i,r,n);case`Not`:return cd(i,r,n);case`Null`:return ld(i,r,n);case`Number`:return ud(i,r,n);case`Object`:return dd(i,r,n);case`Promise`:return fd(i,r,n);case`Record`:return pd(i,r,n);case`Ref`:return md(i,r,n);case`RegExp`:return hd(i,r,n);case`String`:return gd(i,r,n);case`Symbol`:return _d(i,r,n);case`TemplateLiteral`:return vd(i,r,n);case`This`:return yd(i,r,n);case`Tuple`:return bd(i,r,n);case`Undefined`:return xd(i,r,n);case`Union`:return Sd(i,r,n);case`Uint8Array`:return Cd(i,r,n);case`Unknown`:return wd(i,r,n);case`Void`:return Td(i,r,n);default:if(!Fn(i[M]))throw new Gu(i);return Ed(i,r,n)}}function Od(...e){return e.length===3?Dd(e[0],e[1],e[2]):Dd(e[0],[],e[1])}var U;(function(e){e[e[`ArrayContains`]=0]=`ArrayContains`;e[e[`ArrayMaxContains`]=1]=`ArrayMaxContains`;e[e[`ArrayMaxItems`]=2]=`ArrayMaxItems`;e[e[`ArrayMinContains`]=3]=`ArrayMinContains`;e[e[`ArrayMinItems`]=4]=`ArrayMinItems`;e[e[`ArrayUniqueItems`]=5]=`ArrayUniqueItems`;e[e[`Array`]=6]=`Array`;e[e[`AsyncIterator`]=7]=`AsyncIterator`;e[e[`BigIntExclusiveMaximum`]=8]=`BigIntExclusiveMaximum`;e[e[`BigIntExclusiveMinimum`]=9]=`BigIntExclusiveMinimum`;e[e[`BigIntMaximum`]=10]=`BigIntMaximum`;e[e[`BigIntMinimum`]=11]=`BigIntMinimum`;e[e[`BigIntMultipleOf`]=12]=`BigIntMultipleOf`;e[e[`BigInt`]=13]=`BigInt`;e[e[`Boolean`]=14]=`Boolean`;e[e[`DateExclusiveMaximumTimestamp`]=15]=`DateExclusiveMaximumTimestamp`;e[e[`DateExclusiveMinimumTimestamp`]=16]=`DateExclusiveMinimumTimestamp`;e[e[`DateMaximumTimestamp`]=17]=`DateMaximumTimestamp`;e[e[`DateMinimumTimestamp`]=18]=`DateMinimumTimestamp`;e[e[`DateMultipleOfTimestamp`]=19]=`DateMultipleOfTimestamp`;e[e[`Date`]=20]=`Date`;e[e[`Function`]=21]=`Function`;e[e[`IntegerExclusiveMaximum`]=22]=`IntegerExclusiveMaximum`;e[e[`IntegerExclusiveMinimum`]=23]=`IntegerExclusiveMinimum`;e[e[`IntegerMaximum`]=24]=`IntegerMaximum`;e[e[`IntegerMinimum`]=25]=`IntegerMinimum`;e[e[`IntegerMultipleOf`]=26]=`IntegerMultipleOf`;e[e[`Integer`]=27]=`Integer`;e[e[`IntersectUnevaluatedProperties`]=28]=`IntersectUnevaluatedProperties`;e[e[`Intersect`]=29]=`Intersect`;e[e[`Iterator`]=30]=`Iterator`;e[e[`Kind`]=31]=`Kind`;e[e[`Literal`]=32]=`Literal`;e[e[`Never`]=33]=`Never`;e[e[`Not`]=34]=`Not`;e[e[`Null`]=35]=`Null`;e[e[`NumberExclusiveMaximum`]=36]=`NumberExclusiveMaximum`;e[e[`NumberExclusiveMinimum`]=37]=`NumberExclusiveMinimum`;e[e[`NumberMaximum`]=38]=`NumberMaximum`;e[e[`NumberMinimum`]=39]=`NumberMinimum`;e[e[`NumberMultipleOf`]=40]=`NumberMultipleOf`;e[e[`Number`]=41]=`Number`;e[e[`ObjectAdditionalProperties`]=42]=`ObjectAdditionalProperties`;e[e[`ObjectMaxProperties`]=43]=`ObjectMaxProperties`;e[e[`ObjectMinProperties`]=44]=`ObjectMinProperties`;e[e[`ObjectRequiredProperty`]=45]=`ObjectRequiredProperty`;e[e[`Object`]=46]=`Object`;e[e[`Promise`]=47]=`Promise`;e[e[`RegExp`]=48]=`RegExp`;e[e[`StringFormatUnknown`]=49]=`StringFormatUnknown`;e[e[`StringFormat`]=50]=`StringFormat`;e[e[`StringMaxLength`]=51]=`StringMaxLength`;e[e[`StringMinLength`]=52]=`StringMinLength`;e[e[`StringPattern`]=53]=`StringPattern`;e[e[`String`]=54]=`String`;e[e[`Symbol`]=55]=`Symbol`;e[e[`TupleLength`]=56]=`TupleLength`;e[e[`Tuple`]=57]=`Tuple`;e[e[`Uint8ArrayMaxByteLength`]=58]=`Uint8ArrayMaxByteLength`;e[e[`Uint8ArrayMinByteLength`]=59]=`Uint8ArrayMinByteLength`;e[e[`Uint8Array`]=60]=`Uint8Array`;e[e[`Undefined`]=61]=`Undefined`;e[e[`Union`]=62]=`Union`;e[e[`Void`]=63]=`Void`})(U||(U={}));var kd=class extends je{constructor(e){super(`Unknown type`);this.schema=e}};function Ad(e){return e.replace(/~/g,`~0`).replace(/\//g,`~1`)}function W(e){return e!==void 0}var jd=class{constructor(e){this.iterator=e}[Symbol.iterator](){return this.iterator}First(){const e=this.iterator.next();return e.done?void 0:e.value}};function G(e,t,n,r,i=[]){return{type:e,schema:t,path:n,value:r,message:gu()({errorType:e,path:n,schema:t,value:r,errors:i}),errors:i}}function*Md(e,t,n,r){}function*Nd(e,t,n,r){}function*Pd(e,t,n,r){if(!k(r))return yield G(U.Array,e,n,r);if(W(e.minItems)&&!(r.length>=e.minItems))yield G(U.ArrayMinItems,e,n,r);if(W(e.maxItems)&&!(r.length<=e.maxItems))yield G(U.ArrayMaxItems,e,n,r);for(let i=0;i<r.length;i++)yield*mf(e.items,t,`${n}/${i}`,r[i]);if(e.uniqueItems===true&&!function(){const e=new Set;for(const t of r){const n=Wu(t);if(e.has(n))return false;else e.add(n)}return true}())yield G(U.ArrayUniqueItems,e,n,r);if(!(W(e.contains)||W(e.minContains)||W(e.maxContains)))return;const i=W(e.contains)?e.contains:Zn();const a=r.reduce((e,r,a)=>mf(i,t,`${n}${a}`,r).next().done===true?e+1:e,0);if(a===0)yield G(U.ArrayContains,e,n,r);if(A(e.minContains)&&a<e.minContains)yield G(U.ArrayMinContains,e,n,r);if(A(e.maxContains)&&a>e.maxContains)yield G(U.ArrayMaxContains,e,n,r)}function*Fd(e,t,n,r){if(!ue(r))yield G(U.AsyncIterator,e,n,r)}function*Id(e,t,n,r){if(!ye(r))return yield G(U.BigInt,e,n,r);if(W(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum))yield G(U.BigIntExclusiveMaximum,e,n,r);if(W(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum))yield G(U.BigIntExclusiveMinimum,e,n,r);if(W(e.maximum)&&!(r<=e.maximum))yield G(U.BigIntMaximum,e,n,r);if(W(e.minimum)&&!(r>=e.minimum))yield G(U.BigIntMinimum,e,n,r);if(W(e.multipleOf)&&!(r%e.multipleOf===BigInt(0)))yield G(U.BigIntMultipleOf,e,n,r)}function*Ld(e,t,n,r){if(!_e(r))yield G(U.Boolean,e,n,r)}function*Rd(e,t,n,r){yield*mf(e.returns,t,n,r.prototype)}function*zd(e,t,n,r){if(!T(r))return yield G(U.Date,e,n,r);if(W(e.exclusiveMaximumTimestamp)&&!(r.getTime()<e.exclusiveMaximumTimestamp))yield G(U.DateExclusiveMaximumTimestamp,e,n,r);if(W(e.exclusiveMinimumTimestamp)&&!(r.getTime()>e.exclusiveMinimumTimestamp))yield G(U.DateExclusiveMinimumTimestamp,e,n,r);if(W(e.maximumTimestamp)&&!(r.getTime()<=e.maximumTimestamp))yield G(U.DateMaximumTimestamp,e,n,r);if(W(e.minimumTimestamp)&&!(r.getTime()>=e.minimumTimestamp))yield G(U.DateMinimumTimestamp,e,n,r);if(W(e.multipleOfTimestamp)&&!(r.getTime()%e.multipleOfTimestamp===0))yield G(U.DateMultipleOfTimestamp,e,n,r)}function*Bd(e,t,n,r){if(!xe(r))yield G(U.Function,e,n,r)}function*Vd(e,t,n,r){const i=globalThis.Object.values(e.$defs);const a=e.$defs[e.$ref];yield*mf(a,[...t,...i],n,r)}function*Hd(e,t,n,r){if(!ve(r))return yield G(U.Integer,e,n,r);if(W(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum))yield G(U.IntegerExclusiveMaximum,e,n,r);if(W(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum))yield G(U.IntegerExclusiveMinimum,e,n,r);if(W(e.maximum)&&!(r<=e.maximum))yield G(U.IntegerMaximum,e,n,r);if(W(e.minimum)&&!(r>=e.minimum))yield G(U.IntegerMinimum,e,n,r);if(W(e.multipleOf)&&!(r%e.multipleOf===0))yield G(U.IntegerMultipleOf,e,n,r)}function*Ud(e,t,n,r){let i=false;for(const a of e.allOf)for(const e of mf(a,t,n,r)){i=true;yield e}if(i)return yield G(U.Intersect,e,n,r);if(e.unevaluatedProperties===false){const t=new RegExp(ya(e));for(const i of Object.getOwnPropertyNames(r))if(!t.test(i))yield G(U.IntersectUnevaluatedProperties,e,`${n}/${i}`,r)}if(typeof e.unevaluatedProperties===`object`){const i=new RegExp(ya(e));for(const a of Object.getOwnPropertyNames(r))if(!i.test(a)){const i=mf(e.unevaluatedProperties,t,`${n}/${a}`,r[a]).next();if(!i.done)yield i.value}}}function*Wd(e,t,n,r){if(!de(r))yield G(U.Iterator,e,n,r)}function*Gd(e,t,n,r){if(!(r===e.const))yield G(U.Literal,e,n,r)}function*Kd(e,t,n,r){yield G(U.Never,e,n,r)}function*qd(e,t,n,r){if(mf(e.not,t,n,r).next().done===true)yield G(U.Not,e,n,r)}function*Jd(e,t,n,r){if(!ge(r))yield G(U.Null,e,n,r)}function*Yd(e,t,n,r){if(!we.IsNumberLike(r))return yield G(U.Number,e,n,r);if(W(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum))yield G(U.NumberExclusiveMaximum,e,n,r);if(W(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum))yield G(U.NumberExclusiveMinimum,e,n,r);if(W(e.maximum)&&!(r<=e.maximum))yield G(U.NumberMaximum,e,n,r);if(W(e.minimum)&&!(r>=e.minimum))yield G(U.NumberMinimum,e,n,r);if(W(e.multipleOf)&&!(r%e.multipleOf===0))yield G(U.NumberMultipleOf,e,n,r)}function*Xd(e,t,n,r){if(!we.IsObjectLike(r))return yield G(U.Object,e,n,r);if(W(e.minProperties)&&!(Object.getOwnPropertyNames(r).length>=e.minProperties))yield G(U.ObjectMinProperties,e,n,r);if(W(e.maxProperties)&&!(Object.getOwnPropertyNames(r).length<=e.maxProperties))yield G(U.ObjectMaxProperties,e,n,r);const i=Array.isArray(e.required)?e.required:[];const a=Object.getOwnPropertyNames(e.properties);const o=Object.getOwnPropertyNames(r);for(const t of i){if(o.includes(t))continue;yield G(U.ObjectRequiredProperty,e.properties[t],`${n}/${Ad(t)}`,void 0)}if(e.additionalProperties===false){for(const t of o)if(!a.includes(t))yield G(U.ObjectAdditionalProperties,e,`${n}/${Ad(t)}`,r[t])}if(typeof e.additionalProperties===`object`)for(const i of o){if(a.includes(i))continue;yield*mf(e.additionalProperties,t,`${n}/${Ad(i)}`,r[i])}for(const i of a){const a=e.properties[i];if(e.required&&e.required.includes(i)){yield*mf(a,t,`${n}/${Ad(i)}`,r[i]);if(bs(e)&&!(i in r))yield G(U.ObjectRequiredProperty,a,`${n}/${Ad(i)}`,void 0)}else if(we.IsExactOptionalProperty(r,i))yield*mf(a,t,`${n}/${Ad(i)}`,r[i])}}function*Zd(e,t,n,r){if(!w(r))yield G(U.Promise,e,n,r)}function*Qd(e,t,n,r){if(!we.IsRecordLike(r))return yield G(U.Object,e,n,r);if(W(e.minProperties)&&!(Object.getOwnPropertyNames(r).length>=e.minProperties))yield G(U.ObjectMinProperties,e,n,r);if(W(e.maxProperties)&&!(Object.getOwnPropertyNames(r).length<=e.maxProperties))yield G(U.ObjectMaxProperties,e,n,r);const[i,a]=Object.entries(e.patternProperties)[0];const o=new RegExp(i);for(const[e,i]of Object.entries(r))if(o.test(e))yield*mf(a,t,`${n}/${Ad(e)}`,i);if(typeof e.additionalProperties===`object`){for(const[i,a]of Object.entries(r))if(!o.test(i))yield*mf(e.additionalProperties,t,`${n}/${Ad(i)}`,a)}if(e.additionalProperties===false)for(const[t,i]of Object.entries(r)){if(o.test(t))continue;return yield G(U.ObjectAdditionalProperties,e,`${n}/${Ad(t)}`,i)}}function*$d(e,t,n,r){yield*mf(bu(e,t),t,n,r)}function*ef(e,t,n,r){if(!be(r))return yield G(U.String,e,n,r);if(W(e.minLength)&&!(r.length>=e.minLength))yield G(U.StringMinLength,e,n,r);if(W(e.maxLength)&&!(r.length<=e.maxLength))yield G(U.StringMaxLength,e,n,r);const i=new RegExp(e.source,e.flags);if(!i.test(r))return yield G(U.RegExp,e,n,r)}function*tf(e,t,n,r){if(!be(r))return yield G(U.String,e,n,r);if(W(e.minLength)&&!(r.length>=e.minLength))yield G(U.StringMinLength,e,n,r);if(W(e.maxLength)&&!(r.length<=e.maxLength))yield G(U.StringMaxLength,e,n,r);if(be(e.pattern)){const t=new RegExp(e.pattern);if(!t.test(r))yield G(U.StringPattern,e,n,r)}if(be(e.format))if(!jn(e.format))yield G(U.StringFormatUnknown,e,n,r);else{const t=Nn(e.format);if(!t(r))yield G(U.StringFormat,e,n,r)}}function*nf(e,t,n,r){if(!Se(r))yield G(U.Symbol,e,n,r)}function*rf(e,t,n,r){if(!be(r))return yield G(U.String,e,n,r);const i=new RegExp(e.pattern);if(!i.test(r))yield G(U.StringPattern,e,n,r)}function*af(e,t,n,r){yield*mf(bu(e,t),t,n,r)}function*sf(e,t,n,r){if(!k(r))return yield G(U.Tuple,e,n,r);if(e.items===void 0&&!(r.length===0))return yield G(U.TupleLength,e,n,r);if(!(r.length===e.maxItems))return yield G(U.TupleLength,e,n,r);if(!e.items)return;for(let i=0;i<e.items.length;i++)yield*mf(e.items[i],t,`${n}/${i}`,r[i])}function*cf(e,t,n,r){if(!he(r))yield G(U.Undefined,e,n,r)}function*lf(e,t,n,r){if(Od(e,t,r))return;const i=e.anyOf.map(e=>new jd(mf(e,t,n,r)));yield G(U.Union,e,n,r,i)}function*uf(e,t,n,r){if(!me(r))return yield G(U.Uint8Array,e,n,r);if(W(e.maxByteLength)&&!(r.length<=e.maxByteLength))yield G(U.Uint8ArrayMaxByteLength,e,n,r);if(W(e.minByteLength)&&!(r.length>=e.minByteLength))yield G(U.Uint8ArrayMinByteLength,e,n,r)}function*df(e,t,n,r){}function*ff(e,t,n,r){if(!we.IsVoidLike(r))yield G(U.Void,e,n,r)}function*pf(e,t,n,r){const i=Ln(e[M]);if(!i(e,r))yield G(U.Kind,e,n,r)}function*mf(e,t,n,r){const i=W(e.$id)?[...t,e]:t;const a=e;switch(a[M]){case`Any`:return yield*Md(a,i,n,r);case`Argument`:return yield*Nd(a,i,n,r);case`Array`:return yield*Pd(a,i,n,r);case`AsyncIterator`:return yield*Fd(a,i,n,r);case`BigInt`:return yield*Id(a,i,n,r);case`Boolean`:return yield*Ld(a,i,n,r);case`Constructor`:return yield*Rd(a,i,n,r);case`Date`:return yield*zd(a,i,n,r);case`Function`:return yield*Bd(a,i,n,r);case`Import`:return yield*Vd(a,i,n,r);case`Integer`:return yield*Hd(a,i,n,r);case`Intersect`:return yield*Ud(a,i,n,r);case`Iterator`:return yield*Wd(a,i,n,r);case`Literal`:return yield*Gd(a,i,n,r);case`Never`:return yield*Kd(a,i,n,r);case`Not`:return yield*qd(a,i,n,r);case`Null`:return yield*Jd(a,i,n,r);case`Number`:return yield*Yd(a,i,n,r);case`Object`:return yield*Xd(a,i,n,r);case`Promise`:return yield*Zd(a,i,n,r);case`Record`:return yield*Qd(a,i,n,r);case`Ref`:return yield*$d(a,i,n,r);case`RegExp`:return yield*ef(a,i,n,r);case`String`:return yield*tf(a,i,n,r);case`Symbol`:return yield*nf(a,i,n,r);case`TemplateLiteral`:return yield*rf(a,i,n,r);case`This`:return yield*af(a,i,n,r);case`Tuple`:return yield*sf(a,i,n,r);case`Undefined`:return yield*cf(a,i,n,r);case`Union`:return yield*lf(a,i,n,r);case`Uint8Array`:return yield*uf(a,i,n,r);case`Unknown`:return yield*df(a,i,n,r);case`Void`:return yield*ff(a,i,n,r);default:if(!Fn(a[M]))throw new kd(e);return yield*pf(a,i,n,r)}}function hf(...e){const t=e.length===3?mf(e[0],e[1],``,e[2]):mf(e[0],[],``,e[1]);return new jd(t)}function gf(e){const t={};for(const n of Object.getOwnPropertyNames(e))t[n]=Cf(e[n]);for(const n of Object.getOwnPropertySymbols(e))t[n]=Cf(e[n]);return t}function _f(e){return e.map(e=>Cf(e))}function vf(e){return e.slice()}function yf(e){return new Map(Cf([...e.entries()]))}function bf(e){return new Set(Cf([...e.entries()]))}function xf(e){return new Date(e.toISOString())}function Sf(e){return e}function Cf(e){if(k(e))return _f(e);if(T(e))return xf(e);if(E(e))return vf(e);if(fe(e))return yf(e);if(pe(e))return bf(e);if(O(e))return gf(e);if(Ce(e))return Sf(e);throw new Error(`ValueClone: Unable to clone value`)}var wf=class extends je{constructor(e,t){super(t);this.schema=e}};function K(e){return xe(e)?e():Cf(e)}function Tf(e,t){if(D(e,`default`))return K(e.default);else return{}}function Ef(e,t){return{}}function Df(e,t){if(e.uniqueItems===true&&!D(e,`default`))throw new wf(e,`Array with the uniqueItems constraint requires a default value`);else if(`contains`in e&&!D(e,`default`))throw new wf(e,`Array with the contains constraint requires a default value`);else if(`default`in e)return K(e.default);else if(e.minItems!==void 0)return Array.from({length:e.minItems}).map(n=>{return ap(e.items,t)});else return[]}function Of(e,t){if(D(e,`default`))return K(e.default);else return async function*(){}()}function kf(e,t){if(D(e,`default`))return K(e.default);else return BigInt(0)}function Af(e,t){if(D(e,`default`))return K(e.default);else return false}function jf(e,t){if(D(e,`default`))return K(e.default);else{const n=ap(e.returns,t);if(typeof n===`object`&&!Array.isArray(n))return class{constructor(){for(const[e,t]of Object.entries(n)){const n=this;n[e]=t}}};else return class{}}}function Mf(e,t){if(D(e,`default`))return K(e.default);else if(e.minimumTimestamp!==void 0)return new Date(e.minimumTimestamp);else return new Date}function Nf(e,t){if(D(e,`default`))return K(e.default);else return()=>ap(e.returns,t)}function Pf(e,t){const n=globalThis.Object.values(e.$defs);const r=e.$defs[e.$ref];return ap(r,[...t,...n])}function Ff(e,t){if(D(e,`default`))return K(e.default);else if(e.minimum!==void 0)return e.minimum;else return 0}function If(e,t){if(D(e,`default`))return K(e.default);else{const n=e.allOf.reduce((e,n)=>{const r=ap(n,t);return typeof r===`object`?{...e,...r}:r},{});if(!Od(e,t,n))throw new wf(e,`Intersect produced invalid value. Consider using a default value.`);return n}}function Lf(e,t){if(D(e,`default`))return K(e.default);else return function*(){}()}function Rf(e,t){if(D(e,`default`))return K(e.default);else return e.const}function zf(e,t){if(D(e,`default`))return K(e.default);else throw new wf(e,`Never types cannot be created. Consider using a default value.`)}function Bf(e,t){if(D(e,`default`))return K(e.default);else throw new wf(e,`Not types must have a default value`)}function Vf(e,t){if(D(e,`default`))return K(e.default);else return null}function Hf(e,t){if(D(e,`default`))return K(e.default);else if(e.minimum!==void 0)return e.minimum;else return 0}function Uf(e,t){if(D(e,`default`))return K(e.default);else{const n=new Set(e.required);const r={};for(const[i,a]of Object.entries(e.properties)){if(!n.has(i))continue;r[i]=ap(a,t)}return r}}function Wf(e,t){if(D(e,`default`))return K(e.default);else return Promise.resolve(ap(e.item,t))}function Gf(e,t){if(D(e,`default`))return K(e.default);else return{}}function Kf(e,t){if(D(e,`default`))return K(e.default);else return ap(bu(e,t),t)}function qf(e,t){if(D(e,`default`))return K(e.default);else throw new wf(e,`RegExp types cannot be created. Consider using a default value.`)}function Jf(e,t){if(e.pattern!==void 0)if(!D(e,`default`))throw new wf(e,`String types with patterns must specify a default value`);else return K(e.default);else if(e.format!==void 0)if(!D(e,`default`))throw new wf(e,`String types with formats must specify a default value`);else return K(e.default);else if(D(e,`default`))return K(e.default);else if(e.minLength!==void 0)return Array.from({length:e.minLength}).map(()=>` `).join(``);else return``}function Yf(e,t){if(D(e,`default`))return K(e.default);else if(`value`in e)return Symbol.for(e.value);else return Symbol()}function Xf(e,t){if(D(e,`default`))return K(e.default);if(!Dr(e))throw new wf(e,`Can only create template literals that produce a finite variants. Consider using a default value.`);const n=Pr(e);return n[0]}function Zf(e,t){if(sp++>op)throw new wf(e,`Cannot create recursive type as it appears possibly infinite. Consider using a default.`);if(D(e,`default`))return K(e.default);else return ap(bu(e,t),t)}function Qf(e,t){if(D(e,`default`))return K(e.default);if(e.items===void 0)return[];else return Array.from({length:e.minItems}).map((n,r)=>ap(e.items[r],t))}function $f(e,t){if(D(e,`default`))return K(e.default);else return void 0}function ep(e,t){if(D(e,`default`))return K(e.default);else if(e.anyOf.length===0)throw new Error(`ValueCreate.Union: Cannot create Union with zero variants`);else return ap(e.anyOf[0],t)}function tp(e,t){if(D(e,`default`))return K(e.default);else if(e.minByteLength!==void 0)return new Uint8Array(e.minByteLength);else return new Uint8Array(0)}function np(e,t){if(D(e,`default`))return K(e.default);else return{}}function rp(e,t){if(D(e,`default`))return K(e.default);else return void 0}function ip(e,t){if(D(e,`default`))return K(e.default);else throw new Error(`User defined types must specify a default value`)}function ap(e,t){const n=yu(e,t);const r=e;switch(r[M]){case`Any`:return Tf(r,n);case`Argument`:return Ef(r,n);case`Array`:return Df(r,n);case`AsyncIterator`:return Of(r,n);case`BigInt`:return kf(r,n);case`Boolean`:return Af(r,n);case`Constructor`:return jf(r,n);case`Date`:return Mf(r,n);case`Function`:return Nf(r,n);case`Import`:return Pf(r,n);case`Integer`:return Ff(r,n);case`Intersect`:return If(r,n);case`Iterator`:return Lf(r,n);case`Literal`:return Rf(r,n);case`Never`:return zf(r,n);case`Not`:return Bf(r,n);case`Null`:return Vf(r,n);case`Number`:return Hf(r,n);case`Object`:return Uf(r,n);case`Promise`:return Wf(r,n);case`Record`:return Gf(r,n);case`Ref`:return Kf(r,n);case`RegExp`:return qf(r,n);case`String`:return Jf(r,n);case`Symbol`:return Yf(r,n);case`TemplateLiteral`:return Xf(r,n);case`This`:return Zf(r,n);case`Tuple`:return Qf(r,n);case`Undefined`:return $f(r,n);case`Union`:return ep(r,n);case`Uint8Array`:return tp(r,n);case`Unknown`:return np(r,n);case`Void`:return rp(r,n);default:if(!Fn(r[M]))throw new wf(r,`Unknown type`);return ip(r,n)}}const op=512;let sp=0;function cp(...e){sp=0;return e.length===2?ap(e[0],e[1]):ap(e[0],[])}function lp(e){return xt(e)&&e[M]!==`Unsafe`}function up(e,t,n){if(!k(n))return n;return n.map(n=>yp(e.items,t,n))}function dp(e,t,n){const r=globalThis.Object.values(e.$defs);const i=e.$defs[e.$ref];return yp(i,[...t,...r],n)}function fp(e,t,n){const r=e.unevaluatedProperties;const i=e.allOf.map(e=>yp(e,t,Cf(n)));const a=i.reduce((e,t)=>O(t)?{...e,...t}:t,{});if(!O(n)||!O(a)||!xt(r))return a;const o=_a(e);for(const e of Object.getOwnPropertyNames(n)){if(o.includes(e))continue;if(Od(r,t,n[e]))a[e]=yp(r,t,n[e])}return a}function pp(e,t,n){if(!O(n)||k(n))return n;const r=e.additionalProperties;for(const i of Object.getOwnPropertyNames(n)){if(D(e.properties,i)){n[i]=yp(e.properties[i],t,n[i]);continue}if(xt(r)&&Od(r,t,n[i])){n[i]=yp(r,t,n[i]);continue}delete n[i]}return n}function mp(e,t,n){if(!O(n))return n;const r=e.additionalProperties;const i=Object.getOwnPropertyNames(n);const[a,o]=Object.entries(e.patternProperties)[0];const s=new RegExp(a);for(const e of i){if(s.test(e)){n[e]=yp(o,t,n[e]);continue}if(xt(r)&&Od(r,t,n[e])){n[e]=yp(r,t,n[e]);continue}delete n[e]}return n}function hp(e,t,n){return yp(bu(e,t),t,n)}function gp(e,t,n){return yp(bu(e,t),t,n)}function _p(e,t,n){if(!k(n))return n;if(he(e.items))return[];const r=Math.min(n.length,e.items.length);for(let i=0;i<r;i++)n[i]=yp(e.items[i],t,n[i]);return n.length>r?n.slice(0,r):n}function vp(e,t,n){for(const r of e.anyOf)if(lp(r)&&Od(r,t,n))return yp(r,t,n);return n}function yp(e,t,n){const r=be(e.$id)?yu(e,t):t;const i=e;switch(i[M]){case`Array`:return up(i,r,n);case`Import`:return dp(i,r,n);case`Intersect`:return fp(i,r,n);case`Object`:return pp(i,r,n);case`Record`:return mp(i,r,n);case`Ref`:return hp(i,r,n);case`This`:return gp(i,r,n);case`Tuple`:return _p(i,r,n);case`Union`:return vp(i,r,n);default:return n}}function bp(...e){return e.length===3?yp(e[0],e[1],e[2]):yp(e[0],[],e[1])}var xp=class extends je{constructor(e,t,n){super(`Unable to decode value as it does not match the expected schema`);this.schema=e;this.value=t;this.error=n}};var Sp=class extends je{constructor(e,t,n,r){super(r instanceof Error?r.message:`Unknown error`);this.schema=e;this.path=t;this.value=n;this.error=r}};function q(e,t,n){try{return P(e)?e[Me].Decode(n):n}catch(r){throw new Sp(e,t,n,r)}}function Cp(e,t,n,r){return k(r)?q(e,n,r.map((r,i)=>Np(e.items,t,`${n}/${i}`,r))):q(e,n,r)}function wp(e,t,n,r){if(!O(r)||Ce(r))return q(e,n,r);const i=Oa(e);const a=i.map(e=>e[0]);const o={...r};for(const[e,r]of i)if(e in o)o[e]=Np(r,t,`${n}/${e}`,o[e]);if(!P(e.unevaluatedProperties))return q(e,n,o);const s=Object.getOwnPropertyNames(o);const c=e.unevaluatedProperties;const l={...o};for(const e of s)if(!a.includes(e))l[e]=q(c,`${n}/${e}`,l[e]);return q(e,n,l)}function Tp(e,t,n,r){const i=globalThis.Object.values(e.$defs);const a=e.$defs[e.$ref];const o=Np(a,[...t,...i],n,r);return q(e,n,o)}function Ep(e,t,n,r){return q(e,n,Np(e.not,t,n,r))}function Dp(e,t,n,r){if(!O(r))return q(e,n,r);const i=_a(e);const a={...r};for(const r of i){if(!D(a,r))continue;if(he(a[r])&&(!ht(e.properties[r])||we.IsExactOptionalProperty(a,r)))continue;a[r]=Np(e.properties[r],t,`${n}/${r}`,a[r])}if(!St(e.additionalProperties))return q(e,n,a);const o=Object.getOwnPropertyNames(a);const s=e.additionalProperties;const c={...a};for(const e of o)if(!i.includes(e))c[e]=q(s,`${n}/${e}`,c[e]);return q(e,n,c)}function Op(e,t,n,r){if(!O(r))return q(e,n,r);const i=Object.getOwnPropertyNames(e.patternProperties)[0];const a=new RegExp(i);const o={...r};for(const s of Object.getOwnPropertyNames(r))if(a.test(s))o[s]=Np(e.patternProperties[i],t,`${n}/${s}`,o[s]);if(!St(e.additionalProperties))return q(e,n,o);const s=Object.getOwnPropertyNames(o);const c=e.additionalProperties;const l={...o};for(const e of s)if(!a.test(e))l[e]=q(c,`${n}/${e}`,l[e]);return q(e,n,l)}function kp(e,t,n,r){const i=bu(e,t);return q(e,n,Np(i,t,n,r))}function Ap(e,t,n,r){const i=bu(e,t);return q(e,n,Np(i,t,n,r))}function jp(e,t,n,r){return k(r)&&k(e.items)?q(e,n,e.items.map((e,i)=>Np(e,t,`${n}/${i}`,r[i]))):q(e,n,r)}function Mp(e,t,n,r){for(const i of e.anyOf){if(!Od(i,t,r))continue;const a=Np(i,t,n,r);return q(e,n,a)}return q(e,n,r)}function Np(e,t,n,r){const i=yu(e,t);const a=e;switch(e[M]){case`Array`:return Cp(a,i,n,r);case`Import`:return Tp(a,i,n,r);case`Intersect`:return wp(a,i,n,r);case`Not`:return Ep(a,i,n,r);case`Object`:return Dp(a,i,n,r);case`Record`:return Op(a,i,n,r);case`Ref`:return kp(a,i,n,r);case`Symbol`:return q(a,n,r);case`This`:return Ap(a,i,n,r);case`Tuple`:return jp(a,i,n,r);case`Union`:return Mp(a,i,n,r);default:return q(a,n,r)}}function Pp(e,t,n){return Np(e,t,``,n)}var Fp=class extends je{constructor(e,t,n){super(`The encoded value does not match the expected schema`);this.schema=e;this.value=t;this.error=n}};var Ip=class extends je{constructor(e,t,n,r){super(`${r instanceof Error?r.message:`Unknown error`}`);this.schema=e;this.path=t;this.value=n;this.error=r}};function Lp(e,t,n){try{return P(e)?e[Me].Encode(n):n}catch(r){throw new Ip(e,t,n,r)}}function Rp(e,t,n,r){const i=Lp(e,n,r);return k(i)?i.map((r,i)=>Jp(e.items,t,`${n}/${i}`,r)):i}function zp(e,t,n,r){const i=globalThis.Object.values(e.$defs);const a=e.$defs[e.$ref];const o=Lp(e,n,r);return Jp(a,[...t,...i],n,o)}function Bp(e,t,n,r){const i=Lp(e,n,r);if(!O(r)||Ce(r))return i;const a=Oa(e);const o=a.map(e=>e[0]);const s={...i};for(const[e,r]of a)if(e in s)s[e]=Jp(r,t,`${n}/${e}`,s[e]);if(!P(e.unevaluatedProperties))return s;const c=Object.getOwnPropertyNames(s);const l=e.unevaluatedProperties;const u={...s};for(const e of c)if(!o.includes(e))u[e]=Lp(l,`${n}/${e}`,u[e]);return u}function Vp(e,t,n,r){return Lp(e.not,n,Lp(e,n,r))}function Hp(e,t,n,r){const i=Lp(e,n,r);if(!O(i))return i;const a=_a(e);const o={...i};for(const r of a){if(!D(o,r))continue;if(he(o[r])&&(!ht(e.properties[r])||we.IsExactOptionalProperty(o,r)))continue;o[r]=Jp(e.properties[r],t,`${n}/${r}`,o[r])}if(!St(e.additionalProperties))return o;const s=Object.getOwnPropertyNames(o);const c=e.additionalProperties;const l={...o};for(const e of s)if(!a.includes(e))l[e]=Lp(c,`${n}/${e}`,l[e]);return l}function Up(e,t,n,r){const i=Lp(e,n,r);if(!O(r))return i;const a=Object.getOwnPropertyNames(e.patternProperties)[0];const o=new RegExp(a);const s={...i};for(const i of Object.getOwnPropertyNames(r))if(o.test(i))s[i]=Jp(e.patternProperties[a],t,`${n}/${i}`,s[i]);if(!St(e.additionalProperties))return s;const c=Object.getOwnPropertyNames(s);const l=e.additionalProperties;const u={...s};for(const e of c)if(!o.test(e))u[e]=Lp(l,`${n}/${e}`,u[e]);return u}function Wp(e,t,n,r){const i=bu(e,t);const a=Jp(i,t,n,r);return Lp(e,n,a)}function Gp(e,t,n,r){const i=bu(e,t);const a=Jp(i,t,n,r);return Lp(e,n,a)}function Kp(e,t,n,r){const i=Lp(e,n,r);return k(e.items)?e.items.map((e,r)=>Jp(e,t,`${n}/${r}`,i[r])):[]}function qp(e,t,n,r){for(const i of e.anyOf){if(!Od(i,t,r))continue;const a=Jp(i,t,n,r);return Lp(e,n,a)}for(const i of e.anyOf){const a=Jp(i,t,n,r);if(!Od(e,t,a))continue;return Lp(e,n,a)}return Lp(e,n,r)}function Jp(e,t,n,r){const i=yu(e,t);const a=e;switch(e[M]){case`Array`:return Rp(a,i,n,r);case`Import`:return zp(a,i,n,r);case`Intersect`:return Bp(a,i,n,r);case`Not`:return Vp(a,i,n,r);case`Object`:return Hp(a,i,n,r);case`Record`:return Up(a,i,n,r);case`Ref`:return Wp(a,i,n,r);case`This`:return Gp(a,i,n,r);case`Tuple`:return Kp(a,i,n,r);case`Union`:return qp(a,i,n,r);default:return Lp(a,n,r)}}function Yp(e,t,n){return Jp(e,t,``,n)}function Xp(e,t){return P(e)||dm(e.items,t)}function Zp(e,t){return P(e)||dm(e.items,t)}function Qp(e,t){return P(e)||dm(e.returns,t)||e.parameters.some(e=>dm(e,t))}function $p(e,t){return P(e)||dm(e.returns,t)||e.parameters.some(e=>dm(e,t))}function em(e,t){return P(e)||P(e.unevaluatedProperties)||e.allOf.some(e=>dm(e,t))}function tm(e,t){const n=globalThis.Object.getOwnPropertyNames(e.$defs).reduce((t,n)=>[...t,e.$defs[n]],[]);const r=e.$defs[e.$ref];return P(e)||dm(r,[...n,...t])}function nm(e,t){return P(e)||dm(e.items,t)}function rm(e,t){return P(e)||dm(e.not,t)}function im(e,t){return P(e)||Object.values(e.properties).some(e=>dm(e,t))||St(e.additionalProperties)&&dm(e.additionalProperties,t)}function am(e,t){return P(e)||dm(e.item,t)}function om(e,t){const n=Object.getOwnPropertyNames(e.patternProperties)[0];const r=e.patternProperties[n];return P(e)||dm(r,t)||St(e.additionalProperties)&&P(e.additionalProperties)}function sm(e,t){if(P(e))return true;return dm(bu(e,t),t)}function cm(e,t){if(P(e))return true;return dm(bu(e,t),t)}function lm(e,t){return P(e)||!he(e.items)&&e.items.some(e=>dm(e,t))}function um(e,t){return P(e)||e.anyOf.some(e=>dm(e,t))}function dm(e,t){const n=yu(e,t);const r=e;if(e.$id&&fm.has(e.$id))return false;if(e.$id)fm.add(e.$id);switch(e[M]){case`Array`:return Xp(r,n);case`AsyncIterator`:return Zp(r,n);case`Constructor`:return Qp(r,n);case`Function`:return $p(r,n);case`Import`:return tm(r,n);case`Intersect`:return em(r,n);case`Iterator`:return nm(r,n);case`Not`:return rm(r,n);case`Object`:return im(r,n);case`Promise`:return am(r,n);case`Record`:return om(r,n);case`Ref`:return sm(r,n);case`This`:return cm(r,n);case`Tuple`:return lm(r,n);case`Union`:return um(r,n);default:return P(e)}}const fm=new Set;function pm(e,t){fm.clear();return dm(e,t)}function mm(...e){const[t,n,r]=e.length===3?[e[0],e[1],e[2]]:[e[0],[],e[1]];if(!Od(t,n,r))throw new xp(t,r,hf(t,n,r).First());return pm(t,n)?Pp(t,n,r):r}function hm(e,t){const n=D(e,`default`)?e.default:void 0;const r=xe(n)?n():Cf(n);return he(t)?r:O(t)&&O(r)?Object.assign(r,t):t}function gm(e){return xt(e)&&`default`in e}function _m(e,t,n){if(k(n)){for(let r=0;r<n.length;r++)n[r]=Dm(e.items,t,n[r]);return n}const r=hm(e,n);if(!k(r))return r;for(let n=0;n<r.length;n++)r[n]=Dm(e.items,t,r[n]);return r}function vm(e,t,n){return T(n)?n:hm(e,n)}function ym(e,t,n){const r=globalThis.Object.values(e.$defs);const i=e.$defs[e.$ref];return Dm(i,[...t,...r],n)}function bm(e,t,n){const r=hm(e,n);return e.allOf.reduce((e,n)=>{const i=Dm(n,t,r);return O(i)?{...e,...i}:i},{})}function xm(e,t,n){const r=hm(e,n);if(!O(r))return r;const i=Object.getOwnPropertyNames(e.properties);for(const n of i){const i=Dm(e.properties[n],t,r[n]);if(he(i))continue;r[n]=Dm(e.properties[n],t,r[n])}if(!gm(e.additionalProperties))return r;for(const n of Object.getOwnPropertyNames(r)){if(i.includes(n))continue;r[n]=Dm(e.additionalProperties,t,r[n])}return r}function Sm(e,t,n){const r=hm(e,n);if(!O(r))return r;const i=e.additionalProperties;const[a,o]=Object.entries(e.patternProperties)[0];const s=new RegExp(a);for(const e of Object.getOwnPropertyNames(r)){if(!(s.test(e)&&gm(o)))continue;r[e]=Dm(o,t,r[e])}if(!gm(i))return r;for(const e of Object.getOwnPropertyNames(r)){if(s.test(e))continue;r[e]=Dm(i,t,r[e])}return r}function Cm(e,t,n){return Dm(bu(e,t),t,hm(e,n))}function wm(e,t,n){return Dm(bu(e,t),t,n)}function Tm(e,t,n){const r=hm(e,n);if(!k(r)||he(e.items))return r;const[i,a]=[e.items,Math.max(e.items.length,r.length)];for(let e=0;e<a;e++)if(e<i.length)r[e]=Dm(i[e],t,r[e]);return r}function Em(e,t,n){const r=hm(e,n);for(const n of e.anyOf){const e=Dm(n,t,Cf(r));if(Od(n,t,e))return e}return r}function Dm(e,t,n){const r=yu(e,t);const i=e;switch(i[M]){case`Array`:return _m(i,r,n);case`Date`:return vm(i,r,n);case`Import`:return ym(i,r,n);case`Intersect`:return bm(i,r,n);case`Object`:return xm(i,r,n);case`Record`:return Sm(i,r,n);case`Ref`:return Cm(i,r,n);case`This`:return wm(i,r,n);case`Tuple`:return Tm(i,r,n);case`Union`:return Em(i,r,n);default:return hm(i,n)}}function Om(...e){return e.length===3?Dm(e[0],e[1],e[2]):Dm(e[0],[],e[1])}function km(...e){const[t,n,r]=e.length===3?[e[0],e[1],e[2]]:[e[0],[],e[1]];const i=pm(t,n)?Yp(t,n,r):r;if(!Od(t,n,i))throw new Fp(t,i,hf(t,n,i).First());return i}var Am=class{constructor(e,t,n,r){this.schema=e;this.references=t;this.checkFunc=n;this.code=r;this.hasTransform=pm(e,t)}Code(){return this.code}Schema(){return this.schema}References(){return this.references}Errors(e){return hf(this.schema,this.references,e)}Check(e){return this.checkFunc(e)}Decode(e){if(!this.checkFunc(e))throw new xp(this.schema,e,this.Errors(e).First());return this.hasTransform?Pp(this.schema,this.references,e):e}Encode(e){const t=this.hasTransform?Yp(this.schema,this.references,e):e;if(!this.checkFunc(t))throw new Fp(this.schema,e,this.Errors(e).First());return t}};var jm;(function(e){function t(e){return e===36}e.DollarSign=t;function n(e){return e===95}e.IsUnderscore=n;function r(e){return e>=65&&e<=90||e>=97&&e<=122}e.IsAlpha=r;function i(e){return e>=48&&e<=57}e.IsNumeric=i})(jm||(jm={}));var Mm;(function(e){function t(e){if(e.length===0)return false;return jm.IsNumeric(e.charCodeAt(0))}function n(e){if(t(e))return false;for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);const r=jm.IsAlpha(n)||jm.IsNumeric(n)||jm.DollarSign(n)||jm.IsUnderscore(n);if(!r)return false}return true}function r(e){return e.replace(/'/g,`\\'`)}function i(e,t){return n(t)?`${e}.${t}`:`${e}['${r(t)}']`}e.Encode=i})(Mm||(Mm={}));var Nm;(function(e){function t(e){const t=[];for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);if(jm.IsNumeric(r)||jm.IsAlpha(r))t.push(e.charAt(n));else t.push(`_${r}_`)}return t.join(``).replace(/__/g,`_`)}e.Encode=t})(Nm||(Nm={}));var Pm;(function(e){function t(e){return e.replace(/'/g,`\\'`)}e.Escape=t})(Pm||(Pm={}));var Fm=class extends je{constructor(e){super(`Unknown type`);this.schema=e}};var Im=class extends je{constructor(e){super(`Preflight validation check failed to guard for the given schema`);this.schema=e}};var Lm;(function(e){function t(e,t,n){return we.ExactOptionalPropertyTypes?`('${t}' in ${e} ? ${n} : true)`:`(${Mm.Encode(e,t)} !== undefined ? ${n} : true)`}e.IsExactOptionalProperty=t;function n(e){return!we.AllowArrayObject?`(typeof ${e} === 'object' && ${e} !== null && !Array.isArray(${e}))`:`(typeof ${e} === 'object' && ${e} !== null)`}e.IsObjectLike=n;function r(e){return!we.AllowArrayObject?`(typeof ${e} === 'object' && ${e} !== null && !Array.isArray(${e}) && !(${e} instanceof Date) && !(${e} instanceof Uint8Array))`:`(typeof ${e} === 'object' && ${e} !== null && !(${e} instanceof Date) && !(${e} instanceof Uint8Array))`}e.IsRecordLike=r;function i(e){return we.AllowNaN?`typeof ${e} === 'number'`:`Number.isFinite(${e})`}e.IsNumberLike=i;function a(e){return we.AllowNullVoid?`(${e} === undefined || ${e} === null)`:`${e} === undefined`}e.IsVoidLike=a})(Lm||(Lm={}));var Rm;(function(e){function t(e){return e[M]===`Any`||e[M]===`Unknown`}function*n(e,t,n){yield`true`}function*r(e,t,n){yield`true`}function*i(e,t,n){yield`Array.isArray(${n})`;const[r,i]=[D(`value`,`any`),D(`acc`,`number`)];if(A(e.maxItems))yield`${n}.length <= ${e.maxItems}`;if(A(e.minItems))yield`${n}.length >= ${e.minItems}`;const a=fe(e.items,t,`value`);yield`${n}.every((${r}) => ${a})`;if(z(e.contains)||A(e.minContains)||A(e.maxContains)){const a=z(e.contains)?e.contains:Zn();const o=fe(a,t,`value`);const s=A(e.minContains)?[`(count >= ${e.minContains})`]:[];const c=A(e.maxContains)?[`(count <= ${e.maxContains})`]:[];const l=`const count = value.reduce((${i}, ${r}) => ${o} ? acc + 1 : acc, 0)`;const u=[`(count > 0)`,...s,...c].join(` && `);yield`((${r}) => { ${l}; return ${u}})(${n})`}if(e.uniqueItems===true){const e=`const hashed = hash(element); if(set.has(hashed)) { return false } else { set.add(hashed) } } return true`;const t=`const set = new Set(); for(const element of value) { ${e} }`;yield`((${r}) => { ${t} )(${n})`}}function*a(e,t,n){yield`(typeof value === 'object' && Symbol.asyncIterator in ${n})`}function*o(e,t,n){yield`(typeof ${n} === 'bigint')`;if(ye(e.exclusiveMaximum))yield`${n} < BigInt(${e.exclusiveMaximum})`;if(ye(e.exclusiveMinimum))yield`${n} > BigInt(${e.exclusiveMinimum})`;if(ye(e.maximum))yield`${n} <= BigInt(${e.maximum})`;if(ye(e.minimum))yield`${n} >= BigInt(${e.minimum})`;if(ye(e.multipleOf))yield`(${n} % BigInt(${e.multipleOf})) === 0`}function*s(e,t,n){yield`(typeof ${n} === 'boolean')`}function*c(e,t,n){yield*w(e.returns,t,`${n}.prototype`)}function*l(e,t,n){yield`(${n} instanceof Date) && Number.isFinite(${n}.getTime())`;if(A(e.exclusiveMaximumTimestamp))yield`${n}.getTime() < ${e.exclusiveMaximumTimestamp}`;if(A(e.exclusiveMinimumTimestamp))yield`${n}.getTime() > ${e.exclusiveMinimumTimestamp}`;if(A(e.maximumTimestamp))yield`${n}.getTime() <= ${e.maximumTimestamp}`;if(A(e.minimumTimestamp))yield`${n}.getTime() >= ${e.minimumTimestamp}`;if(A(e.multipleOfTimestamp))yield`(${n}.getTime() % ${e.multipleOfTimestamp}) === 0`}function*u(e,t,n){yield`(typeof ${n} === 'function')`}function*d(e,t,n){const r=globalThis.Object.getOwnPropertyNames(e.$defs).reduce((t,n)=>{return[...t,e.$defs[n]]},[]);yield*w(na(e.$ref),[...t,...r],n)}function*f(e,t,n){yield`Number.isInteger(${n})`;if(A(e.exclusiveMaximum))yield`${n} < ${e.exclusiveMaximum}`;if(A(e.exclusiveMinimum))yield`${n} > ${e.exclusiveMinimum}`;if(A(e.maximum))yield`${n} <= ${e.maximum}`;if(A(e.minimum))yield`${n} >= ${e.minimum}`;if(A(e.multipleOf))yield`(${n} % ${e.multipleOf}) === 0`}function*p(e,t,n){const r=e.allOf.map(e=>fe(e,t,n)).join(` && `);if(e.unevaluatedProperties===false){const t=E(`${new RegExp(ya(e))};`);const i=`Object.getOwnPropertyNames(${n}).every(key => ${t}.test(key))`;yield`(${r} && ${i})`}else if(z(e.unevaluatedProperties)){const i=E(`${new RegExp(ya(e))};`);const a=`Object.getOwnPropertyNames(${n}).every(key => ${i}.test(key) || ${fe(e.unevaluatedProperties,t,`${n}[key]`)})`;yield`(${r} && ${a})`}else yield`(${r})`}function*m(e,t,n){yield`(typeof value === 'object' && Symbol.iterator in ${n})`}function*h(e,t,n){if(typeof e.const===`number`||typeof e.const===`boolean`)yield`(${n} === ${e.const})`;else yield`(${n} === '${Pm.Escape(e.const)}')`}function*g(e,t,n){yield`false`}function*_(e,t,n){const r=fe(e.not,t,n);yield`(!${r})`}function*ee(e,t,n){yield`(${n} === null)`}function*v(e,t,n){yield Lm.IsNumberLike(n);if(A(e.exclusiveMaximum))yield`${n} < ${e.exclusiveMaximum}`;if(A(e.exclusiveMinimum))yield`${n} > ${e.exclusiveMinimum}`;if(A(e.maximum))yield`${n} <= ${e.maximum}`;if(A(e.minimum))yield`${n} >= ${e.minimum}`;if(A(e.multipleOf))yield`(${n} % ${e.multipleOf}) === 0`}function*y(e,n,r){yield Lm.IsObjectLike(r);if(A(e.minProperties))yield`Object.getOwnPropertyNames(${r}).length >= ${e.minProperties}`;if(A(e.maxProperties))yield`Object.getOwnPropertyNames(${r}).length <= ${e.maxProperties}`;const i=Object.getOwnPropertyNames(e.properties);for(const a of i){const i=Mm.Encode(r,a);const o=e.properties[a];if(e.required&&e.required.includes(a)){yield*w(o,n,i);if(bs(o)||t(o))yield`('${a}' in ${r})`}else{const e=fe(o,n,i);yield Lm.IsExactOptionalProperty(r,a,e)}}if(e.additionalProperties===false)if(e.required&&e.required.length===i.length)yield`Object.getOwnPropertyNames(${r}).length === ${i.length}`;else{const e=`[${i.map(e=>`'${e}'`).join(`, `)}]`;yield`Object.getOwnPropertyNames(${r}).every(key => ${e}.includes(key))`}if(typeof e.additionalProperties===`object`){const t=fe(e.additionalProperties,n,`${r}[key]`);const a=`[${i.map(e=>`'${e}'`).join(`, `)}]`;yield`(Object.getOwnPropertyNames(${r}).every(key => ${a}.includes(key) || ${t}))`}}function*te(e,t,n){yield`${n} instanceof Promise`}function*b(e,t,n){yield Lm.IsRecordLike(n);if(A(e.minProperties))yield`Object.getOwnPropertyNames(${n}).length >= ${e.minProperties}`;if(A(e.maxProperties))yield`Object.getOwnPropertyNames(${n}).length <= ${e.maxProperties}`;const[r,i]=Object.entries(e.patternProperties)[0];const a=E(`${new RegExp(r)}`);const o=fe(i,t,`value`);const s=z(e.additionalProperties)?fe(e.additionalProperties,t,n):e.additionalProperties===false?`false`:`true`;const c=`(${a}.test(key) ? ${o} : ${s})`;yield`(Object.entries(${n}).every(([key, value]) => ${c}))`}function*x(e,t,n){const r=bu(e,t);if(T.functions.has(e.$ref))return yield`${pe(e.$ref)}(${n})`;yield*w(r,t,n)}function*ne(e,t,n){const r=E(`${new RegExp(e.source,e.flags)};`);yield`(typeof ${n} === 'string')`;if(A(e.maxLength))yield`${n}.length <= ${e.maxLength}`;if(A(e.minLength))yield`${n}.length >= ${e.minLength}`;yield`${r}.test(${n})`}function*S(e,t,n){yield`(typeof ${n} === 'string')`;if(A(e.maxLength))yield`${n}.length <= ${e.maxLength}`;if(A(e.minLength))yield`${n}.length >= ${e.minLength}`;if(e.pattern!==void 0){const t=E(`${new RegExp(e.pattern)};`);yield`${t}.test(${n})`}if(e.format!==void 0)yield`format('${e.format}', ${n})`}function*re(e,t,n){yield`(typeof ${n} === 'symbol')`}function*ie(e,t,n){yield`(typeof ${n} === 'string')`;const r=E(`${new RegExp(e.pattern)};`);yield`${r}.test(${n})`}function*ae(e,t,n){yield`${pe(e.$ref)}(${n})`}function*oe(e,t,n){yield`Array.isArray(${n})`;if(e.items===void 0)return yield`${n}.length === 0`;yield`(${n}.length === ${e.maxItems})`;for(let r=0;r<e.items.length;r++){const i=fe(e.items[r],t,`${n}[${r}]`);yield`${i}`}}function*se(e,t,n){yield`${n} === undefined`}function*ce(e,t,n){const r=e.anyOf.map(e=>fe(e,t,n));yield`(${r.join(` || `)})`}function*C(e,t,n){yield`${n} instanceof Uint8Array`;if(A(e.maxByteLength))yield`(${n}.length <= ${e.maxByteLength})`;if(A(e.minByteLength))yield`(${n}.length >= ${e.minByteLength})`}function*le(e,t,n){yield`true`}function*ue(e,t,n){yield Lm.IsVoidLike(n)}function*de(e,t,n){const r=T.instances.size;T.instances.set(r,e);yield`kind('${e[M]}', ${r}, ${n})`}function*w(e,t,w,fe=true){const E=be(e.$id)?[...t,e]:t;const D=e;if(fe&&be(e.$id)){const n=pe(e.$id);if(T.functions.has(n))return yield`${n}(${w})`;else{T.functions.set(n,`<deferred>`);const r=me(n,e,t,`value`,false);T.functions.set(n,r);return yield`${n}(${w})`}}switch(D[M]){case`Any`:return yield*n(D,E,w);case`Argument`:return yield*r(D,E,w);case`Array`:return yield*i(D,E,w);case`AsyncIterator`:return yield*a(D,E,w);case`BigInt`:return yield*o(D,E,w);case`Boolean`:return yield*s(D,E,w);case`Constructor`:return yield*c(D,E,w);case`Date`:return yield*l(D,E,w);case`Function`:return yield*u(D,E,w);case`Import`:return yield*d(D,E,w);case`Integer`:return yield*f(D,E,w);case`Intersect`:return yield*p(D,E,w);case`Iterator`:return yield*m(D,E,w);case`Literal`:return yield*h(D,E,w);case`Never`:return yield*g(D,E,w);case`Not`:return yield*_(D,E,w);case`Null`:return yield*ee(D,E,w);case`Number`:return yield*v(D,E,w);case`Object`:return yield*y(D,E,w);case`Promise`:return yield*te(D,E,w);case`Record`:return yield*b(D,E,w);case`Ref`:return yield*x(D,E,w);case`RegExp`:return yield*ne(D,E,w);case`String`:return yield*S(D,E,w);case`Symbol`:return yield*re(D,E,w);case`TemplateLiteral`:return yield*ie(D,E,w);case`This`:return yield*ae(D,E,w);case`Tuple`:return yield*oe(D,E,w);case`Undefined`:return yield*se(D,E,w);case`Union`:return yield*ce(D,E,w);case`Uint8Array`:return yield*C(D,E,w);case`Unknown`:return yield*le(D,E,w);case`Void`:return yield*ue(D,E,w);default:if(!Fn(D[M]))throw new Fm(e);return yield*de(D,E,w)}}const T={language:`javascript`,functions:new Map,variables:new Map,instances:new Map};function fe(e,t,n,r=true){return`(${[...w(e,t,n,r)].join(` && `)})`}function pe(e){return`check_${Nm.Encode(e)}`}function E(e){const t=`local_${T.variables.size}`;T.variables.set(t,`const ${t} = ${e}`);return t}function me(e,t,n,r,i=true){const[a,o]=[`
`,e=>``.padStart(e,` `)];const s=D(`value`,`any`);const c=O(`boolean`);const l=[...w(t,n,r,i)].map(e=>`${o(4)}${e}`).join(` &&${a}`);return`function ${e}(${s})${c} {${a}${o(2)}return (${a}${l}${a}${o(2)})\n}`}function D(e,t){const n=T.language===`typescript`?`: ${t}`:``;return`${e}${n}`}function O(e){return T.language===`typescript`?`: ${e}`:``}function he(e,t,n){const r=me(`check`,e,t,`value`);const i=D(`value`,`any`);const a=O(`boolean`);const o=[...T.functions.values()];const s=[...T.variables.values()];const c=be(e.$id)?`return function check(${i})${a} {\n  return ${pe(e.$id)}(value)\n}`:`return ${r}`;return[...s,...o,c].join(`
`)}function ge(...e){const t={language:`javascript`};const[n,r,i]=e.length===2&&k(e[1])?[e[0],e[1],t]:e.length===2&&!k(e[1])?[e[0],[],e[1]]:e.length===3?[e[0],e[1],e[2]]:e.length===1?[e[0],[],t]:[null,[],t];T.language=i.language;T.variables.clear();T.functions.clear();T.instances.clear();if(!z(n))throw new Im(n);for(const e of r)if(!z(e))throw new Im(e);return he(n,r,i)}e.Code=ge;function _e(e,t=[]){const n=ge(e,t,{language:`javascript`});const r=globalThis.Function(`kind`,`format`,`hash`,n);const i=new Map(T.instances);function a(e,t,n){if(!Fn(e)||!i.has(t))return false;const r=Ln(e);const a=i.get(t);return r(a,n)}function o(e,t){if(!jn(e))return false;const n=Nn(e);return n(t)}function s(e){return Wu(e)}const c=r(a,o,s);return new Am(e,t,c,n)}e.Compile=_e})(Rm||(Rm={}));var zm=s(exports=>{Object.defineProperty(exports,`__esModule`,{value:true});exports.parse=s;exports.serialize=u;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/;const n=/^[\u0021-\u003A\u003C-\u007E]*$/;const r=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i;const i=/^[\u0020-\u003A\u003D-\u007E]*$/;const a=Object.prototype.toString;const o=(()=>{const e=function(){};e.prototype=Object.create(null);return e})();function s(e,t){const n=new o;const r=e.length;if(r<2)return n;const i=t?.decode||d;let a=0;do{const t=e.indexOf(`=`,a);if(t===-1)break;const o=e.indexOf(`;`,a);const s=o===-1?r:o;if(t>s){a=e.lastIndexOf(`;`,t-1)+1;continue}const u=c(e,a,t);const d=l(e,t,u);const f=e.slice(u,d);if(n[f]===void 0){let r=c(e,t+1,s);let a=l(e,s,r);const o=i(e.slice(r,a));n[f]=o}a=s+1}while(a<r);return n}function c(e,t,n){do{const n=e.charCodeAt(t);if(n!==32&&n!==9)return t}while(++t<n);return n}function l(e,t,n){while(t>n){const n=e.charCodeAt(--t);if(n!==32&&n!==9)return t+1}return n}function u(e,a,o){const s=o?.encode||encodeURIComponent;if(!t.test(e))throw new TypeError(`argument name is invalid: ${e}`);const c=s(a);if(!n.test(c))throw new TypeError(`argument val is invalid: ${a}`);let l=e+`=`+c;if(!o)return l;if(o.maxAge!==void 0){if(!Number.isInteger(o.maxAge))throw new TypeError(`option maxAge is invalid: ${o.maxAge}`);l+=`; Max-Age=`+o.maxAge}if(o.domain){if(!r.test(o.domain))throw new TypeError(`option domain is invalid: ${o.domain}`);l+=`; Domain=`+o.domain}if(o.path){if(!i.test(o.path))throw new TypeError(`option path is invalid: ${o.path}`);l+=`; Path=`+o.path}if(o.expires){if(!f(o.expires)||!Number.isFinite(o.expires.valueOf()))throw new TypeError(`option expires is invalid: ${o.expires}`);l+=`; Expires=`+o.expires.toUTCString()}if(o.httpOnly)l+=`; HttpOnly`;if(o.secure)l+=`; Secure`;if(o.partitioned)l+=`; Partitioned`;if(o.priority){const e=typeof o.priority===`string`?o.priority.toLowerCase():void 0;switch(e){case`low`:l+=`; Priority=Low`;break;case`medium`:l+=`; Priority=Medium`;break;case`high`:l+=`; Priority=High`;break;default:throw new TypeError(`option priority is invalid: ${o.priority}`)}}if(o.sameSite){const e=typeof o.sameSite===`string`?o.sameSite.toLowerCase():o.sameSite;switch(e){case true:case`strict`:l+=`; SameSite=Strict`;break;case`lax`:l+=`; SameSite=Lax`;break;case`none`:l+=`; SameSite=None`;break;default:throw new TypeError(`option sameSite is invalid: ${o.sameSite}`)}}return l}function d(e){if(e.indexOf(`%`)===-1)return e;try{return decodeURIComponent(e)}catch(t){return e}}function f(e){return a.call(e)===`[object Date]`}});var Bm=s((exports,t)=>{var n=12;var r=0;var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7];function a(e){var t=e.indexOf(`%`);if(t===-1)return e;var a=e.length;var o=``;var c=0;var l=0;var u=t;var d=n;while(t>-1&&t<a){var f=s(e[t+1],4);var p=s(e[t+2],0);var m=f|p;var h=i[m];d=i[256+d+h];l=l<<6|m&i[364+h];if(d===n){o+=e.slice(c,u);o+=l<=65535?String.fromCharCode(l):String.fromCharCode(55232+(l>>10),56320+(l&1023));l=0;c=t+3;t=u=e.indexOf(`%`,c)}else if(d===r)return null;else{t+=3;if(t<a&&e.charCodeAt(t)===37)continue;return null}}return o+e.slice(c)}var o={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,"a":10,"A":10,"b":11,"B":11,"c":12,"C":12,"d":13,"D":13,"e":14,"E":14,"f":15,"F":15};function s(e,t){var n=o[e];return n===void 0?255:n<<t}t.exports=a});var Vm=Symbol.for(`TypeBox.Kind`);var Hm=Symbol.for(`TypeBox.Hint`);var Um=e=>/(\ |-|\t|\n)/.test(e);var Wm=(e,t,n=false)=>{if(typeof t===`number`)return`${e}[${t}]`;if(Um(t))return`${e}${n?`?.`:``}["${t}"]`;return`${e}${n?`?`:``}.${t}`};var Gm=e=>Um(e)?`"${e}"`:e;var Km=(e,t=0,n)=>{if(n.type!==`string`||n.const||n.trusted)return e;let r=``;for(let e=t-1;e>=0;e--)r+=`d.h${e}(`;return r+e+`)`.repeat(t)};var qm=e=>{if(!e.allOf||Vm in e&&(e[Vm]!==`Intersect`||e.type!==`object`))return e;const{allOf:t,...n}=e;n.properties={};if(Vm in n)n[Vm]=`Object`;for(const e of t){if(e.type!==`object`)continue;const{properties:t,required:r,type:i,[Vm]:a,...o}=e;if(r)n.required=n.required?n.required.concat(r):r;Object.assign(n,o);for(const t in e.properties)n.properties[t]=qm(e.properties[t])}return n};var Jm=(e,t,n)=>{const r=e.patternProperties[`^(.*)$`]??e.patternProperties[Object.keys(e.patternProperties)[0]];if(!r)return t;const i=n.array;n.array++;return`(()=>{const ar${i}s=Object.keys(${t}),ar${i}v={};for(let i=0;i<ar${i}s.length;i++){const ar${i}p=${t}[ar${i}s[i]];ar${i}v[ar${i}s[i]]=${Qm(r,`ar${i}p`,n)}}return ar${i}v})()`};var Ym=(e,t,n)=>{const r=n.array;n.array++;const i=t===`v`&&!n.unions.length;let a=``;if(!i)a=`(()=>{`;a+=`const ar${r}v=[`;for(let r=0;r<e.length;r++){if(r!==0)a+=`,`;a+=Qm(e[r],Wm(t,r,n.parentIsOptional),n)}a+=`];`;if(!i)a+=`return ar${r}v})()`;return a};function Xm(e,t=new WeakMap){if(e===null||typeof e!==`object`||typeof e===`function`)return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){const n=new Array(e.length);t.set(e,n);for(let r=0;r<e.length;r++)n[r]=Xm(e[r],t);return n}if(typeof e===`object`){const n=Object.keys(e).concat(Object.getOwnPropertySymbols(e));const r={};for(const i of n)r[i]=Xm(e[i],t);return r}return e}var Zm=(e,t,n)=>{if(n.TypeCompiler===void 0){if(!n.typeCompilerWanred){console.warn(new Error(`[exact-mirror] TypeBox's TypeCompiler is required to use Union`));n.typeCompilerWanred=true}return t}n.unionKeys[t]=1;const r=n.unions.length;const i=n.unions[r]=[];let a=`(()=>{
`;const o=e=>{if(!(Vm in e)||!e.$ref)return e;if(e[Vm]===`This`)return Xm(n.definitions[e.$ref]);else if(e[Vm]===`Ref`)if(!n.modules)console.warn(new Error(`[exact-mirror] modules is required when using nested cyclic reference`));else return n.modules.Import(e.$ref);return e};for(let s=0;s<e.length;s++){let c=o(e[s]);if(Array.isArray(c.anyOf))for(let e=0;e<c.anyOf.length;e++)c.anyOf[e]=o(c.anyOf[e]);else if(c.items)if(Array.isArray(c.items))for(let e=0;e<c.items.length;e++)c.items[e]=o(c.items[e]);else c.items=o(c.items);i.push(Rm.Compile(c));a+=`if(d.unions[${r}][${s}].Check(${t})){return ${Qm(c,t,{...n,recursion:n.recursion+1,parentIsOptional:true})}}
`}a+=`return ${n.removeUnknownUnionType?`undefined`:t}})()`;return a};var Qm=(e,t,n)=>{if(!e)return``;const r=t===`v`&&!n.unions.length;if(Vm in e&&e[Vm]===`Import`&&e.$ref in e.$defs)return Qm(e.$defs[e.$ref],t,{...n,definitions:Object.assign(n.definitions,e.$defs)});if(r&&e.type!==`object`&&e.type!==`array`&&!e.anyOf)return`return ${Km(`v`,n.sanitize?.length,e)}`;if(n.recursion>=n.recursionLimit)return t;let i=``;if(e.$id&&Hm in e)n.definitions[e.$id]=e;switch(e.type){case`object`:if(e[Vm]===`Record`){i=Jm(e,t,n);break}e=qm(e);i+=`{`;if(e.additionalProperties)i+=`...${t}`;const a=Object.keys(e.properties);for(let r=0;r<a.length;r++){const o=a[r];let s=e.required&&!e.required.includes(o)||Array.isArray(e.properties[o].anyOf);const c=Wm(t,o,n.parentIsOptional);if(s){const e=n.array;if(t.startsWith(`ar`)){const t=c.slice(c.indexOf(`.`)+1);const r=n.optionalsInArray;if(r[e])r[e].push(t);else r[e]=[t]}else n.optionals.push(c)}const l=e.properties[o];if(e.additionalProperties&&l.type!==`object`)continue;if(r!==0)i+=`,`;i+=`${Gm(o)}:${s?`${c}===undefined?undefined:`:``}${Qm(l,c,{...n,recursion:n.recursion+1,parentIsOptional:s})}`}i+=`}`;break;case`array`:if(e.items.type!==`object`&&e.items.type!==`array`)if(Array.isArray(e.items)){i=Ym(e.items,t,n);break}else if(r)return`return v`;else if(Vm in e.items&&e.items.$ref&&(e.items[Vm]===`Ref`||e.items[Vm]===`This`))i=Qm(Xm(n.definitions[e.items.$ref]),t,{...n,parentIsOptional:true,recursion:n.recursion+1});else{i=t;break}const o=n.array;n.array++;let s=t;if(r)i=`const ar${o}v=new Array(${t}.length);`;else{s=`ar${o}s`;i=`((${s})=>{const ar${o}v=new Array(${s}.length);`}i+=`for(let i=0;i<${s}.length;i++){const ar${o}p=${s}[i];ar${o}v[i]=${Qm(e.items,`ar${o}p`,n)}`;const c=n.optionalsInArray[o+1];if(c)for(let e=0;e<c.length;e++){const t=`ar${o}v[i].${c[e]}`;i+=`;if(${t}===undefined)delete ${t}`}i+=`}`;if(!r)i+=`return ar${o}v})(${t})`;break;default:if(e.$ref&&e.$ref in n.definitions)return Qm(n.definitions[e.$ref],t,n);if(Array.isArray(e.anyOf)){i=Zm(e.anyOf,t,n);break}i=Km(t,n.sanitize?.length,e);break}if(!r)return i;if(e.type===`array`)return`${i}return ar0v`;i=`const x=${i}
`;for(let e=0;e<n.optionals.length;e++){const t=n.optionals[e];const r=t.slice(1);i+=`if(${t}===undefined`;if(n.unionKeys[t])i+=`||x${r}===undefined`;i+=`)delete x${r.charCodeAt(0)!==63?`?`:``}${r}
`}return`${i}return x`};var $m=(e,{TypeCompiler:t,modules:n,definitions:r,sanitize:i,recursionLimit:a=8,removeUnknownUnionType:o=false}={})=>{const s=[];if(typeof i===`function`)i=[i];const c=Qm(e,`v`,{optionals:[],optionalsInArray:[],array:0,parentIsOptional:false,unions:s,unionKeys:{},TypeCompiler:t,modules:n,definitions:r??n?.$defs??{},sanitize:i,recursion:0,recursionLimit:a,removeUnknownUnionType:o});if(!s.length&&!i?.length)return Function(`v`,c);let l;if(i?.length){l={};for(let e=0;e<i.length;e++)l[`h${e}`]=i[e]}return Function(`d`,`return function mirror(v){${c}}`)({unions:s,...l})};function eh(e){return new DataView(e.buffer,e.byteOffset)}var th,J,nh,rh,ih,ah,oh,sh;var ch=o(()=>{th={len:1,get(e,t){return eh(e).getUint8(t)},put(e,t,n){eh(e).setUint8(t,n);return t+1}};J={len:2,get(e,t){return eh(e).getUint16(t,true)},put(e,t,n){eh(e).setUint16(t,n,true);return t+2}};nh={len:2,get(e,t){return eh(e).getUint16(t)},put(e,t,n){eh(e).setUint16(t,n);return t+2}};rh={len:4,get(e,t){return eh(e).getUint32(t,true)},put(e,t,n){eh(e).setUint32(t,n,true);return t+4}};ih={len:4,get(e,t){return eh(e).getUint32(t)},put(e,t,n){eh(e).setUint32(t,n);return t+4}};ah={len:4,get(e,t){return eh(e).getInt32(t)},put(e,t,n){eh(e).setInt32(t,n);return t+4}};oh={len:8,get(e,t){return eh(e).getBigUint64(t,true)},put(e,t,n){eh(e).setBigUint64(t,n,true);return t+8}};sh=class e{constructor(t,n){this.len=t;if(n&&n.toLowerCase()===`windows-1252`)this.decoder=e.decodeWindows1252;else{const e=new TextDecoder(n);this.decoder=t=>e.decode(t)}}get(e,t=0){const n=e.subarray(t,t+this.len);return this.decoder(n)}static decodeWindows1252(t){let n=``;for(let r=0;r<t.length;r++){const i=t[r];n+=i<128||i>=160?String.fromCharCode(i):e.win1252Map[i-128]}return n}};sh.win1252Map=`€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ`});var lh,uh,dh;var fh=o(()=>{lh=`End-Of-Stream`;uh=class extends Error{constructor(){super(lh);this.name=`EndOfStreamError`}};dh=class extends Error{constructor(e=`The operation was aborted`){super(e);this.name=`AbortError`}}});var ph;var mh=o(()=>{fh();ph=class{constructor(){this.endOfStream=false;this.interrupted=false;this.peekQueue=[]}async peek(e,t=false){const n=await this.read(e,t);this.peekQueue.push(e.subarray(0,n));return n}async read(e,t=false){if(e.length===0)return 0;let n=this.readFromPeekBuffer(e);if(!this.endOfStream)n+=await this.readRemainderFromStream(e.subarray(n),t);if(n===0&&!t)throw new uh;return n}readFromPeekBuffer(e){let t=e.length;let n=0;while(this.peekQueue.length>0&&t>0){const r=this.peekQueue.pop();if(!r)throw new Error(`peekData should be defined`);const i=Math.min(r.length,t);e.set(r.subarray(0,i),n);n+=i;t-=i;if(i<r.length)this.peekQueue.push(r.subarray(i))}return n}async readRemainderFromStream(e,t){let n=0;while(n<e.length&&!this.endOfStream){if(this.interrupted)throw new dh;const r=await this.readFromStream(e.subarray(n),t);if(r===0)break;n+=r}if(!t&&n<e.length)throw new uh;return n}}});var hh;var gh=o(()=>{mh();hh=class extends ph{constructor(e){super();this.reader=e}async abort(){return this.close()}async close(){this.reader.releaseLock()}}});var _h;var vh=o(()=>{gh();_h=class extends hh{async readFromStream(e,t){if(e.length===0)return 0;const n=await this.reader.read(new Uint8Array(e.length),{min:t?void 0:e.length});if(n.done)this.endOfStream=n.done;if(n.value){e.set(n.value);return n.value.length}return 0}}});var yh;var bh=o(()=>{fh();mh();yh=class extends ph{constructor(e){super();this.reader=e;this.buffer=null}writeChunk(e,t){const n=Math.min(t.length,e.length);e.set(t.subarray(0,n));if(n<t.length)this.buffer=t.subarray(n);else this.buffer=null;return n}async readFromStream(e,t){if(e.length===0)return 0;let n=0;if(this.buffer)n+=this.writeChunk(e,this.buffer);while(n<e.length&&!this.endOfStream){const t=await this.reader.read();if(t.done){this.endOfStream=true;break}if(t.value)n+=this.writeChunk(e.subarray(n),t.value)}if(!t&&n===0&&this.endOfStream)throw new uh;return n}abort(){this.interrupted=true;return this.reader.cancel()}async close(){await this.abort();this.reader.releaseLock()}}});function xh(e){try{const t=e.getReader({mode:`byob`});if(t instanceof ReadableStreamDefaultReader)return new yh(t);return new _h(t)}catch(t){if(t instanceof TypeError)return new yh(e.getReader());throw t}}var Sh=o(()=>{vh();bh()});var Ch=o(()=>{fh();Sh()});var wh;var Th=o(()=>{Ch();wh=class{constructor(e){this.numBuffer=new Uint8Array(8);this.position=0;this.onClose=e?.onClose;if(e?.abortSignal)e.abortSignal.addEventListener(`abort`,()=>{this.abort()})}async readToken(e,t=this.position){const n=new Uint8Array(e.len);const r=await this.readBuffer(n,{position:t});if(r<e.len)throw new uh;return e.get(n,0)}async peekToken(e,t=this.position){const n=new Uint8Array(e.len);const r=await this.peekBuffer(n,{position:t});if(r<e.len)throw new uh;return e.get(n,0)}async readNumber(e){const t=await this.readBuffer(this.numBuffer,{length:e.len});if(t<e.len)throw new uh;return e.get(this.numBuffer,0)}async peekNumber(e){const t=await this.peekBuffer(this.numBuffer,{length:e.len});if(t<e.len)throw new uh;return e.get(this.numBuffer,0)}async ignore(e){if(this.fileInfo.size!==void 0){const t=this.fileInfo.size-this.position;if(e>t){this.position+=t;return t}}this.position+=e;return e}async close(){await this.abort();await this.onClose?.()}normalizeOptions(e,t){if(!this.supportsRandomAccess()&&t&&t.position!==void 0&&t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return{mayBeLess:false,offset:0,length:e.length,position:this.position,...t}}abort(){return Promise.resolve()}}});var Eh,Dh;var Oh=o(()=>{Th();Ch();Eh=256e3;Dh=class extends wh{constructor(e,t){super(t);this.streamReader=e;this.fileInfo=t?.fileInfo??{}}async readBuffer(e,t){const n=this.normalizeOptions(e,t);const r=n.position-this.position;if(r>0){await this.ignore(r);return this.readBuffer(e,t)}if(r<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(n.length===0)return 0;const i=await this.streamReader.read(e.subarray(0,n.length),n.mayBeLess);this.position+=i;if((!t||!t.mayBeLess)&&i<n.length)throw new uh;return i}async peekBuffer(e,t){const n=this.normalizeOptions(e,t);let r=0;if(n.position){const t=n.position-this.position;if(t>0){const i=new Uint8Array(n.length+t);r=await this.peekBuffer(i,{mayBeLess:n.mayBeLess});e.set(i.subarray(t));return r-t}if(t<0)throw new Error(`Cannot peek from a negative offset in a stream`)}if(n.length>0){try{r=await this.streamReader.peek(e.subarray(0,n.length),n.mayBeLess)}catch(e){if(t?.mayBeLess&&e instanceof uh)return 0;throw e}if(!n.mayBeLess&&r<n.length)throw new uh}return r}async ignore(e){const t=Math.min(Eh,e);const n=new Uint8Array(t);let r=0;while(r<e){const i=e-r;const a=await this.readBuffer(n,{length:Math.min(t,i)});if(a<0)return a;r+=a}return r}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return false}}});var kh;var Ah=o(()=>{Ch();Th();kh=class extends wh{constructor(e,t){super(t);this.uint8Array=e;this.fileInfo={...t?.fileInfo??{},size:e.length}}async readBuffer(e,t){if(t?.position)this.position=t.position;const n=await this.peekBuffer(e,t);this.position+=n;return n}async peekBuffer(e,t){const n=this.normalizeOptions(e,t);const r=Math.min(this.uint8Array.length-n.position,n.length);if(!n.mayBeLess&&r<n.length)throw new uh;e.set(this.uint8Array.subarray(n.position,n.position+r));return r}close(){return super.close()}supportsRandomAccess(){return true}setPosition(e){this.position=e}}});function jh(e,t){const n=xh(e);const r=t??{};const i=r.onClose;r.onClose=async()=>{await n.close();if(i)return i()};return new Dh(n,r)}function Mh(e,t){return new kh(e,t)}var Nh=o(()=>{Ch();Oh();Ah()});function Ph(e,t){return fg(e,{i:2},t&&t.out,t&&t.dictionary)}function Fh(e,t){var n=mg(e);if(n+8>e.length)dg(6,`invalid gzip data`);return fg(e.subarray(n,-8),{i:2},t&&t.out||new Rh(hg(e)),t&&t.dictionary)}function Ih(e,t){return fg(e.subarray(gg(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}function Lh(e,t){return e[0]==31&&e[1]==139&&e[2]==8?Fh(e,t):(e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31?Ph(e,t):Ih(e,t)}var Rh,zh,Bh,Vh,Hh,Uh,Wh,Gh,Kh,qh,Jh,Yh,Xh,Zh,Qh,$h,eg,tg,ng,rg,ig,ag,og,sg,cg,lg,ug,dg,fg,pg,mg,hg,gg,_g,vg;var yg=o(()=>{Rh=Uint8Array,zh=Uint16Array,Bh=Int32Array;Vh=new Rh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]);Hh=new Rh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]);Uh=new Rh([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);Wh=function(e,t){var n=new zh(31);for(var r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Bh(n[30]);for(var r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return{b:n,r:i}};Gh=Wh(Vh,2),Kh=Gh.b,qh=Gh.r;Kh[28]=258,qh[258]=28;Jh=Wh(Hh,0),Yh=Jh.b,Xh=Jh.r;Zh=new zh(32768);for(var e=0;e<32768;++e){var t=(e&43690)>>1|(e&21845)<<1;t=(t&52428)>>2|(t&13107)<<2;t=(t&61680)>>4|(t&3855)<<4;Zh[e]=((t&65280)>>8|(t&255)<<8)>>1}Qh=function(e,t,n){var r=e.length;var i=0;var a=new zh(t);for(;i<r;++i)if(e[i])++a[e[i]-1];var o=new zh(t);for(i=1;i<t;++i)o[i]=o[i-1]+a[i-1]<<1;var s;if(n){s=new zh(1<<t);var c=15-t;for(i=0;i<r;++i)if(e[i]){var l=i<<4|e[i];var u=t-e[i];var d=o[e[i]-1]++<<u;for(var f=d|(1<<u)-1;d<=f;++d)s[Zh[d]>>c]=l}}else{s=new zh(r);for(i=0;i<r;++i)if(e[i])s[i]=Zh[o[e[i]-1]++]>>15-e[i]}return s};$h=new Rh(288);for(var e=0;e<144;++e)$h[e]=8;for(var e=144;e<256;++e)$h[e]=9;for(var e=256;e<280;++e)$h[e]=7;for(var e=280;e<288;++e)$h[e]=8;eg=new Rh(32);for(var e=0;e<32;++e)eg[e]=5;tg=Qh($h,9,0),ng=Qh($h,9,1);rg=Qh(eg,5,0),ig=Qh(eg,5,1);ag=function(e){var t=e[0];for(var n=1;n<e.length;++n)if(e[n]>t)t=e[n];return t};og=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n};sg=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)};cg=function(e){return(e+7)/8|0};lg=function(e,t,n){if(t==null||t<0)t=0;if(n==null||n>e.length)n=e.length;return new Rh(e.subarray(t,n))};ug=[`unexpected EOF`,`invalid block type`,`invalid length/literal`,`invalid distance`,`stream finished`,`no stream handler`,,`no callback`,`invalid UTF-8 data`,`extra field too long`,`date not in range 1980-2099`,`filename too long`,`stream finishing`,`invalid zip data`];dg=function(e,t,n){var r=new Error(t||ug[e]);r.code=e;if(Error.captureStackTrace)Error.captureStackTrace(r,dg);if(!n)throw r;return r};fg=function(e,t,n,r){var i=e.length,a=r?r.length:0;if(!i||t.f&&!t.l)return n||new Rh(0);var o=!n;var s=o||t.i!=2;var c=t.i;if(o)n=new Rh(i*3);var l=function(e){var t=n.length;if(e>t){var r=new Rh(Math.max(t*2,e));r.set(n);n=r}};var u=t.f||0,d=t.p||0,f=t.b||0,p=t.l,m=t.d,h=t.m,g=t.n;var _=i*8;do{if(!p){u=og(e,d,1);var ee=og(e,d+1,3);d+=3;if(!ee){var v=cg(d)+4,y=e[v-4]|e[v-3]<<8,te=v+y;if(te>i){if(c)dg(0);break}if(s)l(f+y);n.set(e.subarray(v,te),f);t.b=f+=y,t.p=d=te*8,t.f=u;continue}else if(ee==1)p=ng,m=ig,h=9,g=5;else if(ee==2){var b=og(e,d,31)+257,x=og(e,d+10,15)+4;var ne=b+og(e,d+5,31)+1;d+=14;var S=new Rh(ne);var re=new Rh(19);for(var ie=0;ie<x;++ie)re[Uh[ie]]=og(e,d+ie*3,7);d+=x*3;var ae=ag(re),oe=(1<<ae)-1;var se=Qh(re,ae,1);for(var ie=0;ie<ne;){var ce=se[og(e,d,oe)];d+=ce&15;var v=ce>>4;if(v<16)S[ie++]=v;else{var C=0,le=0;if(v==16)le=3+og(e,d,3),d+=2,C=S[ie-1];else if(v==17)le=3+og(e,d,7),d+=3;else if(v==18)le=11+og(e,d,127),d+=7;while(le--)S[ie++]=C}}var ue=S.subarray(0,b),de=S.subarray(b);h=ag(ue);g=ag(de);p=Qh(ue,h,1);m=Qh(de,g,1)}else dg(1);if(d>_){if(c)dg(0);break}}if(s)l(f+131072);var w=(1<<h)-1,T=(1<<g)-1;var fe=d;for(;;fe=d){var C=p[sg(e,d)&w],pe=C>>4;d+=C&15;if(d>_){if(c)dg(0);break}if(!C)dg(2);if(pe<256)n[f++]=pe;else if(pe==256){fe=d,p=null;break}else{var E=pe-254;if(pe>264){var ie=pe-257,me=Vh[ie];E=og(e,d,(1<<me)-1)+Kh[ie];d+=me}var D=m[sg(e,d)&T],O=D>>4;if(!D)dg(3);d+=D&15;var de=Yh[O];if(O>3){var me=Hh[O];de+=sg(e,d)&(1<<me)-1,d+=me}if(d>_){if(c)dg(0);break}if(s)l(f+131072);var k=f+E;if(f<de){var he=a-de,ge=Math.min(de,k);if(he+f<0)dg(3);for(;f<ge;++f)n[f]=r[he+f]}for(;f<k;++f)n[f]=n[f-de]}}t.l=p,t.p=fe,t.b=f,t.f=u;if(p)u=1,t.m=h,t.d=m,t.n=g}while(!u);return f!=n.length&&o?lg(n,0,f):n.subarray(0,f)};pg=new Rh(0);mg=function(e){if(e[0]!=31||e[1]!=139||e[2]!=8)dg(6,`invalid gzip data`);var t=e[3];var n=10;if(t&4)n+=(e[10]|e[11]<<8)+2;for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(t&2)};hg=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0};gg=function(e,t){if((e[0]&15)!=8||e[0]>>4>7||(e[0]<<8|e[1])%31)dg(6,`invalid zlib data`);if((e[1]>>5&1)==+!t)dg(6,`invalid zlib data: `+(e[1]&32?`need`:`unexpected`)+` dictionary`);return(e[1]>>3&4)+2};_g=typeof TextDecoder!=`undefined`&&new TextDecoder;vg=0;try{_g.decode(pg,{stream:true});vg=1}catch(e){}});var bg=s((exports,t)=>{var n=1e3;var r=n*60;var i=r*60;var a=i*24;var o=a*7;var s=a*365.25;t.exports=function(e,t){t=t||{};var n=typeof e;if(n===`string`&&e.length>0)return c(e);else if(n===`number`&&isFinite(e))return t.long?u(e):l(e);throw new Error(`val is not a non-empty string or a valid number. val=`+JSON.stringify(e))};function c(e){e=String(e);if(e.length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var c=parseFloat(t[1]);var l=(t[2]||`ms`).toLowerCase();switch(l){case`years`:case`year`:case`yrs`:case`yr`:case`y`:return c*s;case`weeks`:case`week`:case`w`:return c*o;case`days`:case`day`:case`d`:return c*a;case`hours`:case`hour`:case`hrs`:case`hr`:case`h`:return c*i;case`minutes`:case`minute`:case`mins`:case`min`:case`m`:return c*r;case`seconds`:case`second`:case`secs`:case`sec`:case`s`:return c*n;case`milliseconds`:case`millisecond`:case`msecs`:case`msec`:case`ms`:return c;default:return void 0}}function l(e){var t=Math.abs(e);if(t>=a)return Math.round(e/a)+`d`;if(t>=i)return Math.round(e/i)+`h`;if(t>=r)return Math.round(e/r)+`m`;if(t>=n)return Math.round(e/n)+`s`;return e+`ms`}function u(e){var t=Math.abs(e);if(t>=a)return d(e,t,a,`day`);if(t>=i)return d(e,t,i,`hour`);if(t>=r)return d(e,t,r,`minute`);if(t>=n)return d(e,t,n,`second`);return e+` ms`}function d(e,t,n,r){var i=t>=n*1.5;return Math.round(e/n)+` `+r+(i?`s`:``)}});var xg=s((exports,t)=>{function n(e){n.debug=n;n.default=n;n.coerce=c;n.disable=o;n.enable=i;n.enabled=s;n.humanize=bg();n.destroy=l;Object.keys(e).forEach(t=>{n[t]=e[t]});n.names=[];n.skips=[];n.formatters={};function t(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n);t|=0}return n.colors[Math.abs(t)%n.colors.length]}n.selectColor=t;function n(e){let t;let i=null;let a;let o;function s(...e){if(!s.enabled)return;const r=s;const i=Number(new Date);const a=i-(t||i);r.diff=a;r.prev=t;r.curr=i;t=i;e[0]=n.coerce(e[0]);if(typeof e[0]!==`string`)e.unshift(`%O`);let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,i)=>{if(t===`%%`)return`%`;o++;const a=n.formatters[i];if(typeof a===`function`){const n=e[o];t=a.call(r,n);e.splice(o,1);o--}return t});n.formatArgs.call(r,e);const c=r.log||n.log;c.apply(r,e)}s.namespace=e;s.useColors=n.useColors();s.color=n.selectColor(e);s.extend=r;s.destroy=n.destroy;Object.defineProperty(s,`enabled`,{enumerable:true,configurable:false,get:()=>{if(i!==null)return i;if(a!==n.namespaces){a=n.namespaces;o=n.enabled(e)}return o},set:e=>{i=e}});if(typeof n.init===`function`)n.init(s);return s}function r(e,t){const r=n(this.namespace+(typeof t===`undefined`?`:`:t)+e);r.log=this.log;return r}function i(e){n.save(e);n.namespaces=e;n.names=[];n.skips=[];const t=(typeof e===`string`?e:``).trim().replace(/\s+/g,`,`).split(`,`).filter(Boolean);for(const e of t)if(e[0]===`-`)n.skips.push(e.slice(1));else n.names.push(e)}function a(e,t){let n=0;let r=0;let i=-1;let a=0;while(n<e.length)if(r<t.length&&(t[r]===e[n]||t[r]===`*`))if(t[r]===`*`){i=r;a=n;r++}else{n++;r++}else if(i!==-1){r=i+1;a++;n=a}else return false;while(r<t.length&&t[r]===`*`)r++;return r===t.length}function o(){const e=[...n.names,...n.skips.map(e=>`-`+e)].join(`,`);n.enable(``);return e}function s(e){for(const t of n.skips)if(a(e,t))return false;for(const t of n.names)if(a(e,t))return true;return false}function c(e){if(e instanceof Error)return e.stack||e.message;return e}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}n.enable(n.load());return n}t.exports=n});var Sg=s((exports,t)=>{exports.formatArgs=r;exports.save=i;exports.load=a;exports.useColors=n;exports.storage=o();exports.destroy=(()=>{let e=false;return()=>{if(!e){e=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();exports.colors=[`#0000CC`,`#0000FF`,`#0033CC`,`#0033FF`,`#0066CC`,`#0066FF`,`#0099CC`,`#0099FF`,`#00CC00`,`#00CC33`,`#00CC66`,`#00CC99`,`#00CCCC`,`#00CCFF`,`#3300CC`,`#3300FF`,`#3333CC`,`#3333FF`,`#3366CC`,`#3366FF`,`#3399CC`,`#3399FF`,`#33CC00`,`#33CC33`,`#33CC66`,`#33CC99`,`#33CCCC`,`#33CCFF`,`#6600CC`,`#6600FF`,`#6633CC`,`#6633FF`,`#66CC00`,`#66CC33`,`#9900CC`,`#9900FF`,`#9933CC`,`#9933FF`,`#99CC00`,`#99CC33`,`#CC0000`,`#CC0033`,`#CC0066`,`#CC0099`,`#CC00CC`,`#CC00FF`,`#CC3300`,`#CC3333`,`#CC3366`,`#CC3399`,`#CC33CC`,`#CC33FF`,`#CC6600`,`#CC6633`,`#CC9900`,`#CC9933`,`#CCCC00`,`#CCCC33`,`#FF0000`,`#FF0033`,`#FF0066`,`#FF0099`,`#FF00CC`,`#FF00FF`,`#FF3300`,`#FF3333`,`#FF3366`,`#FF3399`,`#FF33CC`,`#FF33FF`,`#FF6600`,`#FF6633`,`#FF9900`,`#FF9933`,`#FFCC00`,`#FFCC33`];function n(){if(typeof window!==`undefined`&&window.process&&(window.process.type===`renderer`||window.process.__nwjs))return true;if(typeof navigator!==`undefined`&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return false;let e;return typeof document!==`undefined`&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!==`undefined`&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!==`undefined`&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator!==`undefined`&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(e){e[0]=(this.useColors?`%c`:``)+this.namespace+(this.useColors?` %c`:` `)+e[0]+(this.useColors?`%c `:` `)+`+`+t.exports.humanize(this.diff);if(!this.useColors)return;const n=`color: `+this.color;e.splice(1,0,n,`color: inherit`);let r=0;let i=0;e[0].replace(/%[a-zA-Z%]/g,e=>{if(e===`%%`)return;r++;if(e===`%c`)i=r});e.splice(i,0,n)}exports.log=console.debug||console.log||(()=>{});function i(t){try{if(t)exports.storage.setItem(`debug`,t);else exports.storage.removeItem(`debug`)}catch(e){}}function a(){let t;try{t=exports.storage.getItem(`debug`)||exports.storage.getItem(`DEBUG`)}catch(e){}if(!t&&typeof process!==`undefined`&&`env`in process)t=process.env.DEBUG;return t}function o(){try{return localStorage}catch(e){}}t.exports=xg()(exports);const{formatters:s}=t.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return`[UnexpectedJSONParseError]: `+e.message}}});var Cg,wg,Tg,Eg,Dg;var Og=o(()=>{ch();Cg={LocalFileHeader:67324752,DataDescriptor:134695760,CentralFileHeader:33639248,EndOfCentralDirectory:101010256};wg={get(e){const t=J.get(e,6);return{signature:rh.get(e,0),compressedSize:rh.get(e,8),uncompressedSize:rh.get(e,12)}},len:16};Tg={get(e){const t=J.get(e,6);return{signature:rh.get(e,0),minVersion:J.get(e,4),dataDescriptor:!!(t&8),compressedMethod:J.get(e,8),compressedSize:rh.get(e,18),uncompressedSize:rh.get(e,22),filenameLength:J.get(e,26),extraFieldLength:J.get(e,28),filename:null}},len:30};Eg={get(e){return{signature:rh.get(e,0),nrOfThisDisk:J.get(e,4),nrOfThisDiskWithTheStart:J.get(e,6),nrOfEntriesOnThisDisk:J.get(e,8),nrOfEntriesOfSize:J.get(e,10),sizeOfCd:rh.get(e,12),offsetOfStartOfCd:rh.get(e,16),zipFileCommentLength:J.get(e,20)}},len:22};Dg={get(e){const t=J.get(e,8);return{signature:rh.get(e,0),minVersion:J.get(e,6),dataDescriptor:!!(t&8),compressedMethod:J.get(e,10),compressedSize:rh.get(e,20),uncompressedSize:rh.get(e,24),filenameLength:J.get(e,28),extraFieldLength:J.get(e,30),fileCommentLength:J.get(e,32),relativeOffsetOfLocalHeader:rh.get(e,42),filename:null}},len:46}});function kg(e){const t=new Uint8Array(rh.len);rh.put(t,0,e);return t}function Ag(e,t){const n=e.length;const r=t.length;if(r>n)return-1;for(let i=0;i<=n-r;i++){let n=true;for(let a=0;a<r;a++)if(e[i+a]!==t[a]){n=false;break}if(n)return i}return-1}function jg(e){const t=e.reduce((e,t)=>e+t.length,0);const n=new Uint8Array(t);let r=0;for(const t of e){n.set(t,r);r+=t.length}return n}var Mg,Ng,Pg,Fg,Ig,Lg;var Rg=o(()=>{ch();yg();Mg=u(Sg(),1);Og();Ng=(0,Mg.default)(`tokenizer:inflate`);Pg=256*1024;Fg=kg(Cg.DataDescriptor);Ig=kg(Cg.EndOfCentralDirectory);Lg=class{constructor(e){this.tokenizer=e;this.syncBuffer=new Uint8Array(Pg)}async isZip(){return await this.peekSignature()===Cg.LocalFileHeader}peekSignature(){return this.tokenizer.peekToken(rh)}async findEndOfCentralDirectoryLocator(){const e=this.tokenizer;const t=Math.min(16*1024,e.fileInfo.size);const n=this.syncBuffer.subarray(0,t);await this.tokenizer.readBuffer(n,{position:e.fileInfo.size-t});for(let r=n.length-4;r>=0;r--)if(n[r]===Ig[0]&&n[r+1]===Ig[1]&&n[r+2]===Ig[2]&&n[r+3]===Ig[3])return e.fileInfo.size-t+r;return-1}async readCentralDirectory(){if(!this.tokenizer.supportsRandomAccess()){Ng(`Cannot reading central-directory without random-read support`);return}Ng(`Reading central-directory...`);const e=this.tokenizer.position;const t=await this.findEndOfCentralDirectoryLocator();if(t>0){Ng(`Central-directory 32-bit signature found`);const n=await this.tokenizer.readToken(Eg,t);const r=[];this.tokenizer.setPosition(n.offsetOfStartOfCd);for(let e=0;e<n.nrOfEntriesOfSize;++e){const t=await this.tokenizer.readToken(Dg);if(t.signature!==Cg.CentralFileHeader)throw new Error(`Expected Central-File-Header signature`);t.filename=await this.tokenizer.readToken(new sh(t.filenameLength,`utf-8`));await this.tokenizer.ignore(t.extraFieldLength);await this.tokenizer.ignore(t.fileCommentLength);r.push(t);Ng(`Add central-directory file-entry: n=${e+1}/${r.length}: filename=${r[e].filename}`)}this.tokenizer.setPosition(e);return r}this.tokenizer.setPosition(e)}async unzip(e){const t=await this.readCentralDirectory();if(t)return this.iterateOverCentralDirectory(t,e);let n=false;do{const t=await this.readLocalFileHeader();if(!t)break;const r=e(t);n=!!r.stop;let i=void 0;await this.tokenizer.ignore(t.extraFieldLength);if(t.dataDescriptor&&t.compressedSize===0){const e=[];let n=Pg;Ng(`Compressed-file-size unknown, scanning for next data-descriptor-signature....`);let i=-1;while(i<0&&n===Pg){n=await this.tokenizer.peekBuffer(this.syncBuffer,{mayBeLess:true});i=Ag(this.syncBuffer.subarray(0,n),Fg);const t=i>=0?i:n;if(r.handler){const n=new Uint8Array(t);await this.tokenizer.readBuffer(n);e.push(n)}else await this.tokenizer.ignore(t)}Ng(`Found data-descriptor-signature at pos=${this.tokenizer.position}`);if(r.handler)await this.inflate(t,jg(e),r.handler)}else if(r.handler){Ng(`Reading compressed-file-data: ${t.compressedSize} bytes`);i=new Uint8Array(t.compressedSize);await this.tokenizer.readBuffer(i);await this.inflate(t,i,r.handler)}else{Ng(`Ignoring compressed-file-data: ${t.compressedSize} bytes`);await this.tokenizer.ignore(t.compressedSize)}Ng(`Reading data-descriptor at pos=${this.tokenizer.position}`);if(t.dataDescriptor){const e=await this.tokenizer.readToken(wg);if(e.signature!==134695760)throw new Error(`Expected data-descriptor-signature at position ${this.tokenizer.position-wg.len}`)}}while(!n)}async iterateOverCentralDirectory(e,t){for(const n of e){const e=t(n);if(e.handler){this.tokenizer.setPosition(n.relativeOffsetOfLocalHeader);const t=await this.readLocalFileHeader();if(t){await this.tokenizer.ignore(t.extraFieldLength);const r=new Uint8Array(n.compressedSize);await this.tokenizer.readBuffer(r);await this.inflate(t,r,e.handler)}}if(e.stop)break}}inflate(e,t,n){if(e.compressedMethod===0)return n(t);Ng(`Decompress filename=${e.filename}, compressed-size=${t.length}`);const r=Lh(t);return n(r)}async readLocalFileHeader(){const e=await this.tokenizer.peekToken(rh);if(e===Cg.LocalFileHeader){const e=await this.tokenizer.readToken(Tg);e.filename=await this.tokenizer.readToken(new sh(e.filenameLength,`utf-8`));return e}if(e===Cg.CentralFileHeader)return false;if(e===3759263696)throw new Error(`Encrypted ZIP`);throw new Error(`Unexpected signature`)}}});function zg(e){const{byteLength:t}=e;if(t===6)return e.getUint16(0)*2**32+e.getUint32(2);if(t===5)return e.getUint8(0)*2**32+e.getUint32(1);if(t===4)return e.getUint32(0);if(t===3)return e.getUint8(0)*2**16+e.getUint16(1);if(t===2)return e.getUint16(0);if(t===1)return e.getUint8(0)}var Bg,Vg,Hg;var Ug=o(()=>{Bg={utf8:new globalThis.TextDecoder(`utf8`)};Vg=new globalThis.TextEncoder;Hg=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,`0`))});function Wg(e){return[...e].map(e=>e.charCodeAt(0))}function Gg(e,t=0){const n=Number.parseInt(new sh(6).get(e,148).replace(/\0.*$/,``).trim(),8);if(Number.isNaN(n))return false;let r=256;for(let n=t;n<t+148;n++)r+=e[n];for(let n=t+156;n<t+512;n++)r+=e[n];return n===r}var Kg;var qg=o(()=>{ch();Kg={get:(e,t)=>e[t+3]&127|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4}});var Jg,Yg;var Xg=o(()=>{Jg=[`jpg`,`png`,`apng`,`gif`,`webp`,`flif`,`xcf`,`cr2`,`cr3`,`orf`,`arw`,`dng`,`nef`,`rw2`,`raf`,`tif`,`bmp`,`icns`,`jxr`,`psd`,`indd`,`zip`,`tar`,`rar`,`gz`,`bz2`,`7z`,`dmg`,`mp4`,`mid`,`mkv`,`webm`,`mov`,`avi`,`mpg`,`mp2`,`mp3`,`m4a`,`oga`,`ogg`,`ogv`,`opus`,`flac`,`wav`,`spx`,`amr`,`pdf`,`epub`,`elf`,`macho`,`exe`,`swf`,`rtf`,`wasm`,`woff`,`woff2`,`eot`,`ttf`,`otf`,`ttc`,`ico`,`flv`,`ps`,`xz`,`sqlite`,`nes`,`crx`,`xpi`,`cab`,`deb`,`ar`,`rpm`,`Z`,`lz`,`cfb`,`mxf`,`mts`,`blend`,`bpg`,`docx`,`pptx`,`xlsx`,`3gp`,`3g2`,`j2c`,`jp2`,`jpm`,`jpx`,`mj2`,`aif`,`qcp`,`odt`,`ods`,`odp`,`xml`,`mobi`,`heic`,`cur`,`ktx`,`ape`,`wv`,`dcm`,`ics`,`glb`,`pcap`,`dsf`,`lnk`,`alias`,`voc`,`ac3`,`m4v`,`m4p`,`m4b`,`f4v`,`f4p`,`f4b`,`f4a`,`mie`,`asf`,`ogm`,`ogx`,`mpc`,`arrow`,`shp`,`aac`,`mp1`,`it`,`s3m`,`xm`,`skp`,`avif`,`eps`,`lzh`,`pgp`,`asar`,`stl`,`chm`,`3mf`,`zst`,`jxl`,`vcf`,`jls`,`pst`,`dwg`,`parquet`,`class`,`arj`,`cpio`,`ace`,`avro`,`icc`,`fbx`,`vsdx`,`vtt`,`apk`,`drc`,`lz4`,`potx`,`xltx`,`dotx`,`xltm`,`ott`,`ots`,`otp`,`odg`,`otg`,`xlsm`,`docm`,`dotm`,`potm`,`pptm`,`jar`,`rm`,`ppsm`,`ppsx`];Yg=[`image/jpeg`,`image/png`,`image/gif`,`image/webp`,`image/flif`,`image/x-xcf`,`image/x-canon-cr2`,`image/x-canon-cr3`,`image/tiff`,`image/bmp`,`image/vnd.ms-photo`,`image/vnd.adobe.photoshop`,`application/x-indesign`,`application/epub+zip`,`application/x-xpinstall`,`application/vnd.ms-powerpoint.slideshow.macroenabled.12`,`application/vnd.oasis.opendocument.text`,`application/vnd.oasis.opendocument.spreadsheet`,`application/vnd.oasis.opendocument.presentation`,`application/vnd.openxmlformats-officedocument.wordprocessingml.document`,`application/vnd.openxmlformats-officedocument.presentationml.presentation`,`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`,`application/vnd.openxmlformats-officedocument.presentationml.slideshow`,`application/zip`,`application/x-tar`,`application/x-rar-compressed`,`application/gzip`,`application/x-bzip2`,`application/x-7z-compressed`,`application/x-apple-diskimage`,`application/vnd.apache.arrow.file`,`video/mp4`,`audio/midi`,`video/matroska`,`video/webm`,`video/quicktime`,`video/vnd.avi`,`audio/wav`,`audio/qcelp`,`audio/x-ms-asf`,`video/x-ms-asf`,`application/vnd.ms-asf`,`video/mpeg`,`video/3gpp`,`audio/mpeg`,`audio/mp4`,`video/ogg`,`audio/ogg`,`audio/ogg; codecs=opus`,`application/ogg`,`audio/flac`,`audio/ape`,`audio/wavpack`,`audio/amr`,`application/pdf`,`application/x-elf`,`application/x-mach-binary`,`application/x-msdownload`,`application/x-shockwave-flash`,`application/rtf`,`application/wasm`,`font/woff`,`font/woff2`,`application/vnd.ms-fontobject`,`font/ttf`,`font/otf`,`font/collection`,`image/x-icon`,`video/x-flv`,`application/postscript`,`application/eps`,`application/x-xz`,`application/x-sqlite3`,`application/x-nintendo-nes-rom`,`application/x-google-chrome-extension`,`application/vnd.ms-cab-compressed`,`application/x-deb`,`application/x-unix-archive`,`application/x-rpm`,`application/x-compress`,`application/x-lzip`,`application/x-cfb`,`application/x-mie`,`application/mxf`,`video/mp2t`,`application/x-blender`,`image/bpg`,`image/j2c`,`image/jp2`,`image/jpx`,`image/jpm`,`image/mj2`,`audio/aiff`,`application/xml`,`application/x-mobipocket-ebook`,`image/heif`,`image/heif-sequence`,`image/heic`,`image/heic-sequence`,`image/icns`,`image/ktx`,`application/dicom`,`audio/x-musepack`,`text/calendar`,`text/vcard`,`text/vtt`,`model/gltf-binary`,`application/vnd.tcpdump.pcap`,`audio/x-dsf`,`application/x.ms.shortcut`,`application/x.apple.alias`,`audio/x-voc`,`audio/vnd.dolby.dd-raw`,`audio/x-m4a`,`image/apng`,`image/x-olympus-orf`,`image/x-sony-arw`,`image/x-adobe-dng`,`image/x-nikon-nef`,`image/x-panasonic-rw2`,`image/x-fujifilm-raf`,`video/x-m4v`,`video/3gpp2`,`application/x-esri-shape`,`audio/aac`,`audio/x-it`,`audio/x-s3m`,`audio/x-xm`,`video/MP1S`,`video/MP2P`,`application/vnd.sketchup.skp`,`image/avif`,`application/x-lzh-compressed`,`application/pgp-encrypted`,`application/x-asar`,`model/stl`,`application/vnd.ms-htmlhelp`,`model/3mf`,`image/jxl`,`application/zstd`,`image/jls`,`application/vnd.ms-outlook`,`image/vnd.dwg`,`application/vnd.apache.parquet`,`application/java-vm`,`application/x-arj`,`application/x-cpio`,`application/x-ace-compressed`,`application/avro`,`application/vnd.iccprofile`,`application/x.autodesk.fbx`,`application/vnd.visio`,`application/vnd.android.package-archive`,`application/vnd.google.draco`,`application/x-lz4`,`application/vnd.openxmlformats-officedocument.presentationml.template`,`application/vnd.openxmlformats-officedocument.spreadsheetml.template`,`application/vnd.openxmlformats-officedocument.wordprocessingml.template`,`application/vnd.ms-excel.template.macroenabled.12`,`application/vnd.oasis.opendocument.text-template`,`application/vnd.oasis.opendocument.spreadsheet-template`,`application/vnd.oasis.opendocument.presentation-template`,`application/vnd.oasis.opendocument.graphics`,`application/vnd.oasis.opendocument.graphics-template`,`application/vnd.ms-excel.sheet.macroenabled.12`,`application/vnd.ms-word.document.macroenabled.12`,`application/vnd.ms-word.template.macroenabled.12`,`application/vnd.ms-powerpoint.template.macroenabled.12`,`application/vnd.ms-powerpoint.presentation.macroenabled.12`,`application/java-archive`,`application/vnd.rn-realmedia`]});var Zg={};c(Zg,{FileTypeParser:()=>o_,fileTypeFromBlob:()=>e_,fileTypeFromBuffer:()=>$g,fileTypeFromStream:()=>Qg,fileTypeFromTokenizer:()=>r_,fileTypeStream:()=>i_,reasonableDetectionSizeInBytes:()=>a_,supportedExtensions:()=>s_,supportedMimeTypes:()=>c_});async function Qg(e,t){return new o_(t).fromStream(e)}async function $g(e,t){return new o_(t).fromBuffer(e)}async function e_(e,t){return new o_(t).fromBlob(e)}function t_(e){e=e.toLowerCase();switch(e){case`application/epub+zip`:return{ext:`epub`,mime:e};case`application/vnd.oasis.opendocument.text`:return{ext:`odt`,mime:e};case`application/vnd.oasis.opendocument.text-template`:return{ext:`ott`,mime:e};case`application/vnd.oasis.opendocument.spreadsheet`:return{ext:`ods`,mime:e};case`application/vnd.oasis.opendocument.spreadsheet-template`:return{ext:`ots`,mime:e};case`application/vnd.oasis.opendocument.presentation`:return{ext:`odp`,mime:e};case`application/vnd.oasis.opendocument.presentation-template`:return{ext:`otp`,mime:e};case`application/vnd.oasis.opendocument.graphics`:return{ext:`odg`,mime:e};case`application/vnd.oasis.opendocument.graphics-template`:return{ext:`otg`,mime:e};case`application/vnd.openxmlformats-officedocument.presentationml.slideshow`:return{ext:`ppsx`,mime:e};case`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`:return{ext:`xlsx`,mime:e};case`application/vnd.ms-excel.sheet.macroenabled`:return{ext:`xlsm`,mime:`application/vnd.ms-excel.sheet.macroenabled.12`};case`application/vnd.openxmlformats-officedocument.spreadsheetml.template`:return{ext:`xltx`,mime:e};case`application/vnd.ms-excel.template.macroenabled`:return{ext:`xltm`,mime:`application/vnd.ms-excel.template.macroenabled.12`};case`application/vnd.ms-powerpoint.slideshow.macroenabled`:return{ext:`ppsm`,mime:`application/vnd.ms-powerpoint.slideshow.macroenabled.12`};case`application/vnd.openxmlformats-officedocument.wordprocessingml.document`:return{ext:`docx`,mime:e};case`application/vnd.ms-word.document.macroenabled`:return{ext:`docm`,mime:`application/vnd.ms-word.document.macroenabled.12`};case`application/vnd.openxmlformats-officedocument.wordprocessingml.template`:return{ext:`dotx`,mime:e};case`application/vnd.ms-word.template.macroenabledtemplate`:return{ext:`dotm`,mime:`application/vnd.ms-word.template.macroenabled.12`};case`application/vnd.openxmlformats-officedocument.presentationml.template`:return{ext:`potx`,mime:e};case`application/vnd.ms-powerpoint.template.macroenabled`:return{ext:`potm`,mime:`application/vnd.ms-powerpoint.template.macroenabled.12`};case`application/vnd.openxmlformats-officedocument.presentationml.presentation`:return{ext:`pptx`,mime:e};case`application/vnd.ms-powerpoint.presentation.macroenabled`:return{ext:`pptm`,mime:`application/vnd.ms-powerpoint.presentation.macroenabled.12`};case`application/vnd.ms-visio.drawing`:return{ext:`vsdx`,mime:`application/vnd.visio`};case`application/vnd.ms-package.3dmanufacturing-3dmodel+xml`:return{ext:`3mf`,mime:`model/3mf`};default:}}function n_(e,t,n){n={offset:0,...n};for(const[r,i]of t.entries())if(n.mask){if(i!==(n.mask[r]&e[r+n.offset]))return false}else if(i!==e[r+n.offset])return false;return true}async function r_(e,t){return new o_(t).fromTokenizer(e)}async function i_(e,t){return new o_(t).toDetectionStream(e,t)}var a_,o_,s_,c_;var l_=o(()=>{ch();Nh();Rg();Ug();qg();Xg();a_=4100;o_=class{constructor(e){this.options={mpegOffsetTolerance:0,...e};this.detectors=[...e?.customDetectors??[],{id:`core`,detect:this.detectConfident},{id:`core.imprecise`,detect:this.detectImprecise}];this.tokenizerOptions={abortSignal:e?.signal}}async fromTokenizer(e){const t=e.position;for(const n of this.detectors){const r=await n.detect(e);if(r)return r;if(t!==e.position)return void 0}}async fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);if(!(t?.length>1))return;return this.fromTokenizer(Mh(t,this.tokenizerOptions))}async fromBlob(e){return this.fromStream(e.stream())}async fromStream(e){const t=await jh(e,this.tokenizerOptions);try{return await this.fromTokenizer(t)}finally{await t.close()}}async toDetectionStream(e,t){const{sampleSize:n=a_}=t;let r;let i;const a=e.getReader({mode:`byob`});try{const{value:e,done:t}=await a.read(new Uint8Array(n));i=e;if(!t&&e)try{r=await this.fromBuffer(e.subarray(0,n))}catch(e){if(!(e instanceof uh))throw e;r=void 0}i=e}finally{a.releaseLock()}const o=new TransformStream({async start(e){e.enqueue(i)},transform(e,t){t.enqueue(e)}});const s=e.pipeThrough(o);s.fileType=r;return s}check(e,t){return n_(this.buffer,e,t)}checkString(e,t){return this.check(Wg(e),t)}detectConfident=async e=>{this.buffer=new Uint8Array(a_);if(e.fileInfo.size===void 0)e.fileInfo.size=Number.MAX_SAFE_INTEGER;this.tokenizer=e;await e.peekBuffer(this.buffer,{length:12,mayBeLess:true});if(this.check([66,77]))return{ext:`bmp`,mime:`image/bmp`};if(this.check([11,119]))return{ext:`ac3`,mime:`audio/vnd.dolby.dd-raw`};if(this.check([120,1]))return{ext:`dmg`,mime:`application/x-apple-diskimage`};if(this.check([77,90]))return{ext:`exe`,mime:`application/x-msdownload`};if(this.check([37,33])){await e.peekBuffer(this.buffer,{length:24,mayBeLess:true});if(this.checkString(`PS-Adobe-`,{offset:2})&&this.checkString(` EPSF-`,{offset:14}))return{ext:`eps`,mime:`application/eps`};return{ext:`ps`,mime:`application/postscript`}}if(this.check([31,160])||this.check([31,157]))return{ext:`Z`,mime:`application/x-compress`};if(this.check([199,113]))return{ext:`cpio`,mime:`application/x-cpio`};if(this.check([96,234]))return{ext:`arj`,mime:`application/x-arj`};if(this.check([239,187,191])){this.tokenizer.ignore(3);return this.detectConfident(e)}if(this.check([71,73,70]))return{ext:`gif`,mime:`image/gif`};if(this.check([73,73,188]))return{ext:`jxr`,mime:`image/vnd.ms-photo`};if(this.check([31,139,8]))return{ext:`gz`,mime:`application/gzip`};if(this.check([66,90,104]))return{ext:`bz2`,mime:`application/x-bzip2`};if(this.checkString(`ID3`)){await e.ignore(6);const t=await e.readToken(Kg);if(e.position+t>e.fileInfo.size)return{ext:`mp3`,mime:`audio/mpeg`};await e.ignore(t);return this.fromTokenizer(e)}if(this.checkString(`MP+`))return{ext:`mpc`,mime:`audio/x-musepack`};if((this.buffer[0]===67||this.buffer[0]===70)&&this.check([87,83],{offset:1}))return{ext:`swf`,mime:`application/x-shockwave-flash`};if(this.check([255,216,255])){if(this.check([247],{offset:3}))return{ext:`jls`,mime:`image/jls`};return{ext:`jpg`,mime:`image/jpeg`}}if(this.check([79,98,106,1]))return{ext:`avro`,mime:`application/avro`};if(this.checkString(`FLIF`))return{ext:`flif`,mime:`image/flif`};if(this.checkString(`8BPS`))return{ext:`psd`,mime:`image/vnd.adobe.photoshop`};if(this.checkString(`MPCK`))return{ext:`mpc`,mime:`audio/x-musepack`};if(this.checkString(`FORM`))return{ext:`aif`,mime:`audio/aiff`};if(this.checkString(`icns`,{offset:0}))return{ext:`icns`,mime:`image/icns`};if(this.check([80,75,3,4])){let t;await new Lg(e).unzip(e=>{switch(e.filename){case`META-INF/mozilla.rsa`:t={ext:`xpi`,mime:`application/x-xpinstall`};return{stop:true};case`META-INF/MANIFEST.MF`:t={ext:`jar`,mime:`application/java-archive`};return{stop:true};case`mimetype`:return{async handler(e){const n=new TextDecoder(`utf-8`).decode(e).trim();t=t_(n)},stop:true};case`[Content_Types].xml`:return{async handler(e){let n=new TextDecoder(`utf-8`).decode(e);const r=n.indexOf(`.main+xml"`);if(r===-1){const e=`application/vnd.ms-package.3dmanufacturing-3dmodel+xml`;if(n.includes(`ContentType="${e}"`))t=t_(e)}else{n=n.slice(0,Math.max(0,r));const e=n.lastIndexOf(`"`);const i=n.slice(Math.max(0,e+1));t=t_(i)}},stop:true};default:if(/classes\d*\.dex/.test(e.filename)){t={ext:`apk`,mime:`application/vnd.android.package-archive`};return{stop:true}}return{}}});return t??{ext:`zip`,mime:`application/zip`}}if(this.checkString(`OggS`)){await e.ignore(28);const t=new Uint8Array(8);await e.readBuffer(t);if(n_(t,[79,112,117,115,72,101,97,100]))return{ext:`opus`,mime:`audio/ogg; codecs=opus`};if(n_(t,[128,116,104,101,111,114,97]))return{ext:`ogv`,mime:`video/ogg`};if(n_(t,[1,118,105,100,101,111,0]))return{ext:`ogm`,mime:`video/ogg`};if(n_(t,[127,70,76,65,67]))return{ext:`oga`,mime:`audio/ogg`};if(n_(t,[83,112,101,101,120,32,32]))return{ext:`spx`,mime:`audio/ogg`};if(n_(t,[1,118,111,114,98,105,115]))return{ext:`ogg`,mime:`audio/ogg`};return{ext:`ogx`,mime:`application/ogg`}}if(this.check([80,75])&&(this.buffer[2]===3||this.buffer[2]===5||this.buffer[2]===7)&&(this.buffer[3]===4||this.buffer[3]===6||this.buffer[3]===8))return{ext:`zip`,mime:`application/zip`};if(this.checkString(`MThd`))return{ext:`mid`,mime:`audio/midi`};if(this.checkString(`wOFF`)&&(this.check([0,1,0,0],{offset:4})||this.checkString(`OTTO`,{offset:4})))return{ext:`woff`,mime:`font/woff`};if(this.checkString(`wOF2`)&&(this.check([0,1,0,0],{offset:4})||this.checkString(`OTTO`,{offset:4})))return{ext:`woff2`,mime:`font/woff2`};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:`pcap`,mime:`application/vnd.tcpdump.pcap`};if(this.checkString(`DSD `))return{ext:`dsf`,mime:`audio/x-dsf`};if(this.checkString(`LZIP`))return{ext:`lz`,mime:`application/x-lzip`};if(this.checkString(`fLaC`))return{ext:`flac`,mime:`audio/flac`};if(this.check([66,80,71,251]))return{ext:`bpg`,mime:`image/bpg`};if(this.checkString(`wvpk`))return{ext:`wv`,mime:`audio/wavpack`};if(this.checkString(`%PDF`))return{ext:`pdf`,mime:`application/pdf`};if(this.check([0,97,115,109]))return{ext:`wasm`,mime:`application/wasm`};if(this.check([73,73])){const e=await this.readTiffHeader(false);if(e)return e}if(this.check([77,77])){const e=await this.readTiffHeader(true);if(e)return e}if(this.checkString(`MAC `))return{ext:`ape`,mime:`audio/ape`};if(this.check([26,69,223,163])){async function t(){const t=await e.peekNumber(th);let n=128;let r=0;while((t&n)===0&&n!==0){++r;n>>=1}const i=new Uint8Array(r+1);await e.readBuffer(i);return i}async function n(){const e=await t();const n=await t();n[0]^=128>>n.length-1;const r=Math.min(6,n.length);const i=new DataView(e.buffer);const a=new DataView(n.buffer,n.length-r,r);return{id:zg(i),len:zg(a)}}async function r(t){while(t>0){const r=await n();if(r.id===17026){const t=await e.readToken(new sh(r.len));return t.replaceAll(/\00.*$/g,``)}await e.ignore(r.len);--t}}const i=await n();const a=await r(i.len);switch(a){case`webm`:return{ext:`webm`,mime:`video/webm`};case`matroska`:return{ext:`mkv`,mime:`video/matroska`};default:return}}if(this.checkString(`SQLi`))return{ext:`sqlite`,mime:`application/x-sqlite3`};if(this.check([78,69,83,26]))return{ext:`nes`,mime:`application/x-nintendo-nes-rom`};if(this.checkString(`Cr24`))return{ext:`crx`,mime:`application/x-google-chrome-extension`};if(this.checkString(`MSCF`)||this.checkString(`ISc(`))return{ext:`cab`,mime:`application/vnd.ms-cab-compressed`};if(this.check([237,171,238,219]))return{ext:`rpm`,mime:`application/x-rpm`};if(this.check([197,208,211,198]))return{ext:`eps`,mime:`application/eps`};if(this.check([40,181,47,253]))return{ext:`zst`,mime:`application/zstd`};if(this.check([127,69,76,70]))return{ext:`elf`,mime:`application/x-elf`};if(this.check([33,66,68,78]))return{ext:`pst`,mime:`application/vnd.ms-outlook`};if(this.checkString(`PAR1`)||this.checkString(`PARE`))return{ext:`parquet`,mime:`application/vnd.apache.parquet`};if(this.checkString(`ttcf`))return{ext:`ttc`,mime:`font/collection`};if(this.check([207,250,237,254]))return{ext:`macho`,mime:`application/x-mach-binary`};if(this.check([4,34,77,24]))return{ext:`lz4`,mime:`application/x-lz4`};if(this.check([79,84,84,79,0]))return{ext:`otf`,mime:`font/otf`};if(this.checkString(`#!AMR`))return{ext:`amr`,mime:`audio/amr`};if(this.checkString(`{\\rtf`))return{ext:`rtf`,mime:`application/rtf`};if(this.check([70,76,86,1]))return{ext:`flv`,mime:`video/x-flv`};if(this.checkString(`IMPM`))return{ext:`it`,mime:`audio/x-it`};if(this.checkString(`-lh0-`,{offset:2})||this.checkString(`-lh1-`,{offset:2})||this.checkString(`-lh2-`,{offset:2})||this.checkString(`-lh3-`,{offset:2})||this.checkString(`-lh4-`,{offset:2})||this.checkString(`-lh5-`,{offset:2})||this.checkString(`-lh6-`,{offset:2})||this.checkString(`-lh7-`,{offset:2})||this.checkString(`-lzs-`,{offset:2})||this.checkString(`-lz4-`,{offset:2})||this.checkString(`-lz5-`,{offset:2})||this.checkString(`-lhd-`,{offset:2}))return{ext:`lzh`,mime:`application/x-lzh-compressed`};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:`mpg`,mime:`video/MP1S`};if(this.check([68],{offset:4,mask:[196]}))return{ext:`mpg`,mime:`video/MP2P`}}if(this.checkString(`ITSF`))return{ext:`chm`,mime:`application/vnd.ms-htmlhelp`};if(this.check([202,254,186,190]))return{ext:`class`,mime:`application/java-vm`};if(this.checkString(`.RMF`))return{ext:`rm`,mime:`application/vnd.rn-realmedia`};if(this.checkString(`DRACO`))return{ext:`drc`,mime:`application/vnd.google.draco`};if(this.check([253,55,122,88,90,0]))return{ext:`xz`,mime:`application/x-xz`};if(this.checkString(`<?xml `))return{ext:`xml`,mime:`application/xml`};if(this.check([55,122,188,175,39,28]))return{ext:`7z`,mime:`application/x-7z-compressed`};if(this.check([82,97,114,33,26,7])&&(this.buffer[6]===0||this.buffer[6]===1))return{ext:`rar`,mime:`application/x-rar-compressed`};if(this.checkString(`solid `))return{ext:`stl`,mime:`model/stl`};if(this.checkString(`AC`)){const e=new sh(4,`latin1`).get(this.buffer,2);if(e.match(`^d*`)&&e>=1e3&&e<=1050)return{ext:`dwg`,mime:`image/vnd.dwg`}}if(this.checkString(`070707`))return{ext:`cpio`,mime:`application/x-cpio`};if(this.checkString(`BLENDER`))return{ext:`blend`,mime:`application/x-blender`};if(this.checkString(`!<arch>`)){await e.ignore(8);const t=await e.readToken(new sh(13,`ascii`));if(t===`debian-binary`)return{ext:`deb`,mime:`application/x-deb`};return{ext:`ar`,mime:`application/x-unix-archive`}}if(this.checkString(`WEBVTT`)&&[`
`,`\r`,`	`,` `,`\0`].some(e=>this.checkString(e,{offset:6})))return{ext:`vtt`,mime:`text/vtt`};if(this.check([137,80,78,71,13,10,26,10])){await e.ignore(8);async function t(){return{length:await e.readToken(ah),type:await e.readToken(new sh(4,`latin1`))}}do{const n=await t();if(n.length<0)return;switch(n.type){case`IDAT`:return{ext:`png`,mime:`image/png`};case`acTL`:return{ext:`apng`,mime:`image/apng`};default:await e.ignore(n.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:`png`,mime:`image/png`}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:`arrow`,mime:`application/vnd.apache.arrow.file`};if(this.check([103,108,84,70,2,0,0,0]))return{ext:`glb`,mime:`model/gltf-binary`};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:`mov`,mime:`video/quicktime`};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:`orf`,mime:`image/x-olympus-orf`};if(this.checkString(`gimp xcf `))return{ext:`xcf`,mime:`image/x-xcf`};if(this.checkString(`ftyp`,{offset:4})&&(this.buffer[8]&96)!==0){const e=new sh(4,`latin1`).get(this.buffer,8).replace(`\0`,` `).trim();switch(e){case`avif`:case`avis`:return{ext:`avif`,mime:`image/avif`};case`mif1`:return{ext:`heic`,mime:`image/heif`};case`msf1`:return{ext:`heic`,mime:`image/heif-sequence`};case`heic`:case`heix`:return{ext:`heic`,mime:`image/heic`};case`hevc`:case`hevx`:return{ext:`heic`,mime:`image/heic-sequence`};case`qt`:return{ext:`mov`,mime:`video/quicktime`};case`M4V`:case`M4VH`:case`M4VP`:return{ext:`m4v`,mime:`video/x-m4v`};case`M4P`:return{ext:`m4p`,mime:`video/mp4`};case`M4B`:return{ext:`m4b`,mime:`audio/mp4`};case`M4A`:return{ext:`m4a`,mime:`audio/x-m4a`};case`F4V`:return{ext:`f4v`,mime:`video/mp4`};case`F4P`:return{ext:`f4p`,mime:`video/mp4`};case`F4A`:return{ext:`f4a`,mime:`audio/mp4`};case`F4B`:return{ext:`f4b`,mime:`audio/mp4`};case`crx`:return{ext:`cr3`,mime:`image/x-canon-cr3`};default:if(e.startsWith(`3g`)){if(e.startsWith(`3g2`))return{ext:`3g2`,mime:`video/3gpp2`};return{ext:`3gp`,mime:`video/3gpp`}}return{ext:`mp4`,mime:`video/mp4`}}}if(this.check([82,73,70,70])){if(this.checkString(`WEBP`,{offset:8}))return{ext:`webp`,mime:`image/webp`};if(this.check([65,86,73],{offset:8}))return{ext:`avi`,mime:`video/vnd.avi`};if(this.check([87,65,86,69],{offset:8}))return{ext:`wav`,mime:`audio/wav`};if(this.check([81,76,67,77],{offset:8}))return{ext:`qcp`,mime:`audio/qcelp`}}if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:`rw2`,mime:`image/x-panasonic-rw2`};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function t(){const t=new Uint8Array(16);await e.readBuffer(t);return{id:t,size:Number(await e.readToken(oh))}}await e.ignore(30);while(e.position+24<e.fileInfo.size){const n=await t();let r=n.size-24;if(n_(n.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const t=new Uint8Array(16);r-=await e.readBuffer(t);if(n_(t,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:`asf`,mime:`audio/x-ms-asf`};if(n_(t,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:`asf`,mime:`video/x-ms-asf`};break}await e.ignore(r)}return{ext:`asf`,mime:`application/vnd.ms-asf`}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:`ktx`,mime:`image/ktx`};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:`mie`,mime:`application/x-mie`};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:`shp`,mime:`application/x-esri-shape`};if(this.check([255,79,255,81]))return{ext:`j2c`,mime:`image/j2c`};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10])){await e.ignore(20);const t=await e.readToken(new sh(4,`ascii`));switch(t){case`jp2 `:return{ext:`jp2`,mime:`image/jp2`};case`jpx `:return{ext:`jpx`,mime:`image/jpx`};case`jpm `:return{ext:`jpm`,mime:`image/jpm`};case`mjp2`:return{ext:`mj2`,mime:`image/mj2`};default:return}}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:`jxl`,mime:`image/jxl`};if(this.check([254,255])){if(this.check([0,60,0,63,0,120,0,109,0,108],{offset:2}))return{ext:`xml`,mime:`application/xml`};return void 0}if(this.check([208,207,17,224,161,177,26,225]))return{ext:`cfb`,mime:`application/x-cfb`};await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:true});if(this.check([97,99,115,112],{offset:36}))return{ext:`icc`,mime:`application/vnd.iccprofile`};if(this.checkString(`**ACE`,{offset:7})&&this.checkString(`**`,{offset:12}))return{ext:`ace`,mime:`application/x-ace-compressed`};if(this.checkString(`BEGIN:`)){if(this.checkString(`VCARD`,{offset:6}))return{ext:`vcf`,mime:`text/vcard`};if(this.checkString(`VCALENDAR`,{offset:6}))return{ext:`ics`,mime:`text/calendar`}}if(this.checkString(`FUJIFILMCCD-RAW`))return{ext:`raf`,mime:`image/x-fujifilm-raf`};if(this.checkString(`Extended Module:`))return{ext:`xm`,mime:`audio/x-xm`};if(this.checkString(`Creative Voice File`))return{ext:`voc`,mime:`audio/x-voc`};if(this.check([4,0,0,0])&&this.buffer.length>=16){const e=new DataView(this.buffer.buffer).getUint32(12,true);if(e>12&&this.buffer.length>=e+16)try{const t=new TextDecoder().decode(this.buffer.subarray(16,e+16));const n=JSON.parse(t);if(n.files)return{ext:`asar`,mime:`application/x-asar`}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:`mxf`,mime:`application/mxf`};if(this.checkString(`SCRM`,{offset:44}))return{ext:`s3m`,mime:`audio/x-s3m`};if(this.check([71])&&this.check([71],{offset:188}))return{ext:`mts`,mime:`video/mp2t`};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:`mts`,mime:`video/mp2t`};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:`mobi`,mime:`application/x-mobipocket-ebook`};if(this.check([68,73,67,77],{offset:128}))return{ext:`dcm`,mime:`application/dicom`};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:`lnk`,mime:`application/x.ms.shortcut`};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:`alias`,mime:`application/x.apple.alias`};if(this.checkString(`Kaydara FBX Binary  \0`))return{ext:`fbx`,mime:`application/x.autodesk.fbx`};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:`eot`,mime:`application/vnd.ms-fontobject`};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:`indd`,mime:`application/x-indesign`};await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:true});if(this.checkString(`ustar`,{offset:257})&&(this.checkString(`\0`,{offset:262})||this.checkString(` `,{offset:262}))||this.check([0,0,0,0,0,0],{offset:257})&&Gg(this.buffer))return{ext:`tar`,mime:`application/x-tar`};if(this.check([255,254])){if(this.check([60,0,63,0,120,0,109,0,108,0],{offset:2}))return{ext:`xml`,mime:`application/xml`};if(this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2}))return{ext:`skp`,mime:`application/vnd.sketchup.skp`};return void 0}if(this.checkString(`-----BEGIN PGP MESSAGE-----`))return{ext:`pgp`,mime:`application/pgp-encrypted`}};detectImprecise=async e=>{this.buffer=new Uint8Array(a_);await e.peekBuffer(this.buffer,{length:Math.min(8,e.fileInfo.size),mayBeLess:true});if(this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:`mpg`,mime:`video/mpeg`};if(this.check([0,1,0,0,0]))return{ext:`ttf`,mime:`font/ttf`};if(this.check([0,0,1,0]))return{ext:`ico`,mime:`image/x-icon`};if(this.check([0,0,2,0]))return{ext:`cur`,mime:`image/x-icon`};await e.peekBuffer(this.buffer,{length:Math.min(2+this.options.mpegOffsetTolerance,e.fileInfo.size),mayBeLess:true});if(this.buffer.length>=2+this.options.mpegOffsetTolerance)for(let e=0;e<=this.options.mpegOffsetTolerance;++e){const t=this.scanMpeg(e);if(t)return t}};async readTiffTag(e){const t=await this.tokenizer.readToken(e?nh:J);this.tokenizer.ignore(10);switch(t){case 50341:return{ext:`arw`,mime:`image/x-sony-arw`};case 50706:return{ext:`dng`,mime:`image/x-adobe-dng`};default:}}async readTiffIFD(e){const t=await this.tokenizer.readToken(e?nh:J);for(let n=0;n<t;++n){const t=await this.readTiffTag(e);if(t)return t}}async readTiffHeader(e){const t=(e?nh:J).get(this.buffer,2);const n=(e?ih:rh).get(this.buffer,4);if(t===42){if(n>=6){if(this.checkString(`CR`,{offset:8}))return{ext:`cr2`,mime:`image/x-canon-cr2`};if(n>=8){const t=(e?nh:J).get(this.buffer,8);const n=(e?nh:J).get(this.buffer,10);if(t===28&&n===254||t===31&&n===11)return{ext:`nef`,mime:`image/x-nikon-nef`}}}await this.tokenizer.ignore(n);const t=await this.readTiffIFD(e);return t??{ext:`tif`,mime:`image/tiff`}}if(t===43)return{ext:`tif`,mime:`image/tiff`}}scanMpeg(e){if(this.check([255,224],{offset:e,mask:[255,224]})){if(this.check([16],{offset:e+1,mask:[22]})){if(this.check([8],{offset:e+1,mask:[8]}))return{ext:`aac`,mime:`audio/aac`};return{ext:`aac`,mime:`audio/aac`}}if(this.check([2],{offset:e+1,mask:[6]}))return{ext:`mp3`,mime:`audio/mpeg`};if(this.check([4],{offset:e+1,mask:[6]}))return{ext:`mp2`,mime:`audio/mpeg`};if(this.check([6],{offset:e+1,mask:[6]}))return{ext:`mp1`,mime:`audio/mpeg`}}}};s_=new Set(Jg);c_=new Set(Yg)});var u_=u(zm(),1);var d_=u(Bm(),1);var f_=u(Bm(),1);var p_=u(Bm(),1);var m_=(e,t)=>{let n=t?.length?{}:null;if(n)for(let e of t)n[e.part.charCodeAt(0)]=e;return{part:e,store:null,inert:n,params:null,wildcardStore:null}},h_=(e,t)=>({...e,part:t}),g_=e=>({name:e,store:null,inert:null}),__=class e{constructor(e={}){this.config=e,e.lazy&&(this.find=this.lazyFind)}root={};history=[];deferred=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g,optionalParams:/(\/:\w+\?)/g};lazyFind=(e,t)=>this.config.lazy?(this.build(),this.find(e,t)):this.find;build(){if(this.config.lazy){for(let[e,t,n]of this.deferred)this.add(e,t,n,{lazy:!1,ignoreHistory:!0});this.deferred=[],this.find=(e,t)=>{let n=this.root[e];return n?v_(t,t.length,n,0):null}}}add(t,n,r,{ignoreError:i=!1,ignoreHistory:a=!1,lazy:o=this.config.lazy}={}){if(o)return this.find=this.lazyFind,this.deferred.push([t,n,r]),r;if(typeof n!=`string`)throw new TypeError(`Route path must be a string`);n===``?n=`/`:n[0]!==`/`&&(n=`/${n}`);let s=n[n.length-1]===`*`,c=n.match(e.regex.optionalParams);if(c){let e=n.replaceAll(`?`,``);this.add(t,e,r,{ignoreError:i,ignoreHistory:a,lazy:o});for(let e=0;e<c.length;e++){let i=n.replace(c[e],``);this.add(t,i,r,{ignoreError:!0,ignoreHistory:a,lazy:o})}return r}if(c&&(n=n.replaceAll(`?`,``)),this.history.find(([e,r,i])=>e===t&&r===n))return r;(s||c&&n.charCodeAt(n.length-1)===63)&&(n=n.slice(0,-1)),a||this.history.push([t,n,r]);let l=n.split(e.regex.static),u=n.match(e.regex.params)||[];l[l.length-1]===``&&l.pop();let d;this.root[t]?d=this.root[t]:d=this.root[t]=m_(`/`);let f=0;for(let e=0;e<l.length;++e){let t=l[e];if(e>0){let e=u[f++].slice(1);if(d.params===null)d.params=g_(e);else if(d.params.name!==e){if(i)return r;throw new Error(`Cannot create route "${n}" with parameter "${e}" because a route already exists with a different parameter name ("${d.params.name}") in the same location`)}let a=d.params;if(a.inert===null){d=a.inert=m_(t);continue}d=a.inert}for(let e=0;;){if(e===t.length){if(e<d.part.length){let n=h_(d,d.part.slice(e));Object.assign(d,m_(t,[n]))}break}if(e===d.part.length){d.inert===null&&(d.inert={});let n=d.inert[t.charCodeAt(e)];if(n){d=n,t=t.slice(e),e=0;continue}let r=m_(t.slice(e));d.inert[t.charCodeAt(e)]=r,d=r;break}if(t[e]!==d.part[e]){let n=h_(d,d.part.slice(e)),r=m_(t.slice(e));Object.assign(d,m_(d.part.slice(0,e),[n,r])),d=r;break}++e}}if(f<u.length){let e=u[f].slice(1);if(d.params===null)d.params=g_(e);else if(d.params.name!==e){if(i)return r;throw new Error(`Cannot create route "${n}" with parameter "${e}" because a route already exists with a different parameter name ("${d.params.name}") in the same location`)}return d.params.store===null&&(d.params.store=r),d.params.store}return s?(d.wildcardStore===null&&(d.wildcardStore=r),d.wildcardStore):(d.store===null&&(d.store=r),d.store)}find(e,t){let n=this.root[e];return n?v_(t,t.length,n,0):null}},v_=(e,t,n,r)=>{let i=n.part,a=i.length,o=r+a;if(a>1){if(o>t)return null;if(a<15){for(let t=1,n=r+1;t<a;++t,++n)if(i.charCodeAt(t)!==e.charCodeAt(n))return null}else if(e.slice(r,o)!==i)return null}if(o===t)return n.store!==null?{store:n.store,params:{}}:n.wildcardStore!==null?{store:n.wildcardStore,params:{"*":``}}:null;if(n.inert!==null){let r=n.inert[e.charCodeAt(o)];if(r!==void 0){let n=v_(e,t,r,o);if(n!==null)return n}}if(n.params!==null){let{store:r,name:i,inert:a}=n.params,s=e.indexOf(`/`,o);if(s!==o){if(s===-1||s>=t){if(r!==null){let n={};return n[i]=e.substring(o,t),{store:r,params:n}}}else if(a!==null){let n=v_(e,t,a,s);if(n!==null)return n.params[i]=e.substring(o,s),n}}}return n.wildcardStore!==null?{store:n.wildcardStore,params:{"*":e.substring(o,t)}}:null};var y_={date:C_,time:T_(!0),"date-time":O_(!0),"iso-time":T_(!1),"iso-date-time":O_(!1),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:j_,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:B_,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:N_,int32:{type:`number`,validate:I_},int64:{type:`number`,validate:L_},float:{type:`number`,validate:R_},double:{type:`number`,validate:R_},password:!0,binary:!0};function b_(e){return e%4===0&&(e%100!==0||e%400===0)}var x_=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,S_=[0,31,28,31,30,31,30,31,31,30,31,30,31];function C_(e){let t=x_.exec(e);if(!t)return!1;let n=+t[1],r=+t[2],i=+t[3];return r>=1&&r<=12&&i>=1&&i<=(r===2&&b_(n)?29:S_[r])}var w_=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function T_(e){return function(t){let n=w_.exec(t);if(!n)return!1;let r=+n[1],i=+n[2],a=+n[3],o=n[4],s=n[5]===`-`?-1:1,c=+(n[6]||0),l=+(n[7]||0);if(c>23||l>59||e&&!o)return!1;if(r<=23&&i<=59&&a<60)return!0;let u=i-l*s,d=r-c*s-(u<0?1:0);return(d===23||d===-1)&&(u===59||u===-1)&&a<61}}var E_=e=>e.charCodeAt(e.length-6)===32?e.slice(0,-6)+`+`+e.slice(-5):e,D_=/t|\s/i;function O_(e){let t=T_(e);return function(e){let n=e.split(D_);return n.length===2&&C_(n[0])&&t(n[1])}}var k_=/\/|:/,A_=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function j_(e){return k_.test(e)&&A_.test(e)}var M_=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function N_(e){return M_.lastIndex=0,M_.test(e)}var P_=-(2**31),F_=2**31-1;function I_(e){return Number.isInteger(e)&&e<=F_&&e>=P_}function L_(e){return Number.isInteger(e)}function R_(){return!0}var z_=/[^\\]\\Z/;function B_(e){if(z_.test(e))return!1;try{return new RegExp(e),!0}catch{return!1}}var V_=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,H_=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,U_=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,W_=y_.date,G_=y_[`date-time`];jn(`date`)||Mn(`date`,e=>{let t=E_(e).replace(/"/g,``);if(V_.test(t)||H_.test(t)||U_.test(t)||W_(t)){let e=new Date(t);if(!Number.isNaN(e.getTime()))return!0}return!1});jn(`date-time`)||Mn(`date-time`,e=>{let t=e.replace(/"/g,``);if(V_.test(t)||H_.test(t)||U_.test(t)||G_(t)){let e=new Date(t);if(!Number.isNaN(e.getTime()))return!0}return!1});Object.entries(y_).forEach(e=>{let[t,n]=e;jn(t)||(n instanceof RegExp?Mn(t,e=>n.test(e)):typeof n==`function`&&Mn(t,n))});jn(`numeric`)||Mn(`numeric`,e=>!!e&&!isNaN(+e));jn(`integer`)||Mn(`integer`,e=>!!e&&Number.isInteger(+e));jn(`boolean`)||Mn(`boolean`,e=>e===`true`||e===`false`);jn(`ObjectString`)||Mn(`ObjectString`,e=>{let t=e.charCodeAt(0);if((t===9||t===10||t===32)&&(t=e.trimStart().charCodeAt(0)),t!==123&&t!==91)return!1;try{return JSON.parse(e),!0}catch{return!1}});jn(`ArrayString`)||Mn(`ArrayString`,e=>{let t=e.charCodeAt(0);if((t===9||t===10||t===32)&&(t=e.trimStart().charCodeAt(0)),t!==123&&t!==91)return!1;try{return JSON.parse(e),!0}catch{return!1}});var K_=typeof Bun<`u`;var q_={aac:`audio/aac`,abw:`application/x-abiword`,ai:`application/postscript`,arc:`application/octet-stream`,avi:`video/x-msvideo`,azw:`application/vnd.amazon.ebook`,bin:`application/octet-stream`,bz:`application/x-bzip`,bz2:`application/x-bzip2`,csh:`application/x-csh`,css:`text/css`,csv:`text/csv`,doc:`application/msword`,dll:`application/octet-stream`,eot:`application/vnd.ms-fontobject`,epub:`application/epub+zip`,gif:`image/gif`,htm:`text/html`,html:`text/html`,ico:`image/x-icon`,ics:`text/calendar`,jar:`application/java-archive`,jpeg:`image/jpeg`,jpg:`image/jpeg`,js:`application/javascript`,json:`application/json`,mid:`audio/midi`,midi:`audio/midi`,mp2:`audio/mpeg`,mp3:`audio/mpeg`,mp4:`video/mp4`,mpa:`video/mpeg`,mpe:`video/mpeg`,mpeg:`video/mpeg`,mpkg:`application/vnd.apple.installer+xml`,odp:`application/vnd.oasis.opendocument.presentation`,ods:`application/vnd.oasis.opendocument.spreadsheet`,odt:`application/vnd.oasis.opendocument.text`,oga:`audio/ogg`,ogv:`video/ogg`,ogx:`application/ogg`,otf:`font/otf`,png:`image/png`,pdf:`application/pdf`,ppt:`application/vnd.ms-powerpoint`,rar:`application/x-rar-compressed`,rtf:`application/rtf`,sh:`application/x-sh`,svg:`image/svg+xml`,swf:`application/x-shockwave-flash`,tar:`application/x-tar`,tif:`image/tiff`,tiff:`image/tiff`,ts:`application/typescript`,ttf:`font/ttf`,txt:`text/plain`,vsd:`application/vnd.visio`,wav:`audio/x-wav`,weba:`audio/webm`,webm:`video/webm`,webp:`image/webp`,woff:`font/woff`,woff2:`font/woff2`,xhtml:`application/xhtml+xml`,xls:`application/vnd.ms-excel`,xlsx:`application/vnd.ms-excel`,xlsx_OLD:`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`,xml:`application/xml`,xul:`application/vnd.mozilla.xul+xml`,zip:`application/zip`,"3gp":`video/3gpp`,"3gp_DOES_NOT_CONTAIN_VIDEO":`audio/3gpp`,"3gp2":`video/3gpp2`,"3gp2_DOES_NOT_CONTAIN_VIDEO":`audio/3gpp2`,"7z":`application/x-7z-compressed`},J_=e=>{let t=e.lastIndexOf(`.`);return t===-1?``:e.slice(t+1)},Y_=e=>new Q_(e),X_,Z_,Q_=class{constructor(e){this.path=e;if(K_)this.value=Bun.file(e);else if(typeof window<`u`)console.warn(`Browser environment does not support file`);else if(!X_||!Z_)try{this.value=import(`fs`).then(t=>(X_=t.createReadStream,t.createReadStream(e))),this.stats=import(`fs/promises`).then(t=>(Z_=t.stat,t.stat(e)))}catch{}else this.value=X_(e),this.stats=Z_(e)}get type(){return q_[J_(this.path)]||`application/octet-stream`}get length(){return K_?this.value.size:this.stats?.then(e=>e.size)??0}};var $_=`toJSON`in new Headers,ev=(e,t)=>{let n=new URL(e);return n.pathname=t,n.toString()},tv=e=>typeof e==`function`&&/^\s*class\s+/.test(e.toString())||e.toString&&e.toString().startsWith(`[object `)&&e.toString()!==`[object Object]`||X(Object.getPrototypeOf(e)),nv=e=>e&&typeof e==`object`&&!Array.isArray(e),rv=(e,t,n)=>{let r=n?.skipKeys,i=n?.override??!0;if(!nv(e)||!nv(t))return e;for(let[n,a]of Object.entries(t))if(!r?.includes(n)){if(!nv(a)||!(n in e)||tv(a)){(i||!(n in e))&&(e[n]=a);continue}e[n]=rv(e[n],a,{skipKeys:r,override:i})}return e},iv=(e,t)=>{let n=rv(Object.assign({},e),t,{skipKeys:[`properties`]});return n.properties&&delete n.properties,n},Y=(e,t)=>{if(!t)return e;let n=[],r=[];if(e){Array.isArray(e)||(e=[e]);for(let t of e)n.push(t),t.checksum&&r.push(t.checksum)}if(t){Array.isArray(t)||(t=[t]);for(let e of t)r.includes(e.checksum)||n.push(e)}return n},av=[`start`,`request`,`parse`,`transform`,`resolve`,`beforeHandle`,`afterHandle`,`mapResponse`,`afterResponse`,`trace`,`error`,`stop`,`body`,`headers`,`params`,`query`,`response`,`type`,`detail`],ov=av.reduce((e,t)=>(e[t]=!0,e),{}),sv=(e,t)=>{let n=e=>typeof e==`object`&&Object.keys(e).every(Ov);return n(e)&&n(t)?Object.assign(e,t):e&&!n(e)&&n(t)?Object.assign({200:e},t):t??e},cv=(e,t)=>!e&&!t?{body:void 0,headers:void 0,params:void 0,query:void 0,cookie:void 0,response:void 0}:{body:t?.body??e?.body,headers:t?.headers??e?.headers,params:t?.params??e?.params,query:t?.query??e?.query,cookie:t?.cookie??e?.cookie,response:sv(e?.response,t?.response)},lv=(e,t)=>{if(!Object.values(t).find(e=>e!=null))return{...e};let n={...e,...t,body:t?.body??e?.body,headers:t?.headers??e?.headers,params:t?.params??e?.params,query:t?.query??e?.query,cookie:t?.cookie??e?.cookie,response:sv(e?.response,t?.response),type:e?.type||t?.type,detail:rv(t?.detail??{},e?.detail??{}),parse:Y(e?.parse,t?.parse),transform:Y(e?.transform,t?.transform),beforeHandle:Y(Y(Av(e?.resolve,`resolve`),e?.beforeHandle),Y(Av(t.resolve,`resolve`),t?.beforeHandle)),afterHandle:Y(e?.afterHandle,t?.afterHandle),mapResponse:Y(e?.mapResponse,t?.mapResponse),afterResponse:Y(e?.afterResponse,t?.afterResponse),trace:Y(e?.trace,t?.trace),error:Y(e?.error,t?.error)};return n.resolve&&delete n.resolve,n},uv=e=>{e.parse&&!Array.isArray(e.parse)&&(e.parse=[e.parse]),e.transform&&!Array.isArray(e.transform)&&(e.transform=[e.transform]),e.afterHandle&&!Array.isArray(e.afterHandle)&&(e.afterHandle=[e.afterHandle]),e.mapResponse&&!Array.isArray(e.mapResponse)&&(e.mapResponse=[e.mapResponse]),e.afterResponse&&!Array.isArray(e.afterResponse)&&(e.afterResponse=[e.afterResponse]),e.trace&&!Array.isArray(e.trace)&&(e.trace=[e.trace]),e.error&&!Array.isArray(e.error)&&(e.error=[e.error]);let t=[];return e.resolve&&(t=Av(Array.isArray(e.resolve)?e.resolve:[e.resolve],`resolve`),delete e.resolve),e.beforeHandle&&(t.length?t=t.concat(Array.isArray(e.beforeHandle)?e.beforeHandle:[e.beforeHandle]):t=Array.isArray(e.beforeHandle)?e.beforeHandle:[e.beforeHandle]),t.length&&(e.beforeHandle=t),e},dv=typeof Bun<`u`,fv=dv&&typeof Bun.hash==`function`,pv=e=>{if(fv)return Bun.hash(e);let t=9;for(let n=0;n<e.length;)t=Math.imul(t^e.charCodeAt(n++),9**9);return t=t^t>>>9},mv=(e,t)=>{if(!t)return;if(!Array.isArray(t)){let n=t;return e&&!n.checksum&&(n.checksum=e),n.scope===`scoped`&&(n.scope=`local`),n}let n=[...t];for(let t of n)e&&!t.checksum&&(t.checksum=e),t.scope===`scoped`&&(t.scope=`local`);return n},hv=(e,t,n)=>({start:Y(e.start,mv(n,t?.start)),request:Y(e.request,mv(n,t?.request)),parse:Y(e.parse,mv(n,t?.parse)),transform:Y(e.transform,mv(n,t?.transform)),beforeHandle:Y(Y(Av(e.resolve,`resolve`),e.beforeHandle),mv(n,Y(Av(t?.resolve,`resolve`),t?.beforeHandle))),afterHandle:Y(e.afterHandle,mv(n,t?.afterHandle)),mapResponse:Y(e.mapResponse,mv(n,t?.mapResponse)),afterResponse:Y(e.afterResponse,mv(n,t?.afterResponse)),trace:Y(e.trace,mv(n,t?.trace)),error:Y(e.error,mv(n,t?.error)),stop:Y(e.stop,mv(n,t?.stop))}),gv=(e,t,{skipIfHasType:n=!1})=>{if(!e)return e;if(!Array.isArray(e))return n?e.scope??=t:e.scope=t,e;for(let r of e)n?r.scope??=t:r.scope=t;return e},_v=e=>{if(!e)return e;if(!Array.isArray(e))switch(e.scope){case`global`:case`scoped`:return{...e};default:return{fn:e}}let t=[];for(let n of e)switch(n.scope){case`global`:case`scoped`:t.push({...n});break}return t},vv=e=>({...e,type:e?.type,detail:e?.detail,parse:_v(e?.parse),transform:_v(e?.transform),beforeHandle:_v(e?.beforeHandle),afterHandle:_v(e?.afterHandle),mapResponse:_v(e?.mapResponse),afterResponse:_v(e?.afterResponse),error:_v(e?.error),trace:_v(e?.trace)}),yv={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},bv=Object.fromEntries(Object.entries(yv).map(([e,t])=>[t,e]));function xv(e){let t=e;for(;t.endsWith(`=`);)t=t.slice(0,-1);return t}var Sv=new TextEncoder,Cv=async(e,t)=>{if(typeof e!=`string`)throw new TypeError(`Cookie value must be provided as a string.`);if(t===null)throw new TypeError(`Secret key must be provided.`);let n=await crypto.subtle.importKey(`raw`,Sv.encode(t),{name:`HMAC`,hash:`SHA-256`},!1,[`sign`]),r=await crypto.subtle.sign(`HMAC`,n,Sv.encode(e));return e+`.`+xv(Buffer.from(r).toString(`base64`))},wv=async(e,t)=>{if(typeof e!=`string`)throw new TypeError(`Signed cookie string must be provided.`);if(t===null)throw new TypeError(`Secret key must be provided.`);let n=e.slice(0,e.lastIndexOf(`.`));return await Cv(n,t)===e?n:!1},Tv=(e,t,n)=>{if(!(!e||typeof e!=`object`||!t))for(let[r,i]of Object.entries(t)){if(ov[r]||!(r in e))continue;let a=e[r];if(typeof a==`function`){let e=a(i);if(typeof e==`object`)for(let[t,r]of Object.entries(e))n(t)({fn:r})}delete t[r]}},Ev=({globalHook:e,localHook:t})=>n=>(r,i)=>{if(typeof r==`function`&&(r={fn:r}),n===`resolve`&&(r={...r,subType:`resolve`}),t[n]||(t[n]=[]),typeof t[n]==`function`&&(t[n]=[t[n]]),Array.isArray(t[n])||(t[n]=[t[n]]),`fn`in r||Array.isArray(r)){Array.isArray(r)?t[n]=t[n].concat(r):t[n].push(r);return}let{insert:a=`after`,stack:o=`local`}=r;typeof i==`function`&&(i={fn:i}),o===`global`?Array.isArray(i)?a===`before`?e[n]=i.concat(e[n]):e[n]=e[n].concat(i):a===`before`?e[n].unshift(i):e[n].push(i):Array.isArray(i)?a===`before`?t[n]=i.concat(t[n]):t[n]=t[n].concat(i):a===`before`?t[n].unshift(i):t[n].push(i)},Dv=e=>{if(typeof e==`number`)return e;if(e.length<16){if(e.trim().length===0)return null;let t=Number(e);return Number.isNaN(t)?null:t}if(e.length===16){if(e.trim().length===0)return null;let t=Number(e);return Number.isNaN(t)||t.toString()!==e?null:t}return null},Ov=e=>Dv(e)!==null,kv=class{constructor(e=console.error,t=()=>{}){this.onError=e;this.onFinally=t;this.root=null;this.promises=[]}get size(){return this.promises.length}add(e){return this.promises.push(e),this.root||=this.drain(),this.promises.length===1&&this.then(this.onFinally),e}async drain(){for(;this.promises.length>0;){try{await this.promises[0]}catch(e){this.onError(e)}this.promises.shift()}this.root=null}then(e,t){return(this.root??Promise.resolve()).then(e,t)}},Av=(e,t)=>{if(!e)return e;if(!Array.isArray(e)){if(typeof e==`function`||typeof e==`string`)return t?{fn:e,subType:t}:{fn:e};if(`fn`in e)return e}let n=[];for(let r of e)typeof r==`function`||typeof r==`string`?n.push(t?{fn:r,subType:t}:{fn:r}):`fn`in r&&n.push(r);return n},jv=e=>(e.start&&(e.start=Av(e.start)),e.request&&(e.request=Av(e.request)),e.parse&&(e.parse=Av(e.parse)),e.transform&&(e.transform=Av(e.transform)),e.beforeHandle&&(e.beforeHandle=Av(e.beforeHandle)),e.afterHandle&&(e.afterHandle=Av(e.afterHandle)),e.mapResponse&&(e.mapResponse=Av(e.mapResponse)),e.afterResponse&&(e.afterResponse=Av(e.afterResponse)),e.trace&&(e.trace=Av(e.trace)),e.error&&(e.error=Av(e.error)),e.stop&&(e.stop=Av(e.stop)),e),Mv=e=>{let t=Object.create(null);return e.start?.map&&(t.start=e.start.map(e=>e.fn)),e.request?.map&&(t.request=e.request.map(e=>e.fn)),e.parse?.map&&(t.parse=e.parse.map(e=>e.fn)),e.transform?.map&&(t.transform=e.transform.map(e=>e.fn)),e.beforeHandle?.map&&(t.beforeHandle=e.beforeHandle.map(e=>e.fn)),e.afterHandle?.map&&(t.afterHandle=e.afterHandle.map(e=>e.fn)),e.mapResponse?.map&&(t.mapResponse=e.mapResponse.map(e=>e.fn)),e.afterResponse?.map&&(t.afterResponse=e.afterResponse.map(e=>e.fn)),e.error?.map&&(t.error=e.error.map(e=>e.fn)),e.stop?.map&&(t.stop=e.stop.map(e=>e.fn)),e.trace?.map?t.trace=e.trace.map(e=>e.fn):t.trace=[],t},Nv=e=>({body:e.body,cookie:e.cookie,headers:e.headers,query:e.query,set:e.set,server:e.server,path:e.path,route:e.route,url:e.url}),Pv=(e,t=302)=>Response.redirect(e,t),Fv=Symbol(`ElysiaFormData`),Iv=Symbol(`ElysiaRequestId`),Lv=e=>{let t=new FormData;if(t[Fv]={},e)for(let[n,r]of Object.entries(e)){if(Array.isArray(r)){t[Fv][n]=[];for(let e of r)r instanceof File?t.append(n,r,r.name):r instanceof Q_?t.append(n,r.value,r.value?.name):t.append(n,r),t[Fv][n].push(r);continue}r instanceof File?t.append(n,r,r.name):r instanceof Q_?t.append(n,r.value,r.value?.name):t.append(n,r),t[Fv][n]=r}return t},Rv=()=>{let e=crypto.randomUUID();return e.slice(0,8)+e.slice(24,32)},zv=e=>{if(!e.length)return[];let t=[];for(let n=0;n<e.length;n++){let r=e[n];r.checksum&&(t.includes(r.checksum)&&(e.splice(n,1),n--),t.push(r.checksum))}return e},Bv=(e,t=`scoped`)=>{if(e){if(t===`scoped`){for(let t of e)`scope`in t&&t.scope===`local`&&(t.scope=`scoped`);return}for(let t of e)`scope`in t&&(t.scope=`global`)}},Vv=e=>e.charCodeAt(e.length-1)===47?e.slice(0,e.length-1):e+`/`,X=e=>{if(!e)return!1;for(let t in e)return!0;return!1},Hv=(e,{dynamic:t=!1}={})=>{let n=encodeURIComponent(e).replace(/%2F/g,`/`);return t&&(n=n.replace(/%3A/g,`:`).replace(/%3F/g,`?`)),n},Uv=(()=>{if(typeof Bun>`u`)return!0;let e=Bun.version.split(`.`);return!(+e[0]<1||+e[1]<2||+e[2]<14)})(),Wv=e=>(typeof e==`string`&&(e={data:e}),e.id===void 0&&(e.id=Rv()),e.toStream=()=>{let t=``;return e.id!==void 0&&e.id!==null&&(t+=`id: ${e.id}
`),e.event&&(t+=`event: ${e.event}
`),e.retry!==void 0&&(t+=`retry: ${e.retry}
`),e.data===null?t+=`data: null
`:typeof e.data==`string`?t+=`data: ${e.data}
`:typeof e.data==`object`&&(t+=`data: ${JSON.stringify(e.data)}
`),t&&(t+=`
`),t},e);var Gv=typeof Bun<`u`?Bun.env:typeof process<`u`?process?.env:void 0,Kv=Symbol(`ElysiaErrorCode`),qv=(Gv?.NODE_ENV??Gv?.ENV)===`production`,Jv=class{constructor(e,t){let n=t??(e in bv?bv[e]:e);this.code=yv[e]??e,this.response=n}},Yv=(e,t)=>new Jv(e,t),Xv=Yv,Zv=class extends Error{constructor(e){super(e??`INTERNAL_SERVER_ERROR`);this.code=`INTERNAL_SERVER_ERROR`;this.status=500}},Qv=class extends Error{constructor(e){super(e??`NOT_FOUND`);this.code=`NOT_FOUND`;this.status=404}},$v=class extends Error{constructor(e){super(`Bad Request`,{cause:e});this.code=`PARSE`;this.status=400}},ey=class extends Error{constructor(e,t){super(t??`"${e}" has invalid cookie signature`);this.key=e;this.code=`INVALID_COOKIE_SIGNATURE`;this.status=400}},ty=e=>{if(!e)return{summary:void 0};let{message:t,path:n,value:r,type:i}=e,a=n.slice(1).replaceAll(`/`,`.`),o=n===``;switch(i){case 42:return{...e,summary:o?`Value should not be provided`:`Property '${a}' should not be provided`};case 45:return{...e,summary:o?`Value is missing`:`Property '${a}' is missing`};case 50:let n=t.indexOf(`'`),i=t.slice(n+1,t.indexOf(`'`,n+1));return{...e,summary:o?`Value should be an email`:`Property '${a}' should be ${i}`};case 54:return{...e,summary:`${t.slice(0,9).trim()} property '${a}' to be ${t.slice(8).trim()} but found: ${r}`};case 62:let s=e.schema.anyOf.map(e=>`'${e?.format??e.type}'`).join(`, `);return{...e,summary:o?`Value should be one of ${s}`:`Property '${a}' should be one of: ${s}`};default:return{summary:t,...e}}},ny=class e extends Error{constructor(t,n,r=`"${t}" has invalid file type`){super(r);this.property=t;this.expected=n;this.message=r;this.code=`INVALID_FILE_TYPE`;this.status=422;Object.setPrototypeOf(this,e.prototype)}toResponse(e){return qv?new Response(JSON.stringify({type:`validation`,on:`body`}),{status:422,headers:{...e,"content-type":`application/json`}}):new Response(JSON.stringify({type:`validation`,on:`body`,summary:`Invalid file type`,message:this.message,property:this.property,expected:this.expected}),{status:422,headers:{...e,"content-type":`application/json`}})}},Z=class e extends Error{constructor(t,n,r,i){r&&typeof r==`object`&&r instanceof Jv&&(r=r.response);let a=i?.First()||(qv?void 0:`Errors`in n?n.Errors(r).First():hf(n,r).First()),o=a?.schema?.message||a?.schema?.error!==void 0?typeof a.schema.error==`function`?a.schema.error({type:t,validator:n,value:r,get errors(){return[...n.Errors(r)].map(ty)}}):a.schema.error:void 0,s=a?.path||`root`,c=``;if(o!==void 0)c=typeof o==`object`?JSON.stringify(o):o+``;else if(qv)c=JSON.stringify({type:`validation`,on:t,summary:ty(a).summary,message:a?.message,found:r});else{let e=n?.schema??n,i=`Errors`in n?[...n.Errors(r)].map(ty):[...hf(n,r)].map(ty),o;try{o=cp(e)}catch(e){o={type:`Could not create expected value`,message:e?.message,error:e}}c=JSON.stringify({type:`validation`,on:t,summary:ty(a).summary,property:s,message:a?.message,expected:o,found:r,errors:i},null,2)}super(c);this.type=t;this.validator=n;this.value=r;this.code=`VALIDATION`;this.status=422;Object.setPrototypeOf(this,e.prototype)}get all(){return`Errors`in this.validator?[...this.validator.Errors(this.value)].map(ty):[...hf(this.validator,this.value)].map(ty)}static simplifyModel(e){let t=`schema`in e?e.schema:e;try{return cp(t)}catch{return t}}get model(){return e.simplifyModel(this.validator)}toResponse(e){return new Response(this.message,{status:400,headers:{...e,"content-type":`application/json`}})}};var ry=(e,t)=>{try{return JSON.parse(e)}catch{throw new Z(`property`,t,e)}};function iy(e,t){return Fn(e)||In(e,t),(t={})=>uu({...t,[M]:e})}var ay=e=>{try{let t=Rm.Compile(e);return t.Create=()=>cp(e),t.Error=n=>new Z(`property`,e,n,t.Errors(n)),t}catch{return{Check:t=>Od(e,t),CheckThrow:t=>{if(!Od(e,t))throw new Z(`property`,e,t,hf(e,t))},Decode:t=>mm(e,t),Create:()=>cp(e),Error:t=>new Z(`property`,e,t,hf(e,t))}}},oy=e=>{if(typeof e==`string`)switch(e.slice(-1)){case`k`:return+e.slice(0,e.length-1)*1024;case`m`:return+e.slice(0,e.length-1)*1048576;default:return+e}return e},sy=(e,t)=>e.startsWith(t)?!0:t.charCodeAt(t.length-1)===42&&t.charCodeAt(t.length-2)===47&&e.startsWith(t.slice(0,-1)),cy=!1,ly=()=>{cy||(console.warn(`[Elysia] Attempt to validate file type without 'file-type'. This may lead to security risks. We recommend installing 'file-type' to properly validate file extension.`),cy=!0)},uy=async()=>Promise.resolve().then(()=>(l_(),Zg)).then(e=>(dy=e.fileTypeFromBlob,dy)).catch(ly),dy,fy=e=>dy?dy(e):uy().then(t=>{if(t)return t(e)}),py=async(e,t,n=e?.name??``)=>{if(Array.isArray(e))return await Promise.all(e.map(e=>py(e,t,n))),!0;if(!e)return!1;let r=await fy(e);if(!r)throw new ny(n,t);if(typeof t==`string`&&!sy(r.mime,t))throw new ny(n,t);for(let e=0;e<t.length;e++)if(sy(r.mime,t[e]))return!0;throw new ny(n,t)},my=(e,t)=>{if(t instanceof Q_)return!0;if(!(t instanceof Blob)||e.minSize&&t.size<oy(e.minSize)||e.maxSize&&t.size>oy(e.maxSize))return!1;if(e.extension){if(typeof e.extension==`string`)return sy(t.type,e.extension);for(let n=0;n<e.extension.length;n++)if(sy(t.type,e.extension[n]))return!0;return!1}return!0};var Q=Object.assign({},pu);iy(`UnionEnum`,(e,t)=>(typeof t==`number`||typeof t==`string`||t===null)&&e.enum.includes(t));var hy=iy(`Files`,(e,t)=>{if(!Array.isArray(t))return my(e,t);if(e.minItems&&t.length<e.minItems||e.maxItems&&t.length>e.maxItems)return!1;for(let n=0;n<t.length;n++)if(!my(e,t[n]))return!1;return!0}),gy=iy(`ElysiaForm`,({compiler:e,...t},n)=>{if(!(n instanceof FormData))return!1;if(e){if(!(Fv in n))throw new Z(`property`,t,n);if(!e.Check(n[Fv]))throw e.Error(n[Fv])}return!0}),_y={String:e=>pu.String(e),Numeric:e=>{let t=pu.Number(e),n=ay(t);return Q.Transform(Q.Union([Q.String({format:`numeric`,default:0}),Q.Number(e)],e)).Decode(t=>{let r=+t;if(isNaN(r))return t;if(e&&!n.Check(r))throw n.Error(t);return r}).Encode(e=>e)},Integer:e=>{let t=pu.Integer(e),n=ay(t);return Q.Transform(Q.Union([Q.String({format:`integer`,default:0}),pu.Integer(e)],e)).Decode(e=>{let t=+e;if(!n.Check(t))throw n.Error(t);return t}).Encode(e=>e)},Date:e=>{let t=pu.Date(e),n=ay(t),r=e?.default?new Date(e.default):void 0;return Q.Transform(Q.Union([pu.Date(e),Q.String({format:`date-time`,default:r?.toISOString()}),Q.String({format:`date`,default:r?.toISOString()}),Q.Number({default:r?.getTime()})],e)).Decode(e=>{if(typeof e==`number`){let t=new Date(e);if(!n.Check(t))throw n.Error(t);return t}if(e instanceof Date)return e;let r=new Date(E_(e));if(!r||isNaN(r.getTime()))throw new Z(`property`,t,r);if(!n.Check(r))throw n.Error(r);return r}).Encode(e=>e.toISOString())},BooleanString:e=>{let t=pu.Boolean(e),n=ay(t);return Q.Transform(Q.Union([Q.Boolean(e),Q.String({format:`boolean`,default:!1})],e)).Decode(e=>{if(typeof e==`string`)return e===`true`;if(e!==void 0&&!n.Check(e))throw n.Error(e);return e}).Encode(e=>e)},ObjectString:(e,t)=>{let n=Q.Object(e,t),r=ay(n),i=JSON.stringify(r.Create());return Q.Transform(Q.Union([Q.String({format:`ObjectString`,default:i}),n])).Decode(e=>{if(typeof e==`string`){if(e.charCodeAt(0)!==123)throw new Z(`property`,n,e);if(!r.Check(e=ry(e,n)))throw r.Error(e);return r.Decode(e)}return e}).Encode(e=>{let t;if(typeof e==`string`&&(e=ry(t=e,n)),!r.Check(e))throw r.Error(e);return t??JSON.stringify(e)})},ArrayString:(e=Q.String(),t)=>{let n=Q.Array(e,t),r=ay(n),i=(e,t=!1)=>{if(e.charCodeAt(0)===91){if(!r.Check(e=ry(e,n)))throw r.Error(e);return r.Decode(e)}if(e.indexOf(`,`)!==-1){if(!r.Check(e))throw r.Error(e);return r.Decode(e)}if(t)return e;throw new Z(`property`,n,e)};return Q.Transform(Q.Union([Q.String({format:`ArrayString`,default:t?.default}),n])).Decode(e=>{if(Array.isArray(e)){let t=[];for(let n=0;n<e.length;n++){let r=e[n];if(typeof r==`string`){let e=i(r,!0);Array.isArray(e)?t=t.concat(e):t.push(e);continue}t.push(r)}return t}return typeof e==`string`?i(e):e}).Encode(e=>{let t;if(typeof e==`string`&&(e=ry(t=e,n)),!r.Check(e))throw new Z(`property`,n,e);return t??JSON.stringify(e)})},File:iy(`File`,my),Files:(e={})=>Q.Transform(hy(e)).Decode(e=>Array.isArray(e)?e:[e]).Encode(e=>e),Nullable:(e,t)=>Q.Union([e,Q.Null()],t),MaybeEmpty:(e,t)=>Q.Union([e,Q.Null(),Q.Undefined()],t),Cookie:(e,{domain:t,expires:n,httpOnly:r,maxAge:i,path:a,priority:o,sameSite:s,secure:c,secrets:l,sign:u,...d}={})=>{let f=Q.Object(e,d);return f.config={domain:t,expires:n,httpOnly:r,maxAge:i,path:a,priority:o,sameSite:s,secure:c,secrets:l,sign:u},f},UnionEnum:(e,t={})=>{let n=e.every(e=>typeof e==`string`)?{type:`string`}:e.every(e=>typeof e==`number`)?{type:`number`}:e.every(e=>e===null)?{type:`null`}:{};if(e.some(e=>typeof e==`object`&&e!==null))throw new Error(`This type does not support objects or arrays`);return{default:e[0],...t,[M]:`UnionEnum`,...n,enum:e}},NoValidate:(e,t=!0)=>(e.noValidate=t,e),Form:(e,t={})=>{let n=Q.Object(e,{default:Lv({}),...t}),r=ay(n);return Q.Union([n,gy({compiler:r})])}};Q.BooleanString=_y.BooleanString;Q.ObjectString=_y.ObjectString;Q.ArrayString=_y.ArrayString;Q.Numeric=_y.Numeric;Q.Integer=_y.Integer;Q.File=e=>(e?.type&&uy(),_y.File({default:`File`,...e,extension:e?.type,type:`string`,format:`binary`}));Q.Files=e=>(e?.type&&uy(),_y.Files({...e,elysiaMeta:`Files`,default:`Files`,extension:e?.type,type:`array`,items:{...e,default:`Files`,type:`string`,format:`binary`}}));Q.Nullable=e=>_y.Nullable(e);Q.MaybeEmpty=_y.MaybeEmpty;Q.Cookie=_y.Cookie;Q.Date=_y.Date;Q.UnionEnum=_y.UnionEnum;Q.NoValidate=_y.NoValidate;Q.Form=_y.Form;var vy=e=>{e.startsWith(`async`)&&(e=e.slice(5)),e=e.trimStart();let t=-1;if(e.charCodeAt(0)===40&&(t=e.indexOf(`=>`,e.indexOf(`)`)),t!==-1)){let n=t;for(;n>0&&e.charCodeAt(--n)!==41;);let r=e.slice(t+2);return r.charCodeAt(0)===32&&(r=r.trimStart()),[e.slice(1,n),r,{isArrowReturn:r.charCodeAt(0)!==123}]}if(/^(\w+)=>/g.test(e)&&(t=e.indexOf(`=>`),t!==-1)){let n=e.slice(t+2);return n.charCodeAt(0)===32&&(n=n.trimStart()),[e.slice(0,t),n,{isArrowReturn:n.charCodeAt(0)!==123}]}if(e.startsWith(`function`)){t=e.indexOf(`(`);let n=e.indexOf(`)`);return[e.slice(t+1,n),e.slice(n+2),{isArrowReturn:!1}]}let n=e.indexOf(`(`);if(n!==-1){let t=e.indexOf(`
`,2),r=e.slice(0,t),i=r.lastIndexOf(`)`)+1,a=e.slice(t+1);return[r.slice(n,i),`{`+a,{isArrowReturn:!1}]}let r=e.split(`
`,2);return[r[0],r[1],{isArrowReturn:!1}]},yy=e=>{let t=e.indexOf(`{`);if(t===-1)return[-1,0];let n=t+1,r=1;for(;n<e.length;n++){let t=e.charCodeAt(n);if(t===123?r++:t===125&&r--,r===0)break}return r!==0?[0,e.length]:[t,n+1]},by=e=>{let t=e.lastIndexOf(`}`);if(t===-1)return[-1,0];let n=t-1,r=1;for(;n>=0;n--){let t=e.charCodeAt(n);if(t===125?r++:t===123&&r--,r===0)break}return r!==0?[-1,0]:[n,t+1]},xy=e=>{for(;;){let t=e.indexOf(`:`);if(t===-1)break;let n=e.indexOf(`,`,t);n===-1&&(n=e.indexOf(`}`,t)-1),n===-2&&(n=e.length),e=e.slice(0,t)+e.slice(n)}return e},Sy=e=>{let t=!1;e.charCodeAt(0)===40&&(e=e.slice(1,-1)),e.charCodeAt(0)===123&&(t=!0,e=e.slice(1,-1)),e=e.replace(/( |\t|\n)/g,``).trim();let n=[];for(;;){let[t,r]=yy(e);if(t===-1)break;n.push(e.slice(0,t-1)),e.charCodeAt(r)===44&&r++,e=e.slice(r)}e=xy(e),e&&(n=n.concat(e.split(`,`)));let r=Object.create(null);for(let e of n){if(e.indexOf(`,`)===-1){r[e]=!0;continue}for(let t of e.split(`,`))r[t.trim()]=!0}return{hasParenthesis:t,parameters:r}},Cy=(e,t)=>{let{parameters:n,hasParenthesis:r}=Sy(e);return n.query&&(t.query=!0),n.headers&&(t.headers=!0),n.body&&(t.body=!0),n.cookie&&(t.cookie=!0),n.set&&(t.set=!0),n.server&&(t.server=!0),n.route&&(t.route=!0),n.url&&(t.url=!0),n.path&&(t.path=!0),r?`{ ${Object.keys(n).join(`, `)} }`:Object.keys(n).join(`, `)},wy=(e,t,n)=>{let r=new RegExp(`${e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}[\\n\\t,; ]`);n!==void 0&&(r.lastIndex=n);let i=r.exec(t);return i?i.index:-1};var Ty=(e,t,n=0)=>{if(n>5)return[];let r=[],i=t;for(;;){let t=wy(` = `+e,i);if(t===-1&&(t=wy(`=`+e,i)),t===-1){let n=i.indexOf(` = `+e);if(n===-1&&(n=i.indexOf(`=`+e)),n+3+e.length!==i.length)break;t=n}let n=i.slice(0,t),a=n.lastIndexOf(` `),o=n.slice(a!==-1?a+1:-1);if(o===`}`){let[a,o]=by(n);r.push(xy(i.slice(a,o))),i=i.slice(t+3+e.length);continue}for(;o.charCodeAt(0)===44;)o=o.slice(1);for(;o.charCodeAt(0)===9;)o=o.slice(1);o.includes(`(`)||r.push(o),i=i.slice(t+3+e.length)}for(let e of r){if(e.charCodeAt(0)===123)continue;let n=Ty(e,t);n.length>0&&r.push(...n)}return r},Ey=e=>{if(!e)return;if(e.charCodeAt(0)!==123)return e;if(e=e.slice(2,-2),!e.includes(`,`))return e.indexOf(`...`)!==-1?e.slice(e.indexOf(`...`)+3):void 0;let t=e.indexOf(`...`);if(t!==-1)return e.slice(t+3).trimEnd()},Dy=(e,t,n)=>{let r=(t,n)=>new RegExp(`${n}\\.(${t})|${n}\\["${t}"\\]|${n}\\['${t}'\\]`).test(e);for(let i of t)if(i){if(i.charCodeAt(0)===123){let e=Sy(i).parameters;e.query&&(n.query=!0),e.headers&&(n.headers=!0),e.body&&(n.body=!0),e.cookie&&(n.cookie=!0),e.set&&(n.set=!0),e.server&&(n.server=!0),e.url&&(n.url=!0),e.route&&(n.route=!0),e.path&&(n.path=!0);continue}if(!n.query&&(r(`query`,i)||e.includes(`return `+i)||e.includes(`return `+i+`.query`))&&(n.query=!0),!n.headers&&r(`headers`,i)&&(n.headers=!0),!n.body&&r(`body`,i)&&(n.body=!0),!n.cookie&&r(`cookie`,i)&&(n.cookie=!0),!n.set&&r(`set`,i)&&(n.set=!0),!n.server&&r(`server`,i)&&(n.server=!0),!n.route&&r(`route`,i)&&(n.route=!0),!n.url&&r(`url`,i)&&(n.url=!0),!n.path&&r(`path`,i)&&(n.path=!0),n.query&&n.headers&&n.body&&n.cookie&&n.set&&n.server&&n.route&&n.url&&n.path)break}return t};var Oy=(e,t,n)=>{try{let r=new RegExp(`\\w\\((.*?)?${e}`,`gs`);r.test(t);let i=t.charCodeAt(r.lastIndex);return i===41||i===44?(n.query=!0,n.headers=!0,n.body=!0,n.cookie=!0,n.set=!0,n.server=!0,n.url=!0,n.route=!0,n.path=!0,!0):!1}catch{return console.log(`[Sucrose] warning: unexpected isContextPassToFunction error, you may continue development as usual but please report the following to maintainers:`),console.log(`--- body ---`),console.log(t),console.log(`--- context ---`),console.log(e),!0}},ky,Ay={},jy=(e=0)=>{ky&&clearTimeout(ky),ky=setTimeout(()=>{Ay={},ky=void 0,K_&&Bun.gc(!1)},e)},My=(e,t)=>({body:e.body||t.body,cookie:e.cookie||t.cookie,headers:e.headers||t.headers,query:e.query||t.query,set:e.set||t.set,server:e.server||t.server,url:e.url||t.url,route:e.route||t.route,path:e.path||t.path}),Ny=(e,t={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,url:!1,route:!1,path:!1})=>{let n=[];e.request?.length&&n.push(...e.request),e.beforeHandle?.length&&n.push(...e.beforeHandle),e.parse?.length&&n.push(...e.parse),e.error?.length&&n.push(...e.error),e.transform?.length&&n.push(...e.transform),e.afterHandle?.length&&n.push(...e.afterHandle),e.mapResponse?.length&&n.push(...e.mapResponse),e.afterResponse?.length&&n.push(...e.afterResponse),e.handler&&typeof e.handler==`function`&&n.push(e.handler);for(let e=0;e<n.length;e++){let r=n[e];if(!r)continue;let i=typeof r==`object`?r.fn:r;if(typeof i!=`function`)continue;let a=i.toString(),o=pv(a),s=Ay[o];if(s){t=My(t,s);continue}let c={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,url:!1,route:!1,path:!1},[l,u]=vy(a),d=Cy(l,c),f=Ey(d);if(f){let e=Ty(f,u.slice(1,-1));e.splice(0,-1,f);let t=u;t.charCodeAt(0)===123&&t.charCodeAt(u.length-1)===125&&(t=t.slice(1,-1)),Oy(f,t,c)||Dy(t,e,c),!c.query&&t.includes(`return `+f+`.query`)&&(c.query=!0)}if(Ay[o]||(Ay[o]=c),t=My(t,c),t.query&&t.headers&&t.body&&t.cookie&&t.set&&t.server&&t.url&&t.route&&t.path)break}return t};var Py=class{constructor(e,t,n={}){this.name=e;this.jar=t;this.initial=n}get cookie(){return this.jar[this.name]??this.initial}set cookie(e){this.name in this.jar||(this.jar[this.name]=this.initial),this.jar[this.name]=e}get setCookie(){return this.name in this.jar||(this.jar[this.name]=this.initial),this.jar[this.name]}set setCookie(e){this.cookie=e}get value(){return this.cookie.value}set value(e){this.setCookie.value=e}get expires(){return this.cookie.expires}set expires(e){this.setCookie.expires=e}get maxAge(){return this.cookie.maxAge}set maxAge(e){this.setCookie.maxAge=e}get domain(){return this.cookie.domain}set domain(e){this.setCookie.domain=e}get path(){return this.cookie.path}set path(e){this.setCookie.path=e}get secure(){return this.cookie.secure}set secure(e){this.setCookie.secure=e}get httpOnly(){return this.cookie.httpOnly}set httpOnly(e){this.setCookie.httpOnly=e}get sameSite(){return this.cookie.sameSite}set sameSite(e){this.setCookie.sameSite=e}get priority(){return this.cookie.priority}set priority(e){this.setCookie.priority=e}get partitioned(){return this.cookie.partitioned}set partitioned(e){this.setCookie.partitioned=e}get secrets(){return this.cookie.secrets}set secrets(e){this.setCookie.secrets=e}update(e){return this.setCookie=Object.assign(this.cookie,typeof e==`function`?e(this.cookie):e),this}set(e){return this.setCookie=Object.assign({...this.initial,value:this.value},typeof e==`function`?e(this.cookie):e),this}remove(){if(this.value!==void 0)return this.set({expires:new Date(0),maxAge:0,value:``}),this}toString(){return typeof this.value==`object`?JSON.stringify(this.value):this.value?.toString()??``}},Fy=(e,t,n)=>(e.cookie||(e.cookie={}),new Proxy(t,{get(r,i){return i in t?new Py(i,e.cookie,Object.assign({},n??{},t[i])):new Py(i,e.cookie,Object.assign({},n))}})),Iy=async(e,t,{secrets:n,sign:r,...i}={})=>{if(!t)return Fy(e,{},i);let a=typeof n==`string`;r&&r!==!0&&!Array.isArray(r)&&(r=[r]);let o={},s=(0,u_.parse)(t);for(let[e,t]of Object.entries(s)){if(t===void 0)continue;let i=(0,d_.default)(t);if(r===!0||r?.includes(e)){if(!n)throw new Error(`No secret is provided to cookie plugin`);if(a){let t=await wv(i,n);if(t===!1)throw new ey(e);i=t}else{let t=!0;for(let e=0;e<n.length;e++){let r=await wv(i,n[e]);if(r!==!1){t=!0,i=r;break}}if(!t)throw new ey(e)}}o[e]={value:i}}return Fy(e,o,i)},Ly=e=>{if(!e||!X(e))return;let t=[];for(let[n,r]of Object.entries(e)){if(!n||!r)continue;let e=r.value;e!=null&&t.push((0,u_.serialize)(n,typeof e==`object`?JSON.stringify(e):e+``,r))}if(t.length!==0)return t.length===1?t[0]:t};var $=(e,t)=>{if(!K_&&e instanceof Promise)return e.then(e=>$(e,t));let n=e.size;if(!t&&n||n&&t&&t.status!==206&&t.status!==304&&t.status!==412&&t.status!==416){if(t){if(t.headers instanceof Headers){let r={"accept-ranges":`bytes`,"content-range":`bytes 0-${n-1}/${n}`,"transfer-encoding":`chunked`};if($_)r=t.headers.toJSON();else{r={};for(let[e,n]of t.headers.entries())e in t.headers&&(r[e]=n)}return new Response(e,{status:t.status,headers:r})}if(X(t.headers))return new Response(e,{status:t.status,headers:Object.assign({"accept-ranges":`bytes`,"content-range":`bytes 0-${n-1}/${n}`,"transfer-encoding":`chunked`},t.headers)})}return new Response(e,{headers:{"accept-ranges":`bytes`,"content-range":`bytes 0-${n-1}/${n}`,"transfer-encoding":`chunked`}})}return new Response(e)},Ry=(e,t)=>{if(!e)return e;e.delete(`set-cookie`);for(let n=0;n<t.length;n++){let r=t[n].indexOf(`=`);e.append(`set-cookie`,`${t[n].slice(0,r)}=${t[n].slice(r+1)||``}`)}return e},zy=(e,t)=>{if(t?.headers){if(e)if($_)Object.assign(t.headers,e.headers.toJSON());else for(let[n,r]of e.headers.entries())n in t.headers&&(t.headers[n]=r);return t.status===200&&(t.status=e.status),t.headers[`content-encoding`]&&delete t.headers[`content-encoding`],t}if(!e)return{headers:{},status:t?.status??200};if($_)return t={headers:e.headers.toJSON(),status:t?.status??200},t.headers[`content-encoding`]&&delete t.headers[`content-encoding`],t;t={headers:{},status:t?.status??200};for(let[n,r]of e.headers.entries())n!==`content-encoding`&&n in t.headers&&(t.headers[n]=r);return t},By=({mapResponse:e,mapCompactResponse:t})=>async(n,r,i)=>{let a=n.next();if(a instanceof Promise&&(a=await a),typeof a?.done>`u`||a?.done)return r?e(a.value,r,i):t(a.value,i);let o=a.value&&typeof a.value?.stream?`text/event-stream`:a.value&&typeof a.value==`object`?`application/json`:`text/plain`;return r?.headers?(r.headers[`transfer-encoding`]||(r.headers[`transfer-encoding`]=`chunked`),r.headers[`content-type`]||(r.headers[`content-type`]=o),r.headers[`cache-control`]||(r.headers[`cache-control`]=`no-cache`)):r={status:200,headers:{"content-type":o,"transfer-encoding":`chunked`,"cache-control":`no-cache`,connection:`keep-alive`}},new Response(new ReadableStream({async start(e){let t=!1;if(i?.signal?.addEventListener(`abort`,()=>{t=!0;try{e.close()}catch{}}),a.value!==void 0&&a.value!==null)if(a.value.toStream)e.enqueue(a.value.toStream());else if(typeof a.value==`object`)try{e.enqueue(Buffer.from(JSON.stringify(a.value)))}catch{e.enqueue(Buffer.from(a.value.toString()))}else e.enqueue(Buffer.from(a.value.toString()));for await(let r of n){if(t)break;if(r!=null){if(r.toStream)e.enqueue(r.toStream());else if(typeof r==`object`)try{e.enqueue(Buffer.from(JSON.stringify(r)))}catch{e.enqueue(Buffer.from(r.toString()))}else e.enqueue(Buffer.from(r.toString()));await new Promise(e=>setTimeout(()=>e(),0))}}try{e.close()}catch{}}}),r)};async function*Vy(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:e,value:t}=await n.read();if(e)break;yield r.decode(t)}}finally{n.releaseLock()}}var Hy=e=>{if(typeof e.status==`string`&&(e.status=yv[e.status]),e.cookie&&X(e.cookie)){let t=Ly(e.cookie);t&&(e.headers[`set-cookie`]=t)}e.headers[`set-cookie`]&&Array.isArray(e.headers[`set-cookie`])&&(e.headers=Ry(new Headers(e.headers),e.headers[`set-cookie`]))},Uy=e=>{let t=By(e);return(e,n,r)=>{let i=!1;if(n.headers instanceof Headers)for(let t of n.headers.keys())if(t===`set-cookie`){if(i)continue;i=!0;for(let t of n.headers.getSetCookie())e.headers.append(`set-cookie`,t)}else e.headers.append(t,n.headers?.get(t)??``);else for(let t in n.headers)e.headers.append(t,n.headers[t]);let a=n.status??200;return e.status!==a&&a!==200&&(e.status<=300||e.status>400)?e.text().then(i=>{let a=new Response(i,{headers:e.headers,status:n.status});return!a.headers.has(`content-length`)&&a.headers.get(`transfer-encoding`)===`chunked`?t(Vy(a),zy(a,n),r):a}):!e.headers.has(`content-length`)&&e.headers.get(`transfer-encoding`)===`chunked`?t(Vy(e),zy(e,n),r):e}};var Wy=(e,t,n)=>{if(X(t.headers)||t.status!==200||t.cookie)switch(Hy(t),e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return $(e.value);case`File`:return $(e,t);case`Blob`:return $(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Wy(e.response,t,n);case`ReadableStream`:return t.headers[`content-type`]?.startsWith(`text/event-stream`)||(t.headers[`content-type`]=`text/event-stream; charset=utf-8`),n?.signal?.addEventListener(`abort`,{handleEvent(){n?.signal&&!n?.signal?.aborted&&e.cancel()}},{once:!0}),new Response(e,t);case void 0:return e?new Response(JSON.stringify(e),t):new Response(``,t);case`Response`:return Yy(e,t,n);case`Error`:return qy(e,t);case`Promise`:return e.then(e=>Wy(e,t,n));case`Function`:return Wy(e(),t,n);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`Cookie`:return e instanceof Py?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e,t);default:if(e instanceof Response)return Yy(e,t,n);if(e instanceof Promise)return e.then(e=>Wy(e,t));if(e instanceof Error)return qy(e,t);if(e instanceof Jv)return t.status=e.code,Wy(e.response,t,n);if(typeof e?.next==`function`)return Xy(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Wy(e,t));if(typeof e?.toResponse==`function`)return Wy(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}return e instanceof Response&&!e.headers.has(`content-length`)&&e.headers.get(`transfer-encoding`)===`chunked`?Xy(Vy(e),zy(e,t),n):typeof e?.next==`function`||e instanceof ReadableStream?Xy(e,t,n):Ky(e,n)},Gy=(e,t,n)=>{if(e!=null)if(X(t.headers)||t.status!==200||t.cookie)switch(Hy(t),e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return $(e.value);case`File`:return $(e,t);case`Blob`:return $(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Gy(e.response,t,n);case`ReadableStream`:return t.headers[`content-type`]?.startsWith(`text/event-stream`)||(t.headers[`content-type`]=`text/event-stream; charset=utf-8`),n?.signal?.addEventListener(`abort`,{handleEvent(){n?.signal&&!n?.signal?.aborted&&e.cancel()}},{once:!0}),new Response(e,t);case void 0:return e?new Response(JSON.stringify(e),t):void 0;case`Response`:return Yy(e,t,n);case`Promise`:return e.then(e=>Gy(e,t));case`Error`:return qy(e,t);case`Function`:return Gy(e(),t);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`FormData`:return new Response(e);case`Cookie`:return e instanceof Py?new Response(e.value,t):new Response(e?.toString(),t);default:if(e instanceof Response)return Yy(e,t,n);if(e instanceof Promise)return e.then(e=>Gy(e,t));if(e instanceof Error)return qy(e,t);if(e instanceof Jv)return t.status=e.code,Gy(e.response,t,n);if(typeof e?.next==`function`)return Xy(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Gy(e,t));if(typeof e?.toResponse==`function`)return Gy(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}else switch(e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return $(e.value);case`File`:return $(e,t);case`Blob`:return $(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Gy(e.response,t,n);case`ReadableStream`:return n?.signal?.addEventListener(`abort`,{handleEvent(){n?.signal&&!n?.signal?.aborted&&e.cancel()}},{once:!0}),new Response(e,{headers:{"Content-Type":`text/event-stream; charset=utf-8`}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return!e.headers.has(`content-length`)&&e.headers.get(`transfer-encoding`)===`chunked`?Xy(Vy(e),zy(e),n):e;case`Promise`:return e.then(e=>{let n=Gy(e,t);if(n!==void 0)return n});case`Error`:return qy(e,t);case`Function`:return Ky(e(),n);case`Number`:case`Boolean`:return new Response(e.toString());case`Cookie`:return e instanceof Py?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>Gy(e,t));if(e instanceof Error)return qy(e,t);if(e instanceof Jv)return t.status=e.code,Gy(e.response,t,n);if(typeof e?.next==`function`)return Xy(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Gy(e,t));if(typeof e?.toResponse==`function`)return Gy(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e)}},Ky=(e,t)=>{switch(e?.constructor?.name){case`String`:return new Response(e,{headers:{"Content-Type":`text/plain`}});case`Object`:case`Array`:return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}});case`ElysiaFile`:return $(e.value);case`File`:return $(e);case`Blob`:return $(e);case`ElysiaCustomStatusResponse`:return Wy(e.response,{status:e.code,headers:{}});case`ReadableStream`:return t?.signal?.addEventListener(`abort`,{handleEvent(){t?.signal&&!t?.signal?.aborted&&e.cancel()}},{once:!0}),new Response(e,{headers:{"Content-Type":`text/event-stream; charset=utf-8`}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e.headers.get(`transfer-encoding`)===`chunked`?Xy(Vy(e),zy(e),t):e;case`Error`:return qy(e);case`Promise`:return e.then(e=>Ky(e,t));case`Function`:return Ky(e(),t);case`Number`:case`Boolean`:return new Response(e.toString());case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>Ky(e,t));if(e instanceof Error)return qy(e);if(e instanceof Jv)return Wy(e.response,{status:e.code,headers:{}});if(typeof e?.next==`function`)return Xy(e,void 0,t);if(typeof e?.then==`function`)return e.then(e=>Wy(e,set));if(typeof e?.toResponse==`function`)return Ky(e.toResponse());if(`charCodeAt`in e){let t=e.charCodeAt(0);if(t===123||t===91)return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}})}return new Response(e)}},qy=(e,t)=>new Response(JSON.stringify({name:e?.name,message:e?.message,cause:e?.cause}),{status:t?.status!==200?t?.status??500:500,headers:t?.headers}),Jy=(e,t,n={})=>{if(typeof e==`function`)return;let r=Wy(e,{headers:n});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return r.clone.bind(r)},Yy=Uy({mapResponse:Wy,mapCompactResponse:Ky}),Xy=By({mapResponse:Wy,mapCompactResponse:Ky});var Zy={name:`web-standard`,isWebStandard:!0,handler:{mapResponse:Wy,mapEarlyResponse:Gy,mapCompactResponse:Ky,createStaticHandler:Jy},composeHandler:{mapResponseContext:`c.request`,preferWebstandardHeaders:!0,headers:`c.headers={}
for(const [k,v] of c.request.headers.entries())c.headers[k]=v
`,parser:{json(e){return e?`try{c.body=await c.request.json()}catch{}
`:`c.body=await c.request.json()
`},text(){return`c.body=await c.request.text()
`},urlencoded(){return`c.body=parseQuery(await c.request.text())
`},arrayBuffer(){return`c.body=await c.request.arrayBuffer()
`},formData(e){let t=`
c.body={}
`;return e?t+=`let form;try{form=await c.request.formData()}catch{}`:t+=`const form=await c.request.formData()
`,t+`for(const key of form.keys()){if(c.body[key]) continue
const value=form.getAll(key)
if(value.length===1)c.body[key]=value[0]
else c.body[key]=value}`}}},async stop(e,t){if(!e.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(e.server&&(e.server.stop(t),e.server=null,e.event.stop?.length))for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)},composeGeneralHandler:{parameters:`r`,createContext(e){let t=``,n=``,r=e.setHeaders;for(let n of Object.keys(e.decorator))t+=`,'${n}':decorator['${n}']`;let i=e.config.handler?.standardHostname??!0,a=!!e.event.trace?.length;return n+=`const u=r.url,s=u.indexOf('/',${i?11:7}),qi=u.indexOf('?',s+1)
let p
if(qi===-1)p=u.substring(s)
else p=u.substring(s, qi)
`,a&&(n+=`const id=randomId()
`),n+=`const c={request:r,store,qi,path:p,url:u,redirect,error:status,status,set:{headers:`,n+=Object.keys(r??{}).length?`Object.assign({},app.setHeaders)`:`Object.create(null)`,n+=`,status:200}`,e.inference.server&&(n+=`,get server(){return app.getServer()}`),a&&(n+=`,[ELYSIA_REQUEST_ID]:id`),n+=t,n+=`}
`,n},error404(e,t){let n=`if(route===null)return `;return t?n+=`app.handleError(c,notFound,false,${this.parameters})`:n+=e?`new Response(error404Message,{status:c.set.status===200?404:c.set.status,headers:c.set.headers})`:`error404.clone()`,{declare:t?``:`const error404Message=notFound.message.toString()
const error404=new Response(error404Message,{status:404})
`,code:n}}},composeError:{mapResponseContext:``,validationError:`return new Response(error.message,{headers:Object.assign({'content-type':'application/json'},set.headers),status:set.status})`,unknownError:`return new Response(error.message,{headers:set.headers,status:error.status??set.status??500})`},listen(){return()=>{throw new Error(`WebStandard does not support listen, you might want to export default Elysia.fetch instead`)}}};function Qy(e,t=0){let n=Object.create(null),r=1,i=2,a=4,o=8,s=0,c=t-1,l=c,u=e.length;for(let n=t;n<u;n++)switch(e.charCodeAt(n)){case 38:d(n),c=n,l=n,s=0;break;case 61:l<=c?l=n:s|=o;break;case 43:l>c?s|=a:s|=r;break;case 37:l>c?s|=o:s|=i;break}return d(u),n;function d(t){let u=l>c,d=u?l:t;if(d<=c+1)return;let f=e.slice(c+1,d);if(s&r&&(f=f.replace(/\+/g,` `)),s&i&&(f=(0,p_.default)(f)||f),n[f]!==void 0)return;let p=``;u&&(p=e.slice(l+1,t),s&a&&(p=p.replace(/\+/g,` `)),s&o&&(p=(0,p_.default)(p)||p)),n[f]=p}}function $y(e){let t=Object.create(null),n=0,r=1,i=2,a=4,o=8,s=e.length,c=-1,l=-1;for(let t=0;t<s;t++)switch(e.charCodeAt(t)){case 38:u(e,t),c=t,l=t,n=0;break;case 61:l<=c?l=t:n|=o;break;case 43:l>c?n|=a:n|=r;break;case 37:l>c?n|=o:n|=i;break}return c<s&&u(e,s),t;function u(e,s){let u=l>c,d=u?l:s,f=e.slice(c+1,d);if(!u&&f.length===0)return;let p=f;n&r&&(p=p.replace(/\+/g,` `)),n&i&&(p=(0,p_.default)(p)||p);let m=``;if(u){let t=e.slice(l+1,s);n&a&&(t=t.replace(/\+/g,` `)),n&o&&(t=(0,p_.default)(t)||t),m=t}let h=t[p];h===void 0?t[p]=m:Array.isArray(h)?h.push(m):t[p]=[h,m]}}var eb=Symbol(`ElysiaTrace`),tb=()=>{let{promise:e,resolve:t}=Promise.withResolvers(),{promise:n,resolve:r}=Promise.withResolvers(),{promise:i,resolve:a}=Promise.withResolvers(),o=[],s=[];return[t=>(t&&o.push(t),e),e=>{let c=[],l=[],u=null;for(let t=0;t<(e.total??0);t++){let{promise:e,resolve:n}=Promise.withResolvers(),{promise:r,resolve:i}=Promise.withResolvers(),{promise:a,resolve:o}=Promise.withResolvers(),s=[],d=[];c.push(t=>(t&&s.push(t),e)),l.push(e=>{let c={...e,end:r,error:a,index:t,onStop(e){return e&&d.push(e),r}};n(c);for(let e=0;e<s.length;e++)s[e](c);return(t=null)=>{let n=performance.now();t&&(u=t);let r={end:n,error:t,get elapsed(){return n-e.begin}};for(let e=0;e<d.length;e++)d[e](r);i(n),o(t)}})}let d={...e,end:n,error:i,onEvent(e){for(let t=0;t<c.length;t++)c[t](e)},onStop(e){return e&&s.push(e),n}};t(d);for(let e=0;e<o.length;e++)o[e](d);return{resolveChild:l,resolve(t=null){let n=performance.now();!t&&u&&(t=u);let i={end:n,error:t,get elapsed(){return n-e.begin}};for(let e=0;e<s.length;e++)s[e](i);r(n),a(t)}}}]},nb=e=>t=>{let[n,r]=tb(),[i,a]=tb(),[o,s]=tb(),[c,l]=tb(),[u,d]=tb(),[f,p]=tb(),[m,h]=tb(),[g,_]=tb(),[ee,v]=tb();return e({id:t[Iv],context:t,set:t.set,onRequest:n,onParse:i,onTransform:o,onBeforeHandle:c,onHandle:u,onAfterHandle:f,onMapResponse:g,onAfterResponse:ee,onError:m,time:Date.now(),store:t.store}),{request:r,parse:a,transform:s,beforeHandle:l,handle:d,afterHandle:p,error:h,mapResponse:_,afterResponse:v}};var rb=e=>e?e?.[M]===`Import`&&e.References?e.References().some(rb):(e.schema&&(e=e.schema),!!e&&Pe in e):!1,ib=e=>{if(!e)return!1;let t=e?.schema??e;if(t[M]===`Import`&&e.References)return e.References().some(ib);if(t.anyOf)return t.anyOf.some(ib);if(t.someOf)return t.someOf.some(ib);if(t.allOf)return t.allOf.some(ib);if(t.not)return t.not.some(ib);if(t.type===`object`){let e=t.properties;if(`additionalProperties`in t)return t.additionalProperties;if(`patternProperties`in t)return!1;for(let t of Object.keys(e)){let n=e[t];if(n.type===`object`){if(ib(n))return!0}else if(n.anyOf){for(let e=0;e<n.anyOf.length;e++)if(ib(n.anyOf[e]))return!0}return n.additionalProperties}return!1}return t.type===`array`&&t.items&&!Array.isArray(t.items)?ib(t.items):!1},ab=(e,t)=>{if(!t)return!1;if(M in t&&t[M]===e)return!0;if(t.type===`object`){let n=t.properties;if(!n)return!1;for(let t of Object.keys(n)){let r=n[t];if(r.type===`object`){if(ab(e,r))return!0}else if(r.anyOf){for(let t=0;t<r.anyOf.length;t++)if(ab(e,r.anyOf[t]))return!0}if(M in r&&r[M]===e)return!0}return!1}return!!t.properties&&M in t.properties&&t.properties[M]===e},ob=(e,t)=>{if(!t)return;let n=t.schema??t;if(n[M]===`Import`&&t.References)return t.References().some(t=>ob(e,t));if(n.type===`object`){let t=n.properties;if(!t)return!1;for(let n of Object.keys(t)){let r=t[n];if(e in r)return!0;if(r.type===`object`){if(ob(e,r))return!0}else if(r.anyOf){for(let t=0;t<r.anyOf.length;t++)if(ob(e,r.anyOf[t]))return!0}}return!1}return e in n},sb=e=>{if(!e)return!1;if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(sb(e.oneOf[t]))return!0}if(e.anyOf){for(let t=0;t<e.anyOf.length;t++)if(sb(e.anyOf[t]))return!0}if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(sb(e.oneOf[t]))return!0}if(e.allOf){for(let t=0;t<e.allOf.length;t++)if(sb(e.allOf[t]))return!0}if(e.not&&sb(e.not))return!0;if(e.type===`object`&&e.properties){let t=e.properties;for(let e of Object.keys(t)){let n=t[e];if(sb(n)||n.type===`array`&&n.items&&sb(n.items))return!0}}return e.type===`array`&&e.items&&sb(e.items)?!0:e[M]===`Ref`&&`$ref`in e},cb=e=>{if(!e)return!1;if(e.$ref&&e.$defs&&e.$ref in e.$defs&&cb(e.$defs[e.$ref]))return!0;if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(cb(e.oneOf[t]))return!0}if(e.anyOf){for(let t=0;t<e.anyOf.length;t++)if(cb(e.anyOf[t]))return!0}if(e.allOf){for(let t=0;t<e.allOf.length;t++)if(cb(e.allOf[t]))return!0}if(e.not&&cb(e.not))return!0;if(e.type===`object`&&e.properties){let t=e.properties;for(let e of Object.keys(t)){let n=t[e];if(cb(n)||n.type===`array`&&n.items&&cb(n.items))return!0}}return e.type===`array`&&e.items&&cb(e.items)?!0:Me in e},lb=(e,t,n={})=>{let r=n;if(r.root=!0,!Array.isArray(t))return t.original=e,ub(e,t,r);for(let n of t)n.original=e,e=ub(e,n,r);return e},ub=(e,t,n)=>{if(!e)return e;let r=n.root;if(t.onlyFirstObject&&e.type===`object`)return t.to(e)??e;if(t.untilObjectFound&&!r&&e.type===`object`)return e;let i=t.from[M];if(e.oneOf){for(let r=0;r<e.oneOf.length;r++)e.oneOf[r]=ub(e.oneOf[r],t,n);return e}if(e.anyOf){for(let r=0;r<e.anyOf.length;r++)e.anyOf[r]=ub(e.anyOf[r],t,n);return e}if(e.allOf){for(let r=0;r<e.allOf.length;r++)e.allOf[r]=ub(e.allOf[r],t,n);return e}if(e.not)return ub(e.not,t,n);let a=r&&!!t.excludeRoot;if(e[M]===i){let{anyOf:r,oneOf:i,allOf:o,not:s,properties:c,items:l,...u}=e,d=t.to(u);if(!d)return e;let f,p=e=>{let t=m(e);return t.$id&&delete t.$id,t},m=e=>{if(c&&e.type===`object`){let r={};for(let[e,i]of Object.entries(c))r[e]=ub(i,t,{...n,root:!1});return{...u,...e,properties:r}}if(l&&e.type===`array`)return{...u,...e,items:ub(l,t,{...n,root:!1})};let r={...u,...e};return delete r.required,c&&e.type===`string`&&e.format===`ObjectString`&&e.default===`{}`&&(f=Q.ObjectString(c,u),r.default=JSON.stringify(cp(Q.Object(c))),r.properties=c),l&&e.type===`string`&&e.format===`ArrayString`&&e.default===`[]`&&(f=Q.ArrayString(l,u),r.default=JSON.stringify(cp(Q.Array(l))),r.items=l),r};if(a){if(c){let e={};for(let[r,i]of Object.entries(c))e[r]=ub(i,t,{...n,root:!1});return{...u,properties:e}}else if(l?.map)return{...u,items:l.map(e=>ub(e,t,{...n,root:!1}))};return u}if(d.anyOf)for(let e=0;e<d.anyOf.length;e++)d.anyOf[e]=p(d.anyOf[e]);else if(d.oneOf)for(let e=0;e<d.oneOf.length;e++)d.oneOf[e]=p(d.oneOf[e]);else if(d.allOf)for(let e=0;e<d.allOf.length;e++)d.allOf[e]=p(d.allOf[e]);else d.not&&(d.not=p(d.not));if(f&&(d[Me]=f[Me]),d.anyOf||d.oneOf||d.allOf||d.not)return d;if(c){let e={};for(let[r,i]of Object.entries(c))e[r]=ub(i,t,{...n,root:!1});return{...u,...d,properties:e}}else if(l?.map)return{...u,...d,items:l.map(e=>ub(e,t,{...n,root:!1}))};return{...u,...d}}let o=e?.properties;if(o&&r&&t.rootOnly!==!0)for(let[r,a]of Object.entries(o))switch(a[M]){case i:let{anyOf:s,oneOf:c,allOf:l,not:u,type:d,...f}=a,p=t.to(f);if(!p)return e;if(p.anyOf)for(let e=0;e<p.anyOf.length;e++)p.anyOf[e]={...f,...p.anyOf[e]};else if(p.oneOf)for(let e=0;e<p.oneOf.length;e++)p.oneOf[e]={...f,...p.oneOf[e]};else if(p.allOf)for(let e=0;e<p.allOf.length;e++)p.allOf[e]={...f,...p.allOf[e]};else p.not&&(p.not={...f,...p.not});o[r]={...f,...ub(f,t,{...n,root:!1})};break;case`Object`:case`Union`:o[r]=ub(a,t,{...n,root:!1});break;default:if(Array.isArray(a.items))for(let e=0;e<a.items.length;e++)a.items[e]=ub(a.items[e],t,{...n,root:!1});else a.anyOf||a.oneOf||a.allOf||a.not?o[r]=ub(a,t,{...n,root:!1}):a.type===`array`&&(a.items=ub(a.items,t,{...n,root:!1}));break}return e.type===`array`&&e.items&&(Array.isArray(e.items)?e.items=e.items.map(e=>ub(e,t,{...n,root:!1})):e.items=ub(e.items,t,{...n,root:!1})),e},db=e=>t=>{if(typeof t==`object`)try{return bp(e,t)}catch{}return t},fb=(e,{models:t={},dynamic:n=!1,modules:r,normalize:i=!1,additionalProperties:a=!1,coerce:o=!1,additionalCoerce:s=[],validators:c,sanitize:l}={})=>{if(c=c?.filter(e=>e),!e){if(!c?.length)return;e=c[0],c=c.slice(1)}let u,d=e=>o?lb(e,[{from:Q.Number(),to:e=>Q.Numeric(e),untilObjectFound:!0},{from:Q.Boolean(),to:e=>Q.BooleanString(e),untilObjectFound:!0},...Array.isArray(s)?s:[s]]):lb(e,s),f=e=>{let n;if(!e)return;if(typeof e!=`string`)n=e;else{let i=e.endsWith(`[]`),a=i?e.substring(0,e.length-2):e;n=r?.Import(a)??t[a],i&&(n=Q.Array(n))}if(!n)return;let i;if(n[M]!==`Import`&&(i=sb(n))){let e=Rv();u===void 0&&(u=i),n=Q.Module({...r?.$defs,[e]:n}).Import(e)}if(n[M]===`Import`){let e={};for(let[t,r]of Object.entries(n.$defs))e[t]=d(r);let t=n.$ref;n=Q.Module(e).Import(t)}else (o||s)&&(n=d(n));return n},p=f(e);if(c?.length){let e=!1,{schema:t,notObjects:n}=mb([p,...c.map(f)]);n&&(p=Q.Intersect([...t?[t]:[],...n.map(t=>{let n=f(t);return n.type===`object`&&`additionalProperties`in n&&(!e&&n.additionalProperties===!1&&(e=!0),delete n.additionalProperties),n})]),p.type===`object`&&e&&(p.additionalProperties=!1))}else p.type===`object`&&!(`additionalProperties`in p)?p.additionalProperties=a:p=lb(p,{onlyFirstObject:!0,from:Q.Object({}),to({properties:e,...t}){if(e&&!(`additionalProperties`in p))return Q.Object(e,{...t,additionalProperties:!1})}});if(n){let e={schema:p,references:``,checkFunc:()=>{},code:``,Check:e=>Od(p,e),Errors:e=>hf(p,e),Code:()=>``,Clean:db(p),Decode:e=>mm(p,e),Encode:e=>km(p,e),get hasAdditionalProperties(){return`~hasAdditionalProperties`in this?this[`~hasAdditionalProperties`]:this[`~hasAdditionalProperties`]=ib(p)},get hasDefault(){return`~hasDefault`in this?this[`~hasDefault`]:this[`~hasDefault`]=ob(`default`,p)},get isOptional(){return`~isOptional`in this?this[`~isOptional`]:this[`~isOptional`]=rb(p)},get hasTransform(){return`~hasTransform`in this?this[`~hasTransform`]:this[`~hasTransform`]=cb(p)},"~hasRef":u,get hasRef(){return`~hasRef`in this?this[`~hasRef`]:this[`~hasRef`]=cb(p)}};if(p.config&&(e.config=p.config,e?.schema?.config&&delete e.schema.config),i&&p.additionalProperties===!1)if(i===!0||i===`exactMirror`)try{e.Clean=$m(p,{TypeCompiler:Rm,sanitize:l?.(),modules:r})}catch{console.warn(`Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues`),console.warn(p),e.Clean=db(p)}else e.Clean=db(p);return e.parse=t=>{try{return e.Decode(t)}catch{throw[...e.Errors(t)].map(ty)}},e.safeParse=t=>{try{return{success:!0,data:e.Decode(t),error:null}}catch{let e=[...m.Errors(t)].map(ty);return{success:!1,data:null,error:e[0]?.summary,errors:e}}},e}let m=Rm.Compile(p,Object.values(t));if(p.config&&(m.config=p.config,m?.schema?.config&&delete m.schema.config),i===!0||i===`exactMirror`)try{m.Clean=$m(p,{TypeCompiler:Rm,sanitize:l?.(),modules:r})}catch{console.warn(`Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues`),console.warn(p),m.Clean=db(p)}else m.Clean=db(p);return m.parse=e=>{try{return m.Decode(e)}catch{throw[...m.Errors(e)].map(ty)}},m.safeParse=e=>{try{return{success:!0,data:m.Decode(e),error:null}}catch{let t=[...m.Errors(e)].map(ty);return{success:!1,data:null,error:t[0]?.summary,errors:t}}},Object.assign(m,{get hasAdditionalProperties(){return`~hasAdditionalProperties`in this?this[`~hasAdditionalProperties`]:this[`~hasAdditionalProperties`]=ib(m)},get hasDefault(){return`~hasDefault`in this?this[`~hasDefault`]:this[`~hasDefault`]=ob(`default`,m)},get isOptional(){return`~isOptional`in this?this[`~isOptional`]:this[`~isOptional`]=rb(m)},get hasTransform(){return`~hasTransform`in this?this[`~hasTransform`]:this[`~hasTransform`]=cb(p)},get hasRef(){return`~hasRef`in this?this[`~hasRef`]:this[`~hasRef`]=sb(p)},"~hasRef":u}),m},pb=e=>e[M]===`Union`||!e.schema&&!!e.anyOf,mb=e=>{if(e.length===0)return{schema:void 0,notObjects:[]};if(e.length===1)return e[0].type===`object`?{schema:e[0],notObjects:[]}:{schema:void 0,notObjects:e};let t,n=[],r=!1,i=!1;for(let a of e){if(a.type!==`object`){n.push(a);continue}if(`additionalProperties`in a&&(a.additionalProperties===!0?r=!0:a.additionalProperties===!1&&(i=!0)),!t){t=a;continue}t={...t,...a,properties:{...t.properties,...a.properties},required:[...t?.required??[],...a.required]}}return t&&(t.required&&(t.required=[...new Set(t.required)]),i?t.additionalProperties=!1:r&&(t.additionalProperties=!0)),{schema:t,notObjects:n}},hb=(e,{models:t={},modules:n,dynamic:r=!1,normalize:i=!1,additionalProperties:a=!1,validators:o=[],sanitize:s})=>{if(o=o.filter(e=>e),!e){if(!o?.length)return;e=o[0],o=o.slice(1)}let c;if(typeof e!=`string`)c=e;else{let r=e.endsWith(`[]`),i=r?e.substring(0,e.length-2):e;c=n.Import(i)??t[i],r&&(c=Q.Array(c))}if(!c)return;if(M in c)return{200:fb(c,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(e=>e[200]),sanitize:s})};let l={};return Object.keys(c).forEach(e=>{if(isNaN(+e))return;let u=c[+e];if(typeof u==`string`){if(u in t){let c=t[u];l[+e]=M in c?fb(c,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(t=>t[+e]),sanitize:s}):c}return}l[+e]=M in u?fb(u,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(t=>t[+e]),sanitize:s}):u}),l},gb,_b=()=>(gb||(gb=[{from:Q.Object({}),to:()=>Q.ObjectString({}),excludeRoot:!0},{from:Q.Array(Q.Any()),to:()=>Q.ArrayString(Q.Any())}]),gb),vb,yb=()=>(vb||(vb=[{from:Q.Number(),to:e=>Q.Numeric(e),rootOnly:!0},{from:Q.Boolean(),to:e=>Q.BooleanString(e),rootOnly:!0}]),vb),bb=({validator:e,modules:t,defaultConfig:n={},config:r,dynamic:i,models:a,validators:o,sanitize:s})=>{let c=fb(e,{modules:t,dynamic:i,models:a,additionalProperties:!0,coerce:!0,additionalCoerce:_b(),validators:o,sanitize:s});return c?c.config=iv(c.config,r):(c=fb(Q.Cookie(Q.Any()),{modules:t,dynamic:i,models:a,additionalProperties:!0,validators:o,sanitize:s}),c.config=n),c},xb=e=>e[M]===`Import`&&e.$defs[e.$ref][M]===`Object`?e.$defs[e.$ref]:e;var Sb=(e,t)=>t?e:``,Cb=[`json`,`text`,`urlencoded`,`arrayBuffer`,`formdata`,`application/json`,`text/plain`,`application/x-www-form-urlencoded`,`application/octet-stream`,`multipart/form-data`],wb=({context:e=`c`,trace:t=[],addFn:n})=>{if(!t.length)return()=>({resolveChild(){return()=>{}},resolve(){}});for(let r=0;r<t.length;r++)n(`let report${r},reportChild${r},reportErr${r},reportErrChild${r};let trace${r}=${e}[ELYSIA_TRACE]?.[${r}]??trace[${r}](${e});
`);return(e,{name:r,total:i=0}={})=>{r||(r=`anonymous`);let a=e===`error`?`reportErr`:`report`;for(let o=0;o<t.length;o++)n(`${a}${o} = trace${o}.${e}({id,event:'${e}',name:'${r}',begin:performance.now(),total:${i}})
`);return{resolve(){for(let e=0;e<t.length;e++)n(`${a}${e}.resolve()
`)},resolveChild(r){for(let i=0;i<t.length;i++)n(`${a}Child${i}=${a}${i}.resolveChild?.shift()?.({id,event:'${e}',name:'${r}',begin:performance.now()})
`);return e=>{for(let r=0;r<t.length;r++)n(e?`if(${e} instanceof Error){${a}Child${r}?.(${e}) }else{${a}Child${r}?.()}`:`${a}Child${r}?.()
`)}}}}},Tb=({schema:e,name:t,type:n,typeAlias:r=n,normalize:i,ignoreTryCatch:a=!1})=>!i||!e.Clean||e.hasAdditionalProperties?``:i===!0||i===`exactMirror`?a?`${t}=validator.${r}.Clean(${t})
`:`try{${t}=validator.${r}.Clean(${t})
}catch{}`:i===`typebox`?`${t}=validator.${r}.Clean(${t})
`:``,Eb=({injectResponse:e=``,normalize:t=!1,validator:n,encodeSchema:r=!1,isStaticResponse:i=!1,hasSanitize:a=!1})=>({validate:(e,t=`c.${e}`)=>`c.set.status=422;throw new ValidationError('${e}',validator.${e},${t})`,response:(o=`r`)=>{if(i)return``;let s=e+`
`;s+=`if(${o} instanceof ElysiaCustomStatusResponse){c.set.status=${o}.code
${o}=${o}.response}switch(c.set.status){`;for(let[e,i]of Object.entries(n.response)){s+=`
case ${e}:if(${o} instanceof Response)break
`;let n=i.schema?.noValidate===!0,c=n||a,l=({ignoreTryCatch:n=!1}={})=>Tb({name:o,schema:i,type:`response`,typeAlias:`response[${e}]`,normalize:t,ignoreTryCatch:n});c&&(s+=l());let u=!c&&t&&!n;r&&i.hasTransform?s+=`try{${o}=validator.response[${e}].Encode(${o})
c.set.status=${e}}catch{`+(u?`try{
`+l({ignoreTryCatch:!0})+`${o}=validator.response[${e}].Encode(${o})
}catch{throw new ValidationError('response',validator.response[${e}],${o})}`:`throw new ValidationError('response',validator.response[${e}],${o})`)+`}`:(c||(s+=l()),n||(s+=`if(validator.response[${e}].Check(${o})===false)throw new ValidationError('response',validator.response[${e}],${o})
c.set.status=${e}
`)),s+=`break
`}return s+`}`}}),Db=e=>(e?.fn??e).constructor.name===`AsyncFunction`,Ob=/=>\s?response\.clone\(/,kb=/(?:return|=>)\s?\S+\(|a(?:sync|wait)/,Ab=e=>{let t=typeof e==`object`;if(t&&e.isAsync!==void 0)return e.isAsync;let n=t?e.fn:e;if(n.constructor.name===`AsyncFunction`)return!0;let r=n.toString();if(Ob.test(r))return t&&(e.isAsync=!1),!1;let i=kb.test(r);return t&&(e.isAsync=i),i},jb=e=>{let t=typeof e==`object`;if(t&&e.hasReturn!==void 0)return e.hasReturn;let n=t?e.fn.toString():typeof e==`string`?e.toString():e,r=n.indexOf(`)`);if(n.charCodeAt(r+2)===61&&n.charCodeAt(r+5)!==123)return t&&(e.hasReturn=!0),!0;let i=n.includes(`return`);return t&&(e.hasReturn=i),i},Mb=e=>{let t=e?.fn??e;return t.constructor.name===`AsyncGeneratorFunction`||t.constructor.name===`GeneratorFunction`},Nb=({app:e,path:t,method:n,hooks:r,validator:i,handler:a,allowMeta:o=!1,inference:s})=>{let c=e[`~adapter`].composeHandler,l=e[`~adapter`].handler,u=typeof a==`function`;if(!u&&(a=l.mapResponse(a,{headers:e.setHeaders??{}}),r.parse?.length&&r.transform?.length&&r.beforeHandle?.length&&r.afterHandle?.length))return a instanceof Response?Function(`a`,`"use strict";
return function(){return a.clone()}`)(a):Function(`a`,`"use strict";
return function(){return a}`)(a);let d=u?`handler(c)`:`handler`,f=!!r.afterResponse?.length,p=!!r.trace?.length,m=``;if(s=Ny(r,s),s=Ny({handler:a},s),c.declare){let e=c.declare(s);e&&(m+=e)}s.server&&(m+=`Object.defineProperty(c,'server',{get:function(){return getServer()}})
`),i.createBody?.(),i.createQuery?.(),i.createHeaders?.(),i.createParams?.(),i.createCookie?.(),i.createResponse?.();let h=!!i.body||!!i.headers||!!i.params||!!i.query||!!i.cookie||!!i.response,g=s.query||!!i.query,_=r.parse?.length===1&&r.parse[0].fn===`none`,ee=n!==``&&n!==`GET`&&n!==`HEAD`&&(s.body||!!i.body||!!r.parse?.length)&&!_,v=e.setHeaders,y=v&&!!Object.keys(v).length,te=s.headers||!!i.headers||c.preferWebstandardHeaders!==!0&&s.body,b=s.cookie||!!i.cookie,x=i.cookie?.config?iv(i?.cookie?.config,e.config.cookie):e.config.cookie,ne=``,S=()=>{if(ne)return ne;if(x?.sign){if(!x.secrets)throw new Error(`t.Cookie required secret which is not set in (${n}) ${t}.`);let e=x.secrets?typeof x.secrets==`string`?x.secrets:x.secrets[0]:void 0;if(ne+=`const _setCookie = c.set.cookie
if(_setCookie){`,x.sign===!0)ne+=`for(const [key, cookie] of Object.entries(_setCookie)){c.set.cookie[key].value=await signCookie(cookie.value,'${e}')}`;else for(let t of x.sign)ne+=`if(_setCookie['${t}']?.value)c.set.cookie['${t}'].value=await signCookie(_setCookie['${t}'].value,'${e}')
`;ne+=`}
`}return ne},re=e.config.normalize,ie=e.config.encodeSchema,ae=Eb({normalize:re,validator:i,encodeSchema:ie,isStaticResponse:a instanceof Response,hasSanitize:!!e.config.sanitize});te&&(m+=c.headers),p&&(m+=`const id=c[ELYSIA_REQUEST_ID]
`);let oe=wb({trace:r.trace,addFn:e=>{m+=e}});if(m+=`try{`,b){let e=(e,t)=>{let n=x?.[e]??t;return n?typeof n==`string`?`${e}:'${n}',`:n instanceof Date?`${e}: new Date(${n.getTime()}),`:`${e}:${n},`:typeof t==`string`?`${e}:"${t}",`:`${e}:${t},`},t=x?`{secrets:${x.secrets!==void 0?typeof x.secrets==`string`?`'${x.secrets}'`:`[`+x.secrets.reduce((e,t)=>e+`'${t}',`,``)+`]`:`undefined`},sign:${x.sign===!0?!0:x.sign!==void 0?`[`+x.sign.reduce((e,t)=>e+`'${t}',`,``)+`]`:`undefined`},`+e(`domain`)+e(`expires`)+e(`httpOnly`)+e(`maxAge`)+e(`path`,`/`)+e(`priority`)+e(`sameSite`)+e(`secure`)+`}`:`undefined`;te?m+=`
c.cookie=await parseCookie(c.set,c.headers.cookie,${t})
`:m+=`
c.cookie=await parseCookie(c.set,c.request.headers.get('cookie'),${t})
`}if(g){let e=[];if(i.query&&i.query.schema.type===`object`){let t=i.query.schema.properties;if(!i.query.hasAdditionalProperties)for(let[n,r]of Object.entries(t)){let t=r,i=t.type===`array`||!!t.anyOf?.some(e=>e.type===`string`&&e.format===`ArrayString`);t&&Pe in t&&t.type===`array`&&t.items&&(t=t.items);let{type:a,anyOf:o}=t;e.push({key:n,isArray:i,isNestedObjectArray:i&&t.items?.type===`object`||!!t.items?.anyOf?.some(e=>e.type===`object`||e.type===`array`),isObject:a===`object`||o?.some(e=>e.type===`string`&&e.format===`ArrayString`),anyOf:!!o})}}if(!e.length)m+=`if(c.qi===-1){c.query={}}else{c.query=parseQueryFromURL(c.url,c.qi+1)}`;else{m+=`if(c.qi!==-1){let url='&'+c.url.slice(c.qi+1)
`;let t=0;for(let{key:n,isArray:r,isObject:i,isNestedObjectArray:a,anyOf:o}of e){let e=(t===0?`let `:``)+`memory=url.indexOf('&${n}=')
let a${t}
`;r?(m+=e,a?m+=`while(memory!==-1){const start=memory+${n.length+2}
memory=url.indexOf('&',start)
if(a${t}===undefined)
a${t}=''
else
a${t}+=','
let temp
if(memory===-1)temp=decodeURIComponent(url.slice(start).replace(/\\+/g,' '))
else temp=decodeURIComponent(url.slice(start, memory).replace(/\\+/g,' '))
const charCode=temp.charCodeAt(0)
if(charCode!==91&&charCode !== 123)
temp='"'+temp+'"'
a${t}+=temp
if(memory===-1)break
memory=url.indexOf('&${n}=',memory)
if(memory===-1)break}try{if(a${t}.charCodeAt(0)===91)a${t} = JSON.parse(a${t})
else
a${t}=JSON.parse('['+a${t}+']')}catch{}
`:m+=`while(memory!==-1){const start=memory+${n.length+2}
memory=url.indexOf('&',start)
if(a${t}===undefined)a${t}=[]
if(memory===-1){const temp=decodeURIComponent(url.slice(start)).replace(/\\+/g,' ')
if(temp.includes(',')){a${t}=a${t}.concat(temp.split(','))}else{a${t}.push(decodeURIComponent(url.slice(start)).replace(/\\+/g,' '))}
break}else{const temp=decodeURIComponent(url.slice(start, memory)).replace(/\\+/g,' ')
if(temp.includes(',')){a${t}=a${t}.concat(temp.split(','))}else{a${t}.push(temp)}
}memory=url.indexOf('&${n}=',memory)
if(memory===-1) break
}`):i?m+=e+`if(memory!==-1){const start=memory+${n.length+2}
memory=url.indexOf('&',start)
if(memory===-1)a${t}=decodeURIComponent(url.slice(start).replace(/\\+/g,' '))else a${t}=decodeURIComponent(url.slice(start,memory).replace(/\\+/g,' '))if(a${t}!==undefined)try{a${t}=JSON.parse(a${t})}catch{}}`:(m+=e+`if(memory!==-1){const start=memory+${n.length+2}
memory=url.indexOf('&',start)
if(memory===-1)a${t}=decodeURIComponent(url.slice(start).replace(/\\+/g,' '))
else{a${t}=decodeURIComponent(url.slice(start,memory).replace(/\\+/g,' '))`,o&&(m+=`
let deepMemory=url.indexOf('&${n}=',memory)
if(deepMemory!==-1){a${t}=[a${t}]
let first=true
while(true){const start=deepMemory+${n.length+2}
if(first)first=false
else deepMemory = url.indexOf('&', start)
let value
if(deepMemory===-1)value=url.slice(start).replace(/\\+/g,' ')
else value=url.slice(start, deepMemory).replace(/\\+/g,' ')
value=decodeURIComponent(value)
if(value===null){if(deepMemory===-1){break}else{continue}}
const vStart=value.charCodeAt(0)
const vEnd=value.charCodeAt(value.length - 1)
if((vStart===91&&vEnd===93)||(vStart===123&&vEnd===125))
try{a${t}.push(JSON.parse(value))}catch{a${t}.push(value)}if(deepMemory===-1)break}}`),m+=`}}`),t++,m+=`
`}m+=`c.query={`+e.map(({key:e},t)=>`'${e}':a${t}`).join(`,`)+`}`,m+=`} else c.query = {}
`}}let se=typeof a==`function`&&Ab(a),ce=p||r.afterResponse?.length?`c.response= `:``,C=b||ee||se||!!r.parse?.length||!!r.afterHandle?.some(Ab)||!!r.beforeHandle?.some(Ab)||!!r.transform?.some(Ab)||!!r.mapResponse?.some(Ab),le=(typeof a==`function`?Mb(a):!1)||!!r.beforeHandle?.some(Mb)||!!r.afterHandle?.some(Mb)||!!r.transform?.some(Mb),ue=Object.keys(i.response??{}),de=ue.length>1,w=ue.length===0||ue.length===1&&ue[0]===`200`,T=s.cookie||s.set||te||p||de||!w||u&&y||le,fe=(e=`r`)=>`return ${T?`mapResponse`:`mapCompactResponse`}(${ce}${e}${T?`,c.set`:``}${pe})
`,pe=le||c.mapResponseContext?`,${c.mapResponseContext}`:``;(p||s.route)&&(m+=`c.route=\`${t}\`
`);let E=oe(`parse`,{total:r.parse?.length});if(ee){let t=!!r.parse?.length||s.body||i.body;c.parser.declare&&(m+=c.parser.declare),m+=`
try{`;let n=typeof r.parse==`string`?r.parse:Array.isArray(r.parse)&&r.parse.length===1?typeof r.parse[0]==`string`?r.parse[0]:typeof r.parse[0].fn==`string`?r.parse[0].fn:void 0:void 0;if(!n&&i.body&&!r.parse?.length){let e=i.body.schema;e&&e.anyOf&&e[M]===`Union`&&e.anyOf?.length===2&&e.anyOf?.find(e=>e[M]===`ElysiaForm`)&&(n=`formdata`)}if(n&&Cb.includes(n)){let t=oe(`parse`,{total:r.parse?.length}),a=!!i.body?.isOptional;switch(n){case`json`:case`application/json`:m+=c.parser.json(a);break;case`text`:case`text/plain`:m+=c.parser.text(a);break;case`urlencoded`:case`application/x-www-form-urlencoded`:m+=c.parser.urlencoded(a);break;case`arrayBuffer`:case`application/octet-stream`:m+=c.parser.arrayBuffer(a);break;case`formdata`:case`multipart/form-data`:m+=c.parser.formData(a);break;default:n[0]in e[`~parser`]&&(m+=te?`let contentType = c.headers['content-type']`:`let contentType = c.request.headers.get('content-type')`,m+=`
if(contentType){const index=contentType.indexOf(';')
if(index!==-1)contentType=contentType.substring(0,index)}
else{contentType=''}c.contentType=contentType
let result=parser['${n}'](c, contentType)
if(result instanceof Promise)result=await result
if(result instanceof ElysiaCustomStatusResponse)throw result
if(result!==undefined)c.body=result
delete c.contentType
`);break}t.resolve()}else if(t){m+=`
`;let t=r.parse?.length?`let`:`const`;m+=te?`${t} contentType=c.headers['content-type']
`:`${t} contentType=c.request.headers.get('content-type')
`;let n=!1;if(r.parse?.length)m+=`if(contentType){
const index=contentType.indexOf(';')

if(index!==-1)contentType=contentType.substring(0,index)}else{contentType=''}let used=false
c.contentType=contentType
`;else{n=!0;let e=!!i.body?.isOptional;m+=`if(contentType)switch(contentType.charCodeAt(12)){
case 106:`+c.parser.json(e)+`break
case 120:`+c.parser.urlencoded(e)+`break
case 111:`+c.parser.arrayBuffer(e)+`break
case 114:`+c.parser.formData(e)+`break
default:if(contentType.charCodeAt(0)===116){`+c.parser.text(e)+`}break
}`}let a=oe(`parse`,{total:r.parse?.length});if(r.parse)for(let e=0;e<r.parse.length;e++){let t=`bo${e}`;if(e!==0&&(m+=`
if(!used){`),typeof r.parse[e].fn==`string`){let o=a.resolveChild(r.parse[e].fn),s=!!i.body?.isOptional;switch(r.parse[e].fn){case`json`:case`application/json`:n=!0,m+=c.parser.json(s);break;case`text`:case`text/plain`:n=!0,m+=c.parser.text(s);break;case`urlencoded`:case`application/x-www-form-urlencoded`:n=!0,m+=c.parser.urlencoded(s);break;case`arrayBuffer`:case`application/octet-stream`:n=!0,m+=c.parser.arrayBuffer(s);break;case`formdata`:case`multipart/form-data`:n=!0,m+=c.parser.formData(s);break;default:m+=`let ${t}=parser['${r.parse[e].fn}'](c,contentType)
if(${t} instanceof Promise)${t}=await ${t}
if(${t}!==undefined){c.body=${t};used=true;}
`}o()}else{let n=a.resolveChild(r.parse[e].fn.name);m+=`let ${t}=e.parse[${e}]
${t}=${t}(c,contentType)
if(${t} instanceof Promise)${t}=await ${t}
if(${t}!==undefined){c.body=${t};used=true}`,n()}if(e!==0&&(m+=`}`),n)break}if(a.resolve(),!n){let t=!!i.body?.isOptional;r.parse?.length&&(m+=`
if(!used){
if(!contentType) throw new ParseError()
`),m+=`switch(contentType){`,m+=`case 'application/json':
`+c.parser.json(t)+`break
case 'text/plain':`+c.parser.text(t)+`break
case 'application/x-www-form-urlencoded':`+c.parser.urlencoded(t)+`break
case 'application/octet-stream':`+c.parser.arrayBuffer(t)+`break
case 'multipart/form-data':`+c.parser.formData(t)+`break
`;for(let t of Object.keys(e[`~parser`]))m+=`case '${t}':let bo${t}=parser['${t}'](c,contentType)
if(bo${t} instanceof Promise)bo${t}=await bo${t}
if(bo${t} instanceof ElysiaCustomStatusResponse)throw result
if(bo${t}!==undefined)c.body=bo${t}
break
`;r.parse?.length&&(m+=`}`),m+=`}`}r.parse?.length&&(m+=`
delete c.contentType`)}m+=`}catch(error){throw new ParseError(error)}`}if(E.resolve(),r?.transform){let e=oe(`transform`,{total:r.transform.length});r.transform.length&&(m+=`let transformed
`);for(let t=0;t<r.transform.length;t++){let n=r.transform[t],i=e.resolveChild(n.fn.name);m+=Ab(n)?`transformed=await e.transform[${t}](c)
`:`transformed=e.transform[${t}](c)
`,n.subType===`mapDerive`?m+=`if(transformed instanceof ElysiaCustomStatusResponse)throw transformed
else{transformed.request=c.request
transformed.store=c.store
transformed.qi=c.qi
transformed.path=c.path
transformed.url=c.url
transformed.redirect=c.redirect
transformed.set=c.set
transformed.error=c.error
c=transformed}`:m+=`if(transformed instanceof ElysiaCustomStatusResponse)throw transformed
else Object.assign(c,transformed)
`,i()}e.resolve()}let me=[];if(i){if(i.headers){if(i.headers.hasDefault)for(let[e,t]of Object.entries(Om(i.headers.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(m+=`c.headers['${e}']??=${n}
`)}m+=Tb({name:`c.headers`,schema:i.headers,type:`headers`,normalize:re}),i.headers.isOptional&&(m+=`if(isNotEmpty(c.headers)){`),i.body?.schema?.noValidate!==!0&&(m+=`if(validator.headers.Check(c.headers) === false){`+ae.validate(`headers`)+`}`),i.headers.hasTransform&&(m+=`c.headers=validator.headers.Decode(c.headers)
`),i.headers.isOptional&&(m+=`}`)}if(i.params){if(i.params.hasDefault)for(let[e,t]of Object.entries(Om(i.params.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(m+=`c.params['${e}']??=${n}
`)}i.params?.schema?.noValidate!==!0&&(m+=`if(validator.params.Check(c.params)===false){`+ae.validate(`params`)+`}`),i.params.hasTransform&&(m+=`c.params=validator.params.Decode(c.params)
`)}if(i.query){if(i.query.hasDefault)for(let[e,t]of Object.entries(Om(i.query.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(m+=`if(c.query['${e}']===undefined)c.query['${e}']=${n}
`),m+=Tb({name:`c.query`,schema:i.query,type:`query`,normalize:re})}i.query.isOptional&&(m+=`if(isNotEmpty(c.query)){`),i.query?.schema?.noValidate!==!0&&(m+=`if(validator.query.Check(c.query)===false){`+ae.validate(`query`)+`}`),i.query.hasTransform&&(m+=`c.query=validator.query.Decode(Object.assign({},c.query))
`),i.query.isOptional&&(m+=`}`)}if(ee&&i.body){(i.body.hasTransform||i.body.isOptional)&&(m+=`const isNotEmptyObject=c.body&&(typeof c.body==="object"&&isNotEmpty(c.body))
`);let t=pb(i.body.schema),n=!1;if(i.body.hasDefault){let e=Om(i.body.schema,i.body.schema.type===`object`||i.body.schema[M]===`Import`&&i.body.schema.$defs[i.body.schema.$ref][M]===`Object`?{}:void 0),r=xb(i.body.schema);if(!t&&e&&typeof e==`object`&&(ab(`File`,r)||ab(`Files`,r))){n=!0;for(let[t,n]of Object.entries(e))(n===`File`||n===`Files`)&&delete e[t];X(e)||(e=void 0)}let a=typeof e==`object`?JSON.stringify(e):typeof e==`string`?`'${e}'`:e;e!=null&&(Array.isArray(e)?m+=`if(!c.body)c.body=${a}
`:typeof e==`object`?m+=`c.body=Object.assign(${a},c.body)
`:m+=`c.body=${a}
`),m+=Tb({name:`c.body`,schema:i.body,type:`body`,normalize:re}),i.body?.schema?.noValidate!==!0&&(i.body.isOptional?m+=`if(isNotEmptyObject&&validator.body.Check(c.body)===false){`+ae.validate(`body`)+`}`:m+=`if(validator.body.Check(c.body)===false){`+ae.validate(`body`)+`}`)}else m+=Tb({name:`c.body`,schema:i.body,type:`body`,normalize:re}),i.body?.schema?.noValidate!==!0&&(i.body.isOptional?m+=`if(isNotEmptyObject&&validator.body.Check(c.body)===false){`+ae.validate(`body`)+`}`:m+=`if(validator.body.Check(c.body)===false){`+ae.validate(`body`)+`}`);if(i.body.hasTransform&&(m+=`if(isNotEmptyObject)c.body=validator.body.Decode(c.body)
`),t&&i.body.schema.anyOf?.length){let t=Object.values(i.body.schema.anyOf);for(let n=0;n<t.length;n++){let r=t[n];if(ab(`File`,r)||ab(`Files`,r)){let t=fb(r,{modules:e.definitions.typebox,dynamic:!e.config.aot,models:e.definitions.type,normalize:e.config.normalize,additionalCoerce:yb(),sanitize:()=>e.config.sanitize});if(t){let e=me.length===0,n=Object.entries(r.properties),i=e?`
`:` else `;i+=`if(fileUnions[${me.length}].Check(c.body)){`;let a=``,o=0;for(let e=0;e<n.length;e++){let[t,r]=n[e];!r.extension||r[M]!==`File`&&r[M]!==`Files`||(o&&(a+=`,`),a+=`validateFileExtension(c.body.${t},${JSON.stringify(r.extension)},'body.${t}')`,o++)}a&&(o===1?i+=`await ${a}
`:o>1&&(i+=`await Promise.all([${a}])
`),i+=`}`,m+=i,me.push(t))}}}}else if(n||!t&&(ab(`File`,xb(i.body.schema))||ab(`Files`,xb(i.body.schema)))){let e=``,t=0;for(let[n,r]of Object.entries(xb(i.body.schema).properties))!r.extension||r[M]!==`File`&&r[M]!==`Files`||(t&&(e+=`,`),e+=`validateFileExtension(c.body.${n},${JSON.stringify(r.extension)},'body.${n}')`,t++);t&&(m+=`
`),t===1?m+=`await ${e}
`:t>1&&(m+=`await Promise.all([${e}])
`)}}if(i.cookie){let t=bb({modules:e.definitions.typebox,validator:i.cookie,defaultConfig:e.config.cookie,dynamic:!!e.config.aot,config:i.cookie?.config??{},models:e.definitions.type});if(m+=`const cookieValue={}
for(const [key,value] of Object.entries(c.cookie))cookieValue[key]=value.value
`,t.hasDefault)for(let[e,n]of Object.entries(Om(t.schema,{})))m+=`cookieValue['${e}'] = ${typeof n==`object`?JSON.stringify(n):n}
`;t.isOptional&&(m+=`if(isNotEmpty(c.cookie)){`),i.body?.schema?.noValidate!==!0&&(m+=`if(validator.cookie.Check(cookieValue)===false){`+ae.validate(`cookie`,`cookieValue`)+`}`),t.hasTransform&&(m+=`for(const [key,value] of Object.entries(validator.cookie.Decode(cookieValue)))c.cookie[key].value=value
`),t.isOptional&&(m+=`}`)}}if(r?.beforeHandle){let e=oe(`beforeHandle`,{total:r.beforeHandle.length}),t=!1;for(let n=0;n<r.beforeHandle.length;n++){let o=r.beforeHandle[n],s=e.resolveChild(o.fn.name),c=jb(o);if(o.subType===`resolve`||o.subType===`mapResolve`)t||(t=!0,m+=`
let resolved
`),m+=Ab(o)?`resolved=await e.beforeHandle[${n}](c);
`:`resolved=e.beforeHandle[${n}](c);
`,o.subType===`mapResolve`?m+=`if(resolved instanceof ElysiaCustomStatusResponse)throw resolved
else{resolved.request=c.request
resolved.store=c.store
resolved.qi=c.qi
resolved.path=c.path
resolved.url=c.url
resolved.redirect=c.redirect
resolved.set=c.set
resolved.error=c.error
c=resolved}`:m+=`if(resolved instanceof ElysiaCustomStatusResponse)throw resolved
else Object.assign(c, resolved)
`;else if(!c)m+=Ab(o)?`await e.beforeHandle[${n}](c)
`:`e.beforeHandle[${n}](c)
`,s();else{if(m+=Ab(o)?`be=await e.beforeHandle[${n}](c)
`:`be=e.beforeHandle[${n}](c)
`,s(`be`),m+=`if(be!==undefined){`,e.resolve(),r.afterHandle?.length){oe(`handle`,{name:u?a.name:void 0}).resolve();let e=oe(`afterHandle`,{total:r.afterHandle.length});for(let t=0;t<r.afterHandle.length;t++){let n=r.afterHandle[t],i=jb(n),a=e.resolveChild(n.fn.name);m+=`c.response = be
`,i?(m+=Ab(n.fn)?`af=await e.afterHandle[${t}](c)
`:`af=e.afterHandle[${t}](c)
`,m+=`if(af!==undefined) c.response=be=af
`):m+=Ab(n.fn)?`await e.afterHandle[${t}](c, be)
`:`e.afterHandle[${t}](c, be)
`,a(`af`)}e.resolve()}i.response&&(m+=ae.response(`be`));let t=oe(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){m+=`c.response=be
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);m+=`if(mr===undefined){mr=${Db(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)be=c.response=mr}`,i()}}t.resolve(),m+=S(),m+=`return mapEarlyResponse(${ce}be,c.set${pe})}
`}}e.resolve()}if(r.afterHandle?.length){let e=oe(`handle`,{name:u?a.name:void 0});r.afterHandle.length?m+=se?`let r=c.response=await ${d}
`:`let r=c.response=${d}
`:m+=se?`let r=await ${d}
`:`let r=${d}
`,e.resolve();let t=oe(`afterHandle`,{total:r.afterHandle.length});for(let e=0;e<r.afterHandle.length;e++){let n=r.afterHandle[e],a=jb(n),o=t.resolveChild(n.fn.name);a?(m+=Ab(n.fn)?`af=await e.afterHandle[${e}](c)
`:`af=e.afterHandle[${e}](c)
`,o(`af`),i.response?(m+=`if(af!==undefined){`,t.resolve(),m+=ae.response(`af`),m+=`c.response=af}`):(m+=`if(af!==undefined){`,t.resolve(),m+=`c.response=af}`)):(m+=Ab(n.fn)?`await e.afterHandle[${e}](c)
`:`e.afterHandle[${e}](c)
`,o())}t.resolve(),m+=`r=c.response
`,i.response&&(m+=ae.response()),m+=S();let n=oe(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length)for(let e=0;e<r.mapResponse.length;e++){let t=r.mapResponse[e],i=n.resolveChild(t.fn.name);m+=`mr=${Db(t)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=mr
`,i()}n.resolve(),m+=fe()}else{let e=oe(`handle`,{name:u?a.name:void 0});if(i.response||r.mapResponse?.length){m+=se?`let r=await ${d}
`:`let r=${d}
`,e.resolve(),i.response&&(m+=ae.response()),oe(`afterHandle`).resolve();let t=oe(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){m+=`
c.response=r
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);m+=`
if(mr===undefined){mr=${Db(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=mr}
`,i()}}t.resolve(),m+=S(),a instanceof Response?(m+=s.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${ce}${d}.clone(),c.set${pe})else return ${d}.clone()`:`return ${d}.clone()`,m+=`
`):m+=fe()}else if(b||p){m+=se?`let r=await ${d}
`:`let r=${d}
`,e.resolve(),oe(`afterHandle`).resolve();let t=oe(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){m+=`c.response= r
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);m+=`if(mr===undefined){mr=${Db(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=mr}`,i()}}t.resolve(),m+=S()+fe()}else{e.resolve();let t=se?`await ${d}`:d;oe(`afterHandle`).resolve(),a instanceof Response?m+=s.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${ce}${d}.clone(),c.set${pe})
else return ${d}.clone()
`:`return ${d}.clone()
`:m+=fe(t)}}if(m+=`
}catch(error){`,!C&&r.error?.length&&(m+=`return(async()=>{`),m+=`const set=c.set
if(!set.status||set.status<300)set.status=error?.status||500
`,b&&(m+=S()),p&&r.trace)for(let e=0;e<r.trace.length;e++)m+=`report${e}?.resolve(error);reportChild${e}?.(error)
`;let D=oe(`error`,{total:r.error?.length});if(r.error?.length){m+=`c.error=error
`,h?m+=`if(error instanceof TypeBoxError){c.code="VALIDATION"
c.set.status=422}else{c.code=error.code??error[ERROR_CODE]??"UNKNOWN"}`:m+=`c.code=error.code??error[ERROR_CODE]??"UNKNOWN"
`,m+=`let er
`;for(let e=0;e<r.error.length;e++){let t=D.resolveChild(r.error[e].fn.name);Ab(r.error[e])?m+=`er=await e.error[${e}](c)
`:m+=`er=e.error[${e}](c)
if(er instanceof Promise)er=await er
`,t();let n=oe(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length)for(let e=0;e<r.mapResponse.length;e++){let t=r.mapResponse[e],i=n.resolveChild(t.fn.name);m+=`c.response=er
er=e.mapResponse[${e}](c)
if(er instanceof Promise)er=await er
`,i()}if(n.resolve(),m+=`er=mapEarlyResponse(er,set${pe})
`,m+=`if(er){`,p&&r.trace){for(let e=0;e<r.trace.length;e++)m+=`report${e}.resolve()
`;D.resolve()}m+=`return er}`}}if(D.resolve(),m+=`return handleError(c,error,true)`,!C&&r.error?.length&&(m+=`})()`),m+=`}`,f||p){m+=`finally{ `,C||(m+=`;(async()=>{`);let e=oe(`afterResponse`,{total:r.afterResponse?.length});if(f&&r.afterResponse)for(let t=0;t<r.afterResponse.length;t++){let n=e.resolveChild(r.afterResponse[t].fn.name);m+=`
await e.afterResponse[${t}](c)
`,n()}e.resolve(),C||(m+=`})()`),m+=`}`}let O=c.inject?Object.keys(c.inject).join(`,`)+`,`:``,k=`const {handler,handleError,hooks:e, `+Sb(`validator,`,h)+`mapResponse,mapCompactResponse,mapEarlyResponse,isNotEmpty,utils:{`+Sb(`parseQuery,`,ee)+Sb(`parseQueryFromURL,`,g)+`},error:{`+Sb(`ValidationError,`,h)+Sb(`ParseError`,ee)+`},validateFileExtension,schema,definitions,ERROR_CODE,`+Sb(`parseCookie,`,b)+Sb(`signCookie,`,b)+Sb(`decodeURIComponent,`,g)+`ElysiaCustomStatusResponse,`+Sb(`ELYSIA_TRACE,`,p)+Sb(`ELYSIA_REQUEST_ID,`,p)+Sb(`parser,`,r.parse?.length)+Sb(`getServer,`,s.server)+Sb(`fileUnions,`,me.length)+O+Sb(`TypeBoxError`,h)+`}=hooks
const trace=e.trace
return ${C?`async `:``}function handle(c){`;r.beforeHandle?.length&&(k+=`let be
`),r.afterHandle?.length&&(k+=`let af
`),r.mapResponse?.length&&(k+=`let mr
`),o&&(k+=`c.schema=schema
c.defs=definitions
`),m=k+m+`}`,k=``;try{return Function(`hooks`,`"use strict";
`+m)({handler:a,hooks:Mv(r),validator:h?i:void 0,handleError:e.handleError,mapResponse:l.mapResponse,mapCompactResponse:l.mapCompactResponse,mapEarlyResponse:l.mapEarlyResponse,isNotEmpty:X,utils:{parseQuery:ee?$y:void 0,parseQueryFromURL:g?Qy:void 0},error:{ValidationError:h?Z:void 0,ParseError:ee?$v:void 0},validateFileExtension:py,schema:e.router.history,definitions:e.definitions.type,ERROR_CODE:Kv,parseCookie:b?Iy:void 0,signCookie:b?Cv:void 0,decodeURIComponent:g?f_.default:void 0,ElysiaCustomStatusResponse:Jv,ELYSIA_TRACE:p?eb:void 0,ELYSIA_REQUEST_ID:p?Iv:void 0,getServer:s.server?()=>e.getServer():void 0,fileUnions:me.length?me:void 0,TypeBoxError:h?je:void 0,parser:e[`~parser`],...c.inject})}catch(t){let n=Mv(r);console.log(`[Composer] failed to generate optimized handler`),console.log(`---`),console.log({handler:typeof a==`function`?a.toString():a,instruction:m,hooks:{...n,transform:n?.transform?.map?.(e=>e.toString()),resolve:n?.resolve?.map?.(e=>e.toString()),beforeHandle:n?.beforeHandle?.map?.(e=>e.toString()),afterHandle:n?.afterHandle?.map?.(e=>e.toString()),mapResponse:n?.mapResponse?.map?.(e=>e.toString()),parse:n?.parse?.map?.(e=>e.toString()),error:n?.error?.map?.(e=>e.toString()),afterResponse:n?.afterResponse?.map?.(e=>e.toString()),stop:n?.stop?.map?.(e=>e.toString())},validator:i,definitions:e.definitions.type,error:t}),console.log(`---`),process.exit(1)}},Pb=(e,t)=>{let n=``,r=wb({trace:e.event.trace,addFn:t??(e=>{n+=e})})(`request`,{total:e.event.request?.length});if(e.event.request?.length){n+=`try{`;for(let t=0;t<e.event.request.length;t++){let i=e.event.request[t],a=jb(i),o=Ab(i),s=r.resolveChild(e.event.request[t].fn.name);a?(n+=`re=mapEarlyResponse(${o?`await `:``}onRequest[${t}](c),c.set)
`,s(`re`),n+=`if(re!==undefined)return re
`):(n+=`${o?`await `:``}onRequest[${t}](c)
`,s())}n+=`}catch(error){return app.handleError(c,error,false)}`}return r.resolve(),n},Fb=(e,t=`map`)=>{let n=e.extender.higherOrderFunctions;if(!n.length)return`return `+t;let r=e[`~adapter`].composeGeneralHandler,i=t;for(let e=0;e<n.length;e++)i=`hoc[${e}](${i},${r.parameters})`;return`return function hocMap(${r.parameters}){return ${i}(${r.parameters})}`},Ib=e=>{let t=e[`~adapter`].composeGeneralHandler;e.router.http.build();let n=t.error404(!!e.event.request?.length,!!e.event.error?.length),r=e.event.trace?.length,i=``,a=e.router,o=a.http.root.WS?`const route=router.find(r.method === "GET" && r.headers.get('upgrade')==='websocket'?'WS':r.method,p)`:`const route=router.find(r.method,p)`;o+=a.http.root.ALL?`??router.find("ALL",p)
`:`
`,o+=n.code,o+=`
c.params=route.params
if(route.store.handler)return route.store.handler(c)
return route.store.compile()(c)
`;let s=``;for(let[t,n]of Object.entries(a.static)){s+=`case'${t}':`,e.config.strictPath!==!0&&(s+=`case'${Vv(t)}':`);let r=Hv(t);t!==r&&(s+=`case'${r}':`),s+=`switch(r.method){`,(`GET`in n||`WS`in n)&&(s+=`case 'GET':`,`WS`in n&&(s+=`if(r.headers.get('upgrade')==='websocket')return ht[${n.WS}].composed(c)
`),`GET`in n&&(s+=`return ht[${n.GET}].composed(c)
`));for(let[e,t]of Object.entries(n))e===`ALL`||e===`GET`||e===`WS`||(s+=`case '${e}':return ht[${t}].composed(c)
`);`ALL`in n?s+=`default:return ht[${n.ALL}].composed(c)
`:s+=`default:break map
`,s+=`}`}let c=!!e.event.request?.some(Ab),l=t.inject?Object.keys(t.inject).join(`,`)+`,`:``;i+=`
const {app,mapEarlyResponse,NotFoundError,randomId,handleError,status,redirect,`+Sb(`ELYSIA_TRACE,`,r)+Sb(`ELYSIA_REQUEST_ID,`,r)+l+`}=data
const store=app.singleton.store
const decorator=app.singleton.decorator
const staticRouter=app.router.static.http
const ht=app.router.history
const router=app.router.http
const trace=app.event.trace?.map(x=>typeof x==='function'?x:x.fn)??[]
const notFound=new NotFoundError()
const hoc=app.extender.higherOrderFunctions.map(x=>x.fn)
`,e.event.request?.length&&(i+=`const onRequest=app.event.request.map(x=>x.fn)
`),i+=n.declare,e.event.trace?.length&&(i+=`const `+e.event.trace.map((e,t)=>`tr${t}=app.event.trace[${t}].fn`).join(`,`)+`
`),i+=`${c?`async `:``}function map(${t.parameters}){`,e.event.request?.length&&(i+=`let re
`),i+=t.createContext(e),e.event.trace?.length&&(i+=`c[ELYSIA_TRACE]=[`+e.event.trace.map((e,t)=>`tr${t}(c)`).join(`,`)+`]
`),i+=Pb(e),s&&(i+=`
map: switch(p){
`+s+`}`),i+=o+`}
`+Fb(e);let u=Lb(e);e.handleError=u;let d=Function(`data`,`"use strict";
`+i)({app:e,mapEarlyResponse:e[`~adapter`].handler.mapEarlyResponse,NotFoundError:Qv,randomId:Rv,handleError:u,status:Yv,redirect:Pv,ELYSIA_TRACE:r?eb:void 0,ELYSIA_REQUEST_ID:r?Iv:void 0,...t.inject});return K_&&Bun.gc(!1),d},Lb=e=>{let t=e.event,n=``,r=e[`~adapter`].composeError,i=r.inject?Object.keys(r.inject).join(`,`)+`,`:``,a=!!e.event.trace?.length;n+=`const {mapResponse,ERROR_CODE,ElysiaCustomStatusResponse,`+Sb(`onError,`,e.event.error)+Sb(`afterResponse,`,e.event.afterResponse)+Sb(`trace,`,e.event.trace)+Sb(`onMapResponse,`,e.event.mapResponse)+Sb(`ELYSIA_TRACE,`,a)+Sb(`ELYSIA_REQUEST_ID,`,a)+i+`}=inject
`,n+=`return ${e.event.error?.find(Ab)||e.event.mapResponse?.find(Ab)?`async `:``}function(context,error,skipGlobal){`,n+=``,a&&(n+=`const id=context[ELYSIA_REQUEST_ID]
`);let o=wb({context:`context`,trace:t.trace,addFn:e=>{n+=e}});n+=`const set=context.set
let _r
if(!context.code)context.code=error.code??error[ERROR_CODE]
if(!(context.error instanceof Error))context.error=error
if(error instanceof ElysiaCustomStatusResponse){set.status=error.status=error.code
error.message=error.response}`,r.declare&&(n+=r.declare);let s=a||t.afterResponse?.length||t.afterResponse?.length?`context.response = `:``;if(e.event.error)for(let i=0;i<e.event.error.length;i++){let a=e.event.error[i],c=`${Ab(a)?`await `:``}onError[${i}](context)
`;if(n+=`if(skipGlobal!==true){`,jb(a)){n+=`_r=${c}
if(_r!==undefined){if(_r instanceof Response)return mapResponse(_r,set${r.mapResponseContext})
if(_r instanceof ElysiaCustomStatusResponse){error.status=error.code
error.message = error.response}if(set.status===200||!set.status)set.status=error.status
`;let e=o(`mapResponse`,{total:t.mapResponse?.length,name:`context`});if(t.mapResponse?.length)for(let r=0;r<t.mapResponse.length;r++){let i=t.mapResponse[r],a=e.resolveChild(i.fn.name);n+=`context.response=_r_r=${Db(i)?`await `:``}onMapResponse[${r}](context)
`,a()}e.resolve(),n+=`return mapResponse(${s}_r,set${r.mapResponseContext})}`}else n+=c;n+=`}`}n+=`if(error.constructor.name==="ValidationError"||error.constructor.name==="TransformDecodeError"){
if(error.error)error=error.error
set.status=error.status??422
`+r.validationError+`
}
`,n+=`if(error instanceof Error){
if(typeof error.toResponse==='function')return context.response=error.toResponse()
`+r.unknownError+`
}`;let c=o(`mapResponse`,{total:t.mapResponse?.length,name:`context`});if(n+=`
if(!context.response)context.response=error.message??error
`,t.mapResponse?.length){n+=`let mr
`;for(let e=0;e<t.mapResponse.length;e++){let r=t.mapResponse[e],i=c.resolveChild(r.fn.name);n+=`if(mr===undefined){mr=${Db(r)?`await `:``}onMapResponse[${e}](context)
if(mr!==undefined)error=context.response=mr}`,i()}}c.resolve(),n+=`
return mapResponse(${s}error,set${r.mapResponseContext})}`;let l=e=>typeof e==`function`?e:e.fn;return Function(`inject`,`"use strict";
`+n)({mapResponse:e[`~adapter`].handler.mapResponse,ERROR_CODE:Kv,ElysiaCustomStatusResponse:Jv,onError:e.event.error?.map(l),afterResponse:e.event.afterResponse?.map(l),trace:e.event.trace?.map(l),onMapResponse:e.event.mapResponse?.map(l),ELYSIA_TRACE:a?eb:void 0,ELYSIA_REQUEST_ID:a?Iv:void 0,...r.inject})};var Rb=(e,t,n)=>{if(X(t.headers)||t.status!==200||t.cookie)switch(Hy(t),e?.constructor?.name){case`String`:return new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return $(e.value);case`File`:return $(e,t);case`Blob`:return $(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Rb(e.response,t,n);case`ReadableStream`:return t.headers[`content-type`]?.startsWith(`text/event-stream`)||(t.headers[`content-type`]=`text/event-stream; charset=utf-8`),n?.signal?.addEventListener(`abort`,{handleEvent(){n?.signal&&!n?.signal?.aborted&&e.cancel()}},{once:!0}),new Response(e,t);case void 0:return e?new Response(JSON.stringify(e),t):new Response(``,t);case`Response`:return Ub(e,t,n);case`Error`:return Vb(e,t);case`Promise`:return e.then(e=>Rb(e,t,n));case`Function`:return Rb(e(),t,n);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`Cookie`:return e instanceof Py?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e,t);default:if(e instanceof Response)return Ub(e,t,n);if(e instanceof Promise)return e.then(e=>Rb(e,t));if(e instanceof Error)return Vb(e,t);if(e instanceof Jv)return t.status=e.code,Rb(e.response,t,n);if(typeof e?.next==`function`)return Wb(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Rb(e,t));if(typeof e?.toResponse==`function`)return Rb(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}return e instanceof Response&&!e.headers.has(`content-length`)&&e.headers.get(`transfer-encoding`)===`chunked`?Wb(Vy(e),zy(e,t),n):typeof e?.next==`function`||e instanceof ReadableStream?Wb(e,t,n):Bb(e,n)},zb=(e,t,n)=>{if(e!=null)if(X(t.headers)||t.status!==200||t.cookie)switch(Hy(t),e?.constructor?.name){case`String`:return new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return $(e.value);case`File`:return $(e,t);case`Blob`:return $(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,zb(e.response,t,n);case`ReadableStream`:return t.headers[`content-type`]?.startsWith(`text/event-stream`)||(t.headers[`content-type`]=`text/event-stream; charset=utf-8`),n?.signal?.addEventListener(`abort`,{handleEvent(){n?.signal&&!n?.signal?.aborted&&e.cancel()}},{once:!0}),new Response(e,t);case void 0:return e?new Response(JSON.stringify(e),t):void 0;case`Response`:return Ub(e,t,n);case`Promise`:return e.then(e=>zb(e,t));case`Error`:return Vb(e,t);case`Function`:return zb(e(),t);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`FormData`:return new Response(e);case`Cookie`:return e instanceof Py?new Response(e.value,t):new Response(e?.toString(),t);default:if(e instanceof Response)return Ub(e,t,n);if(e instanceof Promise)return e.then(e=>zb(e,t));if(e instanceof Error)return Vb(e,t);if(e instanceof Jv)return t.status=e.code,zb(e.response,t,n);if(typeof e?.next==`function`)return Wb(e,t,n);if(typeof e?.then==`function`)return e.then(e=>zb(e,t));if(typeof e?.toResponse==`function`)return zb(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}else switch(e?.constructor?.name){case`String`:return new Response(e);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return $(e.value);case`File`:return $(e,t);case`Blob`:return $(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,zb(e.response,t,n);case`ReadableStream`:return n?.signal?.addEventListener(`abort`,{handleEvent(){n?.signal&&!n?.signal?.aborted&&e.cancel()}},{once:!0}),new Response(e,{headers:{"Content-Type":`text/event-stream; charset=utf-8`}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return!e.headers.has(`content-length`)&&e.headers.get(`transfer-encoding`)===`chunked`?Wb(Vy(e),zy(e),n):e;case`Promise`:return e.then(e=>{let n=zb(e,t);if(n!==void 0)return n});case`Error`:return Vb(e,t);case`Function`:return Bb(e(),n);case`Number`:case`Boolean`:return new Response(e.toString());case`Cookie`:return e instanceof Py?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>zb(e,t));if(e instanceof Error)return Vb(e,t);if(e instanceof Jv)return t.status=e.code,zb(e.response,t,n);if(typeof e?.next==`function`)return Wb(e,t,n);if(typeof e?.then==`function`)return e.then(e=>zb(e,t));if(typeof e?.toResponse==`function`)return zb(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e)}},Bb=(e,t)=>{switch(e?.constructor?.name){case`String`:return new Response(e);case`Object`:case`Array`:return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}});case`ElysiaFile`:return $(e.value);case`File`:return $(e);case`Blob`:return $(e);case`ElysiaCustomStatusResponse`:return Rb(e.response,{status:e.code,headers:{}});case`ReadableStream`:return t?.signal?.addEventListener(`abort`,{handleEvent(){t?.signal&&!t?.signal?.aborted&&e.cancel()}},{once:!0}),new Response(e,{headers:{"Content-Type":`text/event-stream; charset=utf-8`}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e.headers.get(`transfer-encoding`)===`chunked`?Wb(Vy(e),zy(e),t):e;case`Error`:return Vb(e);case`Promise`:return e.then(e=>Bb(e,t));case`Function`:return Bb(e(),t);case`Number`:case`Boolean`:return new Response(e.toString());case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>Bb(e,t));if(e instanceof Error)return Vb(e);if(e instanceof Jv)return Rb(e.response,{status:e.code,headers:{}});if(typeof e?.next==`function`)return Wb(e,void 0,t);if(typeof e?.then==`function`)return e.then(e=>Rb(e,set));if(typeof e?.toResponse==`function`)return Bb(e.toResponse());if(`charCodeAt`in e){let t=e.charCodeAt(0);if(t===123||t===91)return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}})}return new Response(e)}},Vb=(e,t)=>new Response(JSON.stringify({name:e?.name,message:e?.message,cause:e?.cause}),{status:t?.status!==200?t?.status??500:500,headers:t?.headers}),Hb=(e,t,n={})=>{if(typeof e==`function`)return;let r=Rb(e,{headers:n});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return r.clone.bind(r)},Ub=Uy({mapResponse:Rb,mapCompactResponse:Bb}),Wb=By({mapResponse:Rb,mapCompactResponse:Bb});var Gb=(e,t)=>t?e:``,Kb=(e,t,n,r=!1)=>{let i=``,a=e.setHeaders,o=!!e.event.trace?.length;o&&(i+=`const id=randomId()
`);let s=/[:*]/.test(t.path),c=`const u=request.url,s=u.indexOf('/',${e.config.handler?.standardHostname??!0?11:7}),qi=u.indexOf('?', s + 1)
`,l=n.query||!!t.hooks.query||!!t.standaloneValidators?.find(e=>e.query);l&&(i+=c);let u=n.path?s?`get path(){`+(l?``:c)+`if(qi===-1)return u.substring(s)
return u.substring(s,qi)
},`:`path:'${t.path}',`:``;i+=Gb(`const c=`,!r)+`{request,store,`+Gb(`qi,`,l)+Gb(`params:request.params,`,s)+u+Gb(`url:request.url,`,o||n.url||l)+`redirect,error:status,status,set:{headers:`+(X(a)?`Object.assign({},app.setHeaders)`:`Object.create(null)`)+`,status:200}`,n.server&&(i+=`,get server(){return app.getServer()}`),o&&(i+=`,[ELYSIA_REQUEST_ID]:id`);{let t=``;for(let n of Object.keys(e.singleton.decorator))t+=`,'${n}':decorator['${n}']`;i+=t}return i+=`}
`,i},qb=(e,t)=>{let n=!!e.event.trace?.length,r=!!e.extender.higherOrderFunctions.length,i=Ny(t.hooks,e.inference);i=Ny({handler:t.handler},i);let a=`const handler=data.handler,app=data.app,store=data.store,decorator=data.decorator,redirect=data.redirect,route=data.route,mapEarlyResponse=data.mapEarlyResponse,`+Gb(`randomId=data.randomId,`,n)+Gb(`ELYSIA_REQUEST_ID=data.ELYSIA_REQUEST_ID,`,n)+Gb(`ELYSIA_TRACE=data.ELYSIA_TRACE,`,n)+Gb(`trace=data.trace,`,n)+Gb(`hoc=data.hoc,`,r)+`status=data.status
`;e.event.request?.length&&(a+=`const onRequest=app.event.request.map(x=>x.fn)
`),a+=`${e.event.request?.find(Ab)?`async`:``} function map(request){`;let o=i.query||!!t.hooks.query||!!t.standaloneValidators?.find(e=>e.query);return n||o?(a+=Kb(e,t,i),a+=Pb(e),a+=`return handler(c)}`):a+=`return handler(${Kb(e,t,i,!0)})}`,a+=Fb(e),Function(`data`,a)({app:e,handler:t.compile?.()??t.composed,redirect:Pv,status:Yv,hoc:e.extender.higherOrderFunctions.map(e=>e.fn),store:e.store,decorator:e.decorator,route:t.path,randomId:n?Rv:void 0,ELYSIA_TRACE:n?eb:void 0,ELYSIA_REQUEST_ID:n?Iv:void 0,trace:n?e.event.trace?.map(e=>e?.fn??e):void 0,mapEarlyResponse:zb})};var Jb=(e,t,n={})=>{if(typeof e==`function`||e instanceof Blob)return;if(typeof e==`object`&&e?.toString()===`[object HTMLBundle]`)return()=>e;let r=Rb(e,{headers:n});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return r instanceof Promise?r.then(e=>{if(e)return e.headers.has(`content-type`)||e.headers.append(`content-type`,`text/plain`),e.clone()}):(r.headers.has(`content-type`)||r.headers.append(`content-type`,`text/plain`),()=>r.clone())};var Yb={open(e){e.data.open?.(e)},message(e,t){e.data.message?.(e,t)},drain(e){e.data.drain?.(e)},close(e,t,n){e.data.close?.(e,t,n)}},Xb=class{constructor(e,t,n=void 0){this.raw=e;this.data=t;this.body=n;this.validator=e.data?.validator,this.sendText=e.sendText.bind(e),this.sendBinary=e.sendBinary.bind(e),this.close=e.close.bind(e),this.terminate=e.terminate.bind(e),this.publishText=e.publishText.bind(e),this.publishBinary=e.publishBinary.bind(e),this.subscribe=e.subscribe.bind(e),this.unsubscribe=e.unsubscribe.bind(e),this.isSubscribed=e.isSubscribed.bind(e),this.cork=e.cork.bind(e),this.remoteAddress=e.remoteAddress,this.binaryType=e.binaryType,this.data=e.data,this.send=this.send.bind(this),this.ping=this.ping.bind(this),this.pong=this.pong.bind(this),this.publish=this.publish.bind(this)}get id(){return this.data.id}send(e,t){return Buffer.isBuffer(e)?this.raw.send(e,t):this.validator?.Check(e)===!1?this.raw.send(new Z(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.send(e,t))}ping(e){return Buffer.isBuffer(e)?this.raw.ping(e):this.validator?.Check(e)===!1?this.raw.send(new Z(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.ping(e))}pong(e){return Buffer.isBuffer(e)?this.raw.pong(e):this.validator?.Check(e)===!1?this.raw.send(new Z(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.pong(e))}publish(e,t,n){return Buffer.isBuffer(t)?this.raw.publish(e,t,n):this.validator?.Check(t)===!1?this.raw.send(new Z(`message`,this.validator,t).message):(typeof t==`object`&&(t=JSON.stringify(t)),this.raw.publish(e,t,n))}get readyState(){return this.raw.readyState}},Zb=e=>{let t=typeof e==`function`?[e]:e;return async function(e,n){if(typeof n==`string`){let e=n?.charCodeAt(0);if(e===34||e===47||e===91||e===123)try{n=JSON.parse(n)}catch{}else Ov(n)?n=+n:n===`true`?n=!0:n===`false`?n=!1:n===`null`&&(n=null)}if(t)for(let r=0;r<t.length;r++){let i=t[r](e,n);if(i instanceof Promise&&(i=await i),i!==void 0)return i}return n}},Qb=e=>{let t=(n,r)=>{if(r instanceof Promise)return r.then(e=>t(n,e));if(Buffer.isBuffer(r))return n.send(r.toString());if(r===void 0)return;let i=t=>{if(e?.Check(t)===!1)return n.send(new Z(`message`,e,t).message);if(typeof t==`object`)return n.send(JSON.stringify(t));n.send(t)};if(typeof r?.next!=`function`)return void i(r);let a=r.next();if(a instanceof Promise)return(async()=>{let t=await a;if(e?.Check(t)===!1)return n.send(new Z(`message`,e,t).message);if(i(t.value),!t.done)for await(let e of r)i(e)})();if(i(a.value),!a.done)for(let e of r)i(e)};return t};var $b=/:.+?\?(?=\/|$)/,ex=e=>{let t=$b.exec(e);if(!t)return[e];let n=[],r=e.slice(0,t.index),i=t[0].slice(0,-1),a=e.slice(t.index+t[0].length);n.push(r.slice(0,-1)),n.push(r+i);for(let e of ex(a))e&&(e.startsWith(`/:`)||n.push(r.slice(0,-1)+e),n.push(r+i+e));return n},tx={GET:!0,HEAD:!0,OPTIONS:!0,DELETE:!0,PATCH:!0,POST:!0,PUT:!0},nx=e=>{if(!e.config.aot||!e.config.systemRouter)return;let t={},n=(e,n)=>{t[e.path]?t[e.path][e.method]||(t[e.path][e.method]=n):t[e.path]={[e.method]:n}},r=e.routeTree;for(let i of e.router.history){if(typeof i.handler!=`function`)continue;let a=i.method;if(a===`GET`&&`WS_${i.path}`in r||a===`WS`||i.path.charCodeAt(i.path.length-1)===42||!(a in tx))continue;if(a===`ALL`){`WS_${i.path}`in r||(t[i.path]=i.hooks?.config?.mount?i.hooks.trace||e.event.trace||e.extender.higherOrderFunctions?qb(e,i):i.hooks.mount||i.handler:i.handler);continue}let o,s=e.config.precompile?qb(e,i):t=>o?o(t):(o=qb(e,i))(t);for(let e of ex(i.path))n({method:a,path:e},s)}return t},rx=(e,t)=>{if(!t)return e;for(let n of Object.keys(t))if(e[n]!==t[n]){if(!e[n]){e[n]=t[n];continue}if(e[n]&&t[n]){if(typeof e[n]==`function`||e[n]instanceof Response){e[n]=t[n];continue}e[n]={...e[n],...t[n]}}}return e},ix={...Zy,name:`bun`,handler:{mapResponse:Rb,mapEarlyResponse:zb,mapCompactResponse:Bb,createStaticHandler:Hb,createNativeStaticHandler:Jb},composeHandler:{...Zy.composeHandler,headers:$_?`c.headers=c.request.headers.toJSON()
`:`c.headers={}
for(const [k,v] of c.request.headers.entries())c.headers[k]=v
`},listen(e){return(t,n)=>{if(typeof Bun>`u`)throw new Error(`.listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch`);if(e.compile(),typeof t==`string`){if(!Ov(t))throw new Error(`Port must be a numeric value`);t=parseInt(t)}let r=(e,{withAsync:t=!1}={})=>{let n={},r=[];for(let[i,a]of Object.entries(e))if(Uv){if(!a)continue;for(let[e,o]of Object.entries(a))if(!(!o||!(e in tx))){if(o instanceof Promise){t&&(n[i]||(n[i]={}),r.push(o.then(t=>{t instanceof Response&&(n[i][e]=t),typeof t==`object`&&t?.toString()===`[object HTMLBundle]`&&(n[i][e]=t)})));continue}!(o instanceof Response)&&!(typeof o==`object`&&o?.toString()===`[object HTMLBundle]`)||(n[i]||(n[i]={}),n[i][e]=o)}}else{if(!a)continue;if(a instanceof Promise){t&&(n[i]||(n[i]={}),r.push(a.then(e=>{e instanceof Response&&(n[i]=e)})));continue}if(!(a instanceof Response))continue;n[i]=a}return t?Promise.all(r).then(()=>n):n},i=typeof t==`object`?{development:!qv,reusePort:!0,...e.config.serve||{},...t||{},routes:rx(rx(r(e.router.response),nx(e)),e.config.serve?.routes),websocket:{...e.config.websocket||{},...Yb||{}},fetch:e.fetch}:{development:!qv,reusePort:!0,...e.config.serve||{},routes:rx(rx(r(e.router.response),nx(e)),e.config.serve?.routes),websocket:{...e.config.websocket||{},...Yb||{}},port:t,fetch:e.fetch};if(e.server=Bun.serve(i),e.event.start)for(let t=0;t<e.event.start.length;t++)e.event.start[t].fn(e);n&&n(e.server),process.on(`beforeExit`,()=>{if(e.server&&(e.server.stop?.(),e.server=null,e.event.stop))for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)}),e.promisedModules.then(async()=>{e.server?.reload({...i,fetch:e.fetch,routes:rx(rx(await r(e.router.response,{withAsync:!0}),nx(e)),e.config.serve?.routes)}),Bun?.gc(!1)})}},async stop(e,t){if(!e.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(e.server&&(e.server.stop(t),e.server=null,e.event.stop?.length))for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)},ws(e,t,n){let{parse:r,body:i,response:a,...o}=n,s=fb(i,{modules:e.definitions.typebox,models:e.definitions.type,normalize:e.config.normalize}),c=fb(a,{modules:e.definitions.typebox,models:e.definitions.type,normalize:e.config.normalize});e.route(`WS`,t,async t=>{let i=e.getServer(),{set:a,path:o,qi:l,headers:u,query:d,params:f}=t;if(t.validator=c,n.upgrade)if(typeof n.upgrade==`function`){let e=n.upgrade(t);e instanceof Promise&&await e}else n.upgrade&&Object.assign(a.headers,n.upgrade);if(a.cookie&&X(a.cookie)){let e=Ly(a.cookie);e&&(a.headers[`set-cookie`]=e)}a.headers[`set-cookie`]&&Array.isArray(a.headers[`set-cookie`])&&(a.headers=Ry(new Headers(a.headers),a.headers[`set-cookie`]));let p=Qb(c),m=Zb(r),h;if(typeof n.beforeHandle==`function`){let e=n.beforeHandle(t);e instanceof Promise&&await e}let g=[...n.error?Array.isArray(n.error)?n.error:[n.error]:[],...(e.event.error??[]).map(e=>typeof e==`function`?e:e.fn)].filter(e=>e),_=g.length?async(e,n)=>{for(let r of g){let i=r(Object.assign(t,{error:n}));if(i instanceof Promise&&(i=await i),await p(e,i),i)break}}:()=>{};if(!i?.upgrade(t.request,{headers:X(a.headers)?a.headers:void 0,data:{...t,get id(){return h||(h=Rv())},validator:c,ping(e){n.ping?.(e)},pong(e){n.pong?.(e)},open:async e=>{try{await p(e,n.open?.(new Xb(e,t)))}catch(t){_(e,t)}},message:async(e,r)=>{let i=await m(e,r);if(s?.Check(i)===!1)return void e.send(new Z(`message`,s,i).message);try{await p(e,n.message?.(new Xb(e,t,i),i))}catch(t){_(e,t)}},drain:async e=>{try{await p(e,n.drain?.(new Xb(e,t)))}catch(t){_(e,t)}},close:async(e,r,i)=>{try{await p(e,n.close?.(new Xb(e,t),r,i))}catch(t){_(e,t)}}}}))return a.status=400,`Expected a websocket connection`},{...o,websocket:n})}};var ax=K_?Bun.env:typeof process<`u`&&process?.env?process.env:{};var ox=(e,t)=>{for(let[n,r]of Object.entries(e.schema.properties))t[n]??=r.default},sx=e=>{let{mapResponse:t,mapEarlyResponse:n}=e[`~adapter`].handler;return async r=>{let i=r.url,a=i.indexOf(`/`,11),o=i.indexOf(`?`,a+1),s=o===-1?i.substring(a):i.substring(a,o),c={cookie:{},status:200,headers:{}},l=Object.assign({},e.singleton.decorator,{set:c,store:e.singleton.store,request:r,path:s,qi:o,error:Yv,status:Yv,redirect:Pv});try{if(e.event.request)for(let t=0;t<e.event.request.length;t++){let r=e.event.request[t].fn,i=r(l);if(i instanceof Promise&&(i=await i),i=n(i,c),i)return l.response=i}let a=r.method===`GET`&&r.headers.get(`upgrade`)?.toLowerCase()===`websocket`?`WS`:r.method,u=e.router.dynamic.find(r.method,s)??e.router.dynamic.find(a,s)??e.router.dynamic.find(`ALL`,s);if(!u)throw new Qv;let{handle:d,hooks:f,validator:p,content:m,route:h}=u.store,g;if(r.method!==`GET`&&r.method!==`HEAD`)if(m)switch(m){case`application/json`:g=await r.json();break;case`text/plain`:g=await r.text();break;case`application/x-www-form-urlencoded`:g=$y(await r.text());break;case`application/octet-stream`:g=await r.arrayBuffer();break;case`multipart/form-data`:g={};let e=await r.formData();for(let t of e.keys()){if(g[t])continue;let n=e.getAll(t);n.length===1?g[t]=n[0]:g[t]=n}break}else{let e=r.headers.get(`content-type`);if(e){let t=e.indexOf(`;`);if(t!==-1&&(e=e.slice(0,t)),l.contentType=e,f.parse)for(let t=0;t<f.parse.length;t++){let n=f.parse[t].fn,r=n(l,e);if(r instanceof Promise&&(r=await r),r){g=r;break}}if(delete l.contentType,g===void 0)switch(e){case`application/json`:g=await r.json();break;case`text/plain`:g=await r.text();break;case`application/x-www-form-urlencoded`:g=$y(await r.text());break;case`application/octet-stream`:g=await r.arrayBuffer();break;case`multipart/form-data`:g={};let e=await r.formData();for(let t of e.keys()){if(g[t])continue;let n=e.getAll(t);n.length===1?g[t]=n[0]:g[t]=n}break}}}l.route=h,l.body=g,l.params=u?.params||void 0,l.query=o===-1?{}:$y(i.substring(o+1)),l.headers={};for(let[e,t]of r.headers.entries())l.headers[e]=t;let _=Object.assign({},e.config?.cookie,p?.cookie?.config),ee=r.headers.get(`cookie`);l.cookie=await Iy(l.set,ee,_?{secrets:_.secrets!==void 0?typeof _.secrets==`string`?_.secrets:_.secrets.join(`,`):void 0,sign:_.sign===!0?!0:_.sign!==void 0?typeof _.sign==`string`?_.sign:_.sign.join(`,`):void 0}:void 0);let v=p?.createHeaders?.();v&&ox(v,l.headers);let y=p?.createParams?.();y&&ox(y,l.params);let te=p?.createQuery?.();if(te&&ox(te,l.query),f.transform)for(let e=0;e<f.transform.length;e++){let t=f.transform[e],r=t.fn(l);if(r instanceof Promise&&(r=await r),r instanceof Jv){let e=n(r,l.set);if(e)return l.response=e}t.subType===`derive`&&Object.assign(l,r)}if(p){if(v){let e=structuredClone(l.headers);for(let[t,n]of r.headers)e[t]=n;if(p.headers.Check(e)===!1)throw new Z(`header`,p.headers,e)}else p.headers?.Decode&&(l.headers=p.headers.Decode(l.headers));if(y?.Check(l.params)===!1)throw new Z(`params`,p.params,l.params);if(p.params?.Decode&&(l.params=p.params.Decode(l.params)),te?.Check(l.query)===!1)throw new Z(`query`,p.query,l.query);if(p.query?.Decode&&(l.query=p.query.Decode(l.query)),p.createCookie?.()){let e={};for(let[t,n]of Object.entries(l.cookie))e[t]=n.value;if(p.cookie.Check(e)===!1)throw new Z(`cookie`,p.cookie,e);p.cookie?.Decode&&(e=p.cookie.Decode(e))}if(p.createBody?.()?.Check(g)===!1)throw new Z(`body`,p.body,g);p.body?.Decode&&(l.body=p.body.Decode(g))}if(f.beforeHandle)for(let e=0;e<f.beforeHandle.length;e++){let t=f.beforeHandle[e],r=t.fn(l);if(r instanceof Promise&&(r=await r),r instanceof Jv){let e=n(r,l.set);if(e)return l.response=e}if(t.subType===`resolve`){Object.assign(l,r);continue}if(r!==void 0){if(l.response=r,f.afterHandle)for(let e=0;e<f.afterHandle.length;e++){let t=f.afterHandle[e].fn(l);t instanceof Promise&&(t=await t),t&&(r=t)}let e=n(r,l.set);if(e)return l.response=e}}let b=typeof d==`function`?d(l):d;if(b instanceof Promise&&(b=await b),f.afterHandle)if(f.afterHandle.length){l.response=b;for(let e=0;e<f.afterHandle.length;e++){let t=f.afterHandle[e].fn(l);t instanceof Promise&&(t=await t);let r=n(t,l.set);if(r!==void 0){let e=p?.response?.[r.status];if(e?.Check(r)===!1)throw new Z(`response`,e,r);return e?.Decode&&(b=e.Decode(b)),l.response=r}}}else{let e=b instanceof Jv?b.code:c.status?typeof c.status==`string`?yv[c.status]:c.status:200,t=p?.createResponse?.()?.[e];if(t?.Check(b)===!1)throw new Z(`response`,t,b);t?.Decode&&(b=t.Decode(b))}if(l.set.cookie&&_?.sign){let e=_.secrets?typeof _.secrets==`string`?_.secrets:_.secrets[0]:void 0;if(_.sign===!0){if(e)for(let[t,n]of Object.entries(l.set.cookie))l.set.cookie[t].value=await Cv(n.value,e)}else{let t=p?.cookie?.schema?.properties;if(e)for(let n of _.sign)n in t&&l.set.cookie[n]?.value&&(l.set.cookie[n].value=await Cv(l.set.cookie[n].value,e))}}return t(l.response=b,l.set)}catch(t){let n=t instanceof Sp&&t.error?t.error:t;return e.handleError(l,n)}finally{if(e.event.afterResponse)for(let t of e.event.afterResponse)await t.fn(l)}}},cx=e=>{let{mapResponse:t}=e[`~adapter`].handler;return async(n,r)=>{let i=Object.assign(n,{error:r,code:r.code});if(i.set=n.set,e.event.error)for(let r=0;r<e.event.error.length;r++){let a=e.event.error[r].fn(i);if(a instanceof Promise&&(a=await a),a!=null)return n.response=t(a,n.set)}return new Response(typeof r.cause==`string`?r.cause:r.message,{headers:n.set.headers,status:r.status??500})}};var lx;lx=Symbol.dispose;var ux=class e{constructor(e={}){this.server=null;this.dependencies={};this[`~Prefix`]=``;this[`~Singleton`]=null;this[`~Definitions`]=null;this[`~Metadata`]=null;this[`~Ephemeral`]=null;this[`~Volatile`]=null;this[`~Routes`]=null;this.singleton={decorator:{},store:{},derive:{},resolve:{}};this.definitions={typebox:Q.Module({}),type:{},error:{}};this.extender={macros:[],higherOrderFunctions:[]};this.validator={global:null,scoped:null,local:null,getCandidate(){return!this.global&&!this.scoped&&!this.local?{body:void 0,headers:void 0,params:void 0,query:void 0,cookie:void 0,response:void 0}:cv(cv(this.global,this.scoped),this.local)}};this.standaloneValidator={global:null,scoped:null,local:null};this.event={};this.router={"~http":void 0,get http(){return this[`~http`]||(this[`~http`]=new __({lazy:!0})),this[`~http`]},"~dynamic":void 0,get dynamic(){return this[`~dynamic`]||(this[`~dynamic`]=new __),this[`~dynamic`]},static:{},response:{},history:[]};this.routeTree={};this.inference={body:!1,cookie:!1,headers:!1,query:!1,set:!1,server:!1,path:!1,route:!1,url:!1};this[`~parser`]={};this.handle=async e=>this.fetch(e);this.fetch=e=>(this.fetch=this.config.aot?Ib(this):sx(this))(e);this.handleError=async(e,t)=>(this.handleError=this.config.aot?Lb(this):cx(this))(e,t);this.listen=(e,t)=>(this[`~adapter`].listen(this)(e,t),this.promisedModules.size&&jy(5e3),this.promisedModules.then(()=>{jy(1e3)}),this);this.stop=async e=>(await this[`~adapter`].stop(this,e),this);this[lx]=()=>{this.server&&this.stop()};e.tags&&(e.detail?e.detail.tags=e.tags:e.detail={tags:e.tags}),this.config={prefix:``,aot:ax.ELYSIA_AOT!==`false`,nativeStaticResponse:!0,systemRouter:!0,encodeSchema:!0,normalize:!0,...e,cookie:{path:`/`,...e?.cookie},experimental:e?.experimental??{},seed:e?.seed===void 0?``:e?.seed},this[`~adapter`]=e.adapter??(typeof Bun<`u`?ix:Zy),e?.analytic&&(e?.name||e?.seed!==void 0)&&(this.telemetry={stack:new Error().stack})}get store(){return this.singleton.store}get decorator(){return this.singleton.decorator}get routes(){return this.router.history}getGlobalRoutes(){return this.router.history}getGlobalDefinitions(){return this.definitions}getServer(){return this.server}getParent(){return null}get promisedModules(){return this._promisedModules||(this._promisedModules=new kv(console.error,()=>{})),this._promisedModules}env(e,t=ax){if(fb(e,{modules:this.definitions.typebox,dynamic:!0,additionalProperties:!0,coerce:!0,sanitize:()=>this.config.sanitize}).Check(t)===!1){let n=new Z(`env`,e,t);throw new Error(n.all.map(e=>e.summary).join(`
`))}return this}wrap(e){return this.extender.higherOrderFunctions.push({checksum:pv(JSON.stringify({name:this.config.name,seed:this.config.seed,content:e.toString()})),fn:e}),this}applyMacro(e){if(this.extender.macros.length){let t=Ev({globalHook:this.event,localHook:e}),n={events:{global:this.event,local:e},get onParse(){return t(`parse`)},get onTransform(){return t(`transform`)},get onBeforeHandle(){return t(`beforeHandle`)},get onAfterHandle(){return t(`afterHandle`)},get mapResponse(){return t(`mapResponse`)},get onAfterResponse(){return t(`afterResponse`)},get onError(){return t(`error`)}};for(let r of this.extender.macros)Tv(r.fn(n),e,t)}}get models(){let e={};for(let t of Object.keys(this.definitions.type))e[t]=fb(this.definitions.typebox.Import(t));return e.modules=this.definitions.typebox,e}add(e,t,n,r,i,a){let o=i?.skipPrefix??!1,s=i?.allowMeta??!1;if(r??={},a===void 0&&(a=[],this.standaloneValidator.local&&(a=a.concat(this.standaloneValidator.local)),this.standaloneValidator.scoped&&(a=a.concat(this.standaloneValidator.scoped)),this.standaloneValidator.global&&(a=a.concat(this.standaloneValidator.global))),t!==``&&t.charCodeAt(0)!==47&&(t=`/`+t),this.config.prefix&&!o&&(t=this.config.prefix+t),r?.type)switch(r.type){case`text`:r.type=`text/plain`;break;case`json`:r.type=`application/json`;break;case`formdata`:r.type=`multipart/form-data`;break;case`urlencoded`:r.type=`application/x-www-form-urlencoded`;break;case`arrayBuffer`:r.type=`application/octet-stream`;break;default:break}let c=this.validator.getCandidate(),l={body:r?.body??c?.body,headers:r?.headers??c?.headers,params:r?.params??c?.params,query:r?.query??c?.query,cookie:r?.cookie??c?.cookie,response:r?.response??c?.response},u=this.config.precompile===!0||typeof this.config.precompile==`object`&&this.config.precompile.compose===!0,d=()=>{let e=this.definitions.type,t=!this.config.aot,n=this.config.normalize,r=this.definitions.typebox,i=()=>this.config.sanitize,o=()=>{if(l.cookie||a.find(e=>e.cookie))return bb({modules:r,validator:l.cookie,defaultConfig:this.config.cookie,config:l.cookie?.config??{},dynamic:t,models:e,validators:a.map(e=>e.cookie),sanitize:i})};return u?{body:fb(l.body,{modules:r,dynamic:t,models:e,normalize:n,additionalCoerce:yb(),validators:a.map(e=>e.body),sanitize:i}),headers:fb(l.headers,{modules:r,dynamic:t,models:e,additionalProperties:!0,coerce:!0,additionalCoerce:_b(),validators:a.map(e=>e.headers),sanitize:i}),params:fb(l.params,{modules:r,dynamic:t,models:e,coerce:!0,additionalCoerce:_b(),validators:a.map(e=>e.params),sanitize:i}),query:fb(l.query,{modules:r,dynamic:t,models:e,normalize:n,coerce:!0,additionalCoerce:_b(),validators:a.map(e=>e.query),sanitize:i}),cookie:o(),response:hb(l.response,{modules:r,dynamic:t,models:e,normalize:n,validators:a.map(e=>e.response),sanitize:i})}:{createBody(){return this.body?this.body:this.body=fb(l.body,{modules:r,dynamic:t,models:e,normalize:n,additionalCoerce:yb(),validators:a.map(e=>e.body),sanitize:i})},createHeaders(){return this.headers?this.headers:this.headers=fb(l.headers,{modules:r,dynamic:t,models:e,additionalProperties:!n,coerce:!0,additionalCoerce:_b(),validators:a.map(e=>e.headers),sanitize:i})},createParams(){return this.params?this.params:this.params=fb(l.params,{modules:r,dynamic:t,models:e,coerce:!0,additionalCoerce:_b(),validators:a.map(e=>e.params),sanitize:i})},createQuery(){return this.query?this.query:this.query=fb(l.query,{modules:r,dynamic:t,models:e,coerce:!0,additionalCoerce:_b(),validators:a.map(e=>e.query),sanitize:i})},createCookie(){return this.cookie?this.cookie:this.cookie=o()},createResponse(){return this.response?this.response:this.response=hb(l.response,{modules:r,dynamic:t,models:e,normalize:n,validators:a.map(e=>e.response),sanitize:i})}}};(c.body||c.cookie||c.headers||c.params||c.query||c.response)&&(r=lv(r,c)),r.tags&&(r.detail?r.detail.tags=r.tags:r.detail={tags:r.tags}),X(this.config.detail)&&(r.detail=rv(Object.assign({},this.config.detail),r.detail)),this.applyMacro(r);let f=X(this.event)?lv(this.event,jv(r)):uv(jv(r));if(this.config.aot===!1){let i=d();this.router.dynamic.add(e,t,{validator:i,hooks:f,content:r?.type,handle:n,route:t});let o=Hv(t,{dynamic:!0});if(t!==o&&this.router.dynamic.add(e,o,{validator:i,hooks:f,content:r?.type,handle:n,route:t}),this.config.strictPath===!1){let a=Vv(t);this.router.dynamic.add(e,a,{validator:i,hooks:f,content:r?.type,handle:n,route:t});let o=Hv(a);a!==o&&this.router.dynamic.add(e,a,{validator:i,hooks:f,content:r?.type,handle:n,route:t})}this.router.history.push({method:e,path:t,composed:null,handler:n,compile:void 0,hooks:f,standaloneValidators:a});return}let p=this[`~adapter`].handler,m=typeof n!=`function`?()=>{let e=p.createNativeStaticHandler?.(n,f,this.setHeaders);return e instanceof Promise?e.then(e=>{if(e)return e}):e?.()}:void 0,h=this.config.nativeStaticResponse===!0,g=t=>{!h||!m||(Uv?this.router.response[t]?this.router.response[t][e]=m():this.router.response[t]={[e]:m()}:this.router.response[t]=m())};g(t);let _,ee=()=>_||(_=Nb({app:this,path:t,method:e,hooks:f,validator:d(),handler:typeof n!=`function`&&typeof p.createStaticHandler!=`function`?()=>n:n,allowMeta:s,inference:this.inference})),v;if(`${e}_${t}`in this.routeTree)for(let n=0;n<this.router.history.length;n++){let r=this.router.history[n];if(r.path===t&&r.method===e){v=n;break}}else this.routeTree[`${e}_${t}`]=this.router.history.length;let y=v??this.router.history.length,te=u?ee():e=>(this.router.history[y].composed=ee())(e);v!==void 0?this.router.history[v]=Object.assign({method:e,path:t,composed:te,compile:ee,handler:n,hooks:f},a.length?{standaloneValidators:a}:void 0,r.webSocket?{websocket:r.websocket}:void 0):this.router.history.push(Object.assign({method:e,path:t,composed:te,compile:ee,handler:n,hooks:f},a.length?{standaloneValidators:a}:void 0,r.webSocket?{websocket:r.websocket}:void 0));let b={handler:u?te:void 0,compile(){return this.handler=ee()}},x=this.router.static,ne=t.indexOf(`:`)===-1&&t.indexOf(`*`)===-1;if(e===`WS`){if(ne){t in x?x[t][e]=y:x[t]={[e]:y};return}this.router.http.add(`WS`,t,b),this.config.strictPath||this.router.http.add(`WS`,Vv(t),b);let n=Hv(t,{dynamic:!0});t!==n&&this.router.http.add(`WS`,n,b);return}if(ne)t in x?x[t][e]=y:x[t]={[e]:y},this.config.strictPath||g(Vv(t));else{if(this.router.http.add(e,t,b),!this.config.strictPath){let n=Vv(t);g(n),this.router.http.add(e,n,b)}let n=Hv(t,{dynamic:!0});t!==n&&(this.router.http.add(e,n,b),g(n))}}headers(e){return e?(this.setHeaders||(this.setHeaders={}),this.setHeaders=rv(this.setHeaders,e),this):this}onStart(e){return this.on(`start`,e),this}onRequest(e){return this.on(`request`,e),this}onParse(e,t){return t?this.on(e,`parse`,t):typeof e==`string`?this.on(`parse`,this[`~parser`][e]):this.on(`parse`,e)}parser(e,t){return this[`~parser`][e]=t,this}onTransform(e,t){return t?this.on(e,`transform`,t):this.on(`transform`,e)}resolve(e,t){t||(t=e,e={as:`local`});let n={subType:`resolve`,fn:t};return this.onBeforeHandle(e,n)}mapResolve(e,t){t||(t=e,e={as:`local`});let n={subType:`mapResolve`,fn:t};return this.onBeforeHandle(e,n)}onBeforeHandle(e,t){return t?this.on(e,`beforeHandle`,t):this.on(`beforeHandle`,e)}onAfterHandle(e,t){return t?this.on(e,`afterHandle`,t):this.on(`afterHandle`,e)}mapResponse(e,t){return t?this.on(e,`mapResponse`,t):this.on(`mapResponse`,e)}onAfterResponse(e,t){return t?this.on(e,`afterResponse`,t):this.on(`afterResponse`,e)}trace(e,t){t||(t=e,e={as:`local`}),Array.isArray(t)||(t=[t]);for(let n of t)this.on(e,`trace`,nb(n));return this}error(e,t){switch(typeof e){case`string`:return t.prototype[Kv]=e,this.definitions.error[e]=t,this;case`function`:return this.definitions.error=e(this.definitions.error),this}for(let[t,n]of Object.entries(e))n.prototype[Kv]=t,this.definitions.error[t]=n;return this}onError(e,t){return t?this.on(e,`error`,t):this.on(`error`,e)}onStop(e){return this.on(`stop`,e),this}on(e,t,n){let r;switch(typeof e){case`string`:r=e,n=t;break;case`object`:r=t,!Array.isArray(t)&&typeof t==`object`&&(n=t);break}Array.isArray(n)?n=Av(n):typeof n==`function`?n=[{fn:n}]:n=[n];let i=n;for(let t of i)t.scope=typeof e==`string`?`local`:e?.as??`local`,(r===`resolve`||r===`derive`)&&(t.subType=r);r!==`trace`&&(this.inference=Ny({[r]:i.map(e=>e.fn)},this.inference));for(let e of i){let t=gv(e,`global`,{skipIfHasType:!0});switch(r){case`start`:this.event.start??=[],this.event.start.push(t);break;case`request`:this.event.request??=[],this.event.request.push(t);break;case`parse`:this.event.parse??=[],this.event.parse.push(t);break;case`transform`:this.event.transform??=[],this.event.transform.push(t);break;case`derive`:this.event.transform??=[],this.event.transform.push(Av(t,`derive`));break;case`beforeHandle`:this.event.beforeHandle??=[],this.event.beforeHandle.push(t);break;case`resolve`:this.event.beforeHandle??=[],this.event.beforeHandle.push(Av(t,`resolve`));break;case`afterHandle`:this.event.afterHandle??=[],this.event.afterHandle.push(t);break;case`mapResponse`:this.event.mapResponse??=[],this.event.mapResponse.push(t);break;case`afterResponse`:this.event.afterResponse??=[],this.event.afterResponse.push(t);break;case`trace`:this.event.trace??=[],this.event.trace.push(t);break;case`error`:this.event.error??=[],this.event.error.push(t);break;case`stop`:this.event.stop??=[],this.event.stop.push(t);break}}return this}as(e){return Bv(this.event.parse,e),Bv(this.event.transform,e),Bv(this.event.beforeHandle,e),Bv(this.event.afterHandle,e),Bv(this.event.mapResponse,e),Bv(this.event.afterResponse,e),Bv(this.event.trace,e),Bv(this.event.error,e),e===`scoped`?(this.validator.scoped=cv(this.validator.scoped,this.validator.local),this.validator.local=null,this.standaloneValidator.local!==null&&(this.standaloneValidator.scoped||=[],this.standaloneValidator.scoped.push(...this.standaloneValidator.local),this.standaloneValidator.local=null)):e===`global`&&(this.validator.global=cv(this.validator.global,cv(this.validator.scoped,this.validator.local)),this.validator.scoped=null,this.validator.local=null,this.standaloneValidator.local!==null&&(this.standaloneValidator.scoped||=[],this.standaloneValidator.scoped.push(...this.standaloneValidator.local),this.standaloneValidator.local=null),this.standaloneValidator.scoped!==null&&(this.standaloneValidator.global||=[],this.standaloneValidator.global.push(...this.standaloneValidator.scoped),this.standaloneValidator.scoped=null)),this}group(t,n,r){let i=new e({...this.config,prefix:``});i.singleton={...this.singleton},i.definitions={...this.definitions},i.getServer=()=>this.getServer(),i.inference=Nv(this.inference),i.extender={...this.extender},i[`~parser`]=this[`~parser`],i.standaloneValidator={local:[...this.standaloneValidator.local??[]],scoped:[...this.standaloneValidator.scoped??[]],global:[...this.standaloneValidator.global??[]]};let a=typeof n==`object`,o=(a?r:n)(i);return this.singleton=rv(this.singleton,i.singleton),this.definitions=rv(this.definitions,i.definitions),o.event.request?.length&&(this.event.request=[...this.event.request||[],...o.event.request||[]]),o.event.mapResponse?.length&&(this.event.mapResponse=[...this.event.mapResponse||[],...o.event.mapResponse||[]]),this.model(o.definitions.type),Object.values(i.router.history).forEach(({method:e,path:r,handler:i,hooks:s,standaloneValidators:c})=>{if(r=(a?``:this.config.prefix)+t+r,a){let t=n,a=s;this.add(e,r,i,lv(t,{...a||{},error:a.error?Array.isArray(a.error)?[...a.error??[],...o.event.error??[]]:[a.error,...o.event.error??[]]:o.event.error}),void 0,c)}else this.add(e,r,i,lv(s,{error:o.event.error}),{skipPrefix:!0},c)}),this}guard(t,n){if(!n){if(typeof t==`object`){this.applyMacro(t),t.detail&&(this.config.detail?this.config.detail=rv(Object.assign({},this.config.detail),t.detail):this.config.detail=t.detail),t.tags&&(this.config.detail?this.config.detail.tags=t.tags:this.config.detail={tags:t.tags});let e=t.as??`local`;if(t.schema===`standalone`){this.standaloneValidator[e]||(this.standaloneValidator[e]=[]);let n=t?.response||typeof t?.response==`string`||t?.response&&M in t.response?{200:t.response}:t?.response;this.standaloneValidator[e].push({body:t.body,headers:t.headers,params:t.params,query:t.query,response:n,cookie:t.cookie})}else this.validator[e]={body:t.body??this.validator[e]?.body,headers:t.headers??this.validator[e]?.headers,params:t.params??this.validator[e]?.params,query:t.query??this.validator[e]?.query,response:t.response??this.validator[e]?.response,cookie:t.cookie??this.validator[e]?.cookie};return t.parse&&this.on({as:e},`parse`,t.parse),t.transform&&this.on({as:e},`transform`,t.transform),t.derive&&this.on({as:e},`derive`,t.derive),t.beforeHandle&&this.on({as:e},`beforeHandle`,t.beforeHandle),t.resolve&&this.on({as:e},`resolve`,t.resolve),t.afterHandle&&this.on({as:e},`afterHandle`,t.afterHandle),t.mapResponse&&this.on({as:e},`mapResponse`,t.mapResponse),t.afterResponse&&this.on({as:e},`afterResponse`,t.afterResponse),t.error&&this.on({as:e},`error`,t.error),this}return this.guard({},t)}let r=new e({...this.config,prefix:``});r.singleton={...this.singleton},r.definitions={...this.definitions},r.inference=Nv(this.inference),r.extender={...this.extender};let i=n(r);return this.singleton=rv(this.singleton,r.singleton),this.definitions=rv(this.definitions,r.definitions),i.getServer=()=>this.server,i.event.request?.length&&(this.event.request=[...this.event.request||[],...i.event.request||[]]),i.event.mapResponse?.length&&(this.event.mapResponse=[...this.event.mapResponse||[],...i.event.mapResponse||[]]),this.model(i.definitions.type),Object.values(r.router.history).forEach(({method:e,path:n,handler:r,hooks:a})=>{this.add(e,n,r,lv(t,{...a||{},error:a.error?Array.isArray(a.error)?[...a.error??[],...i.event.error??[]]:[a.error,...i.event.error??[]]:i.event.error}))}),this}use(t){if(Array.isArray(t)){let e=this;for(let n of t)e=e.use(n);return e}return t instanceof Promise?(this.promisedModules.add(t.then(t=>{if(typeof t==`function`)return t(this);if(t instanceof e)return this._use(t).compile();if(t.constructor.name===`Elysia`)return this._use(t).compile();if(typeof t.default==`function`)return t.default(this);if(t.default instanceof e)return this._use(t.default);if(t.constructor.name===`Elysia`)return this._use(t.default);if(t.constructor.name===`_Elysia`)return this._use(t.default);try{return this._use(t.default)}catch(e){throw console.error(`Invalid plugin type. Expected Elysia instance, function, or module with "default" as Elysia instance or function that returns Elysia instance.`),e}}).then(e=>(e&&typeof e.compile==`function`&&e.compile(),e))),this):this._use(t)}propagatePromiseModules(e){if(e.promisedModules.size<=0)return this;for(let t of e.promisedModules.promises)this.promisedModules.add(t.then(e=>{if(!e)return;let t=this._use(e);return t instanceof Promise?t.then(t=>{t?t.compile():e.compile()}):e.compile()}));return this}_use(t){if(typeof t==`function`){let n=t(this);return n instanceof Promise?(this.promisedModules.add(n.then(t=>{if(t instanceof e){t.getServer=()=>this.getServer(),t.getGlobalRoutes=()=>this.getGlobalRoutes(),t.getGlobalDefinitions=()=>this.getGlobalDefinitions(),t.model(this.definitions.type),t.error(this.definitions.error);for(let{method:e,path:n,handler:r,hooks:i,standaloneValidators:a}of Object.values(t.router.history))this.add(e,n,r,X(t.event.error)?lv(i,{error:t.event.error}):i,void 0,a);return t===this?void 0:(this.propagatePromiseModules(t),t)}return typeof t==`function`?t(this):typeof t.default==`function`?t.default(this):this._use(t)}).then(e=>(e&&typeof e.compile==`function`&&e.compile(),e))),this):n}this.propagatePromiseModules(t);let n=t.config.name,r=t.config.seed;if(t.getParent=()=>this,t.getServer=()=>this.getServer(),t.getGlobalRoutes=()=>this.getGlobalRoutes(),t.getGlobalDefinitions=()=>this.getGlobalDefinitions(),t.standaloneValidator?.scoped&&(this.standaloneValidator.local?this.standaloneValidator.local=this.standaloneValidator.local.concat(t.standaloneValidator.scoped):this.standaloneValidator.local=t.standaloneValidator.scoped),t.standaloneValidator?.global&&(this.standaloneValidator.global?this.standaloneValidator.global=this.standaloneValidator.global.concat(t.standaloneValidator.global):this.standaloneValidator.global=t.standaloneValidator.global),X(t[`~parser`])&&(this[`~parser`]={...t[`~parser`],...this[`~parser`]}),t.setHeaders&&this.headers(t.setHeaders),n){n in this.dependencies||(this.dependencies[n]=[]);let e=r!==void 0?pv(n+JSON.stringify(r)):0;this.dependencies[n].some(({checksum:t})=>e===t)||(this.extender.macros=this.extender.macros.concat(t.extender.macros),this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(t.extender.higherOrderFunctions))}else t.extender.macros.length&&(this.extender.macros=this.extender.macros.concat(t.extender.macros)),t.extender.higherOrderFunctions.length&&(this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(t.extender.higherOrderFunctions));if(zv(this.extender.macros),t.extender.higherOrderFunctions.length){zv(this.extender.higherOrderFunctions);let e=[];for(let t=0;t<this.extender.higherOrderFunctions.length;t++){let n=this.extender.higherOrderFunctions[t];n.checksum&&(e.includes(n.checksum)&&(this.extender.higherOrderFunctions.splice(t,1),t--),e.push(n.checksum))}e.length=0}this.inference=My(this.inference,t.inference),X(t.singleton.decorator)&&this.decorate(t.singleton.decorator),X(t.singleton.store)&&this.state(t.singleton.store),X(t.definitions.type)&&this.model(t.definitions.type),X(t.definitions.error)&&this.error(t.definitions.error),X(t.definitions.error)&&(t.extender.macros=this.extender.macros.concat(t.extender.macros));for(let{method:e,path:n,handler:r,hooks:i,standaloneValidators:a}of Object.values(t.router.history))this.add(e,n,r,X(t.event.error)?lv(i,{error:t.event.error}):i,void 0,a);if(n){n in this.dependencies||(this.dependencies[n]=[]);let e=r!==void 0?pv(n+JSON.stringify(r)):0;if(this.dependencies[n].some(({checksum:t})=>e===t))return this;this.dependencies[n].push(this.config?.analytic?{name:t.config.name,seed:t.config.seed,checksum:e,dependencies:t.dependencies,stack:t.telemetry?.stack,routes:t.router.history,decorators:t.singleton,store:t.singleton.store,error:t.definitions.error,derive:t.event.transform?.filter(e=>e?.subType===`derive`).map(e=>({fn:e.toString(),stack:new Error().stack??``})),resolve:t.event.transform?.filter(e=>e?.subType===`resolve`).map(e=>({fn:e.toString(),stack:new Error().stack??``}))}:{name:t.config.name,seed:t.config.seed,checksum:e,dependencies:t.dependencies}),X(t.event)&&(this.event=hv(this.event,vv(t.event),e))}else X(t.event)&&(this.event=hv(this.event,vv(t.event)));return t.validator.global&&(this.validator.global=lv(this.validator.global,{...t.validator.global})),t.validator.scoped&&(this.validator.local=lv(this.validator.local,{...t.validator.scoped})),this}macro(e){if(typeof e==`function`){let t={checksum:pv(JSON.stringify({name:this.config.name,seed:this.config.seed,content:e.toString()})),fn:e};this.extender.macros.push(t)}else if(typeof e==`object`){for(let t of Object.keys(e))if(typeof e[t]==`object`){let n={...e[t]};e[t]=e=>{if(e===!0)return n}}let t={checksum:pv(JSON.stringify({name:this.config.name,seed:this.config.seed,content:Object.entries(e).map(([e,t])=>`${e}+${t}`).join(`,`)})),fn:()=>e};this.extender.macros.push(t)}return this}mount(t,n,r){if(t instanceof e||typeof t==`function`||t.length===0||t===`/`){let i=typeof t==`function`?t:t instanceof e?t.compile().fetch:n instanceof e?n.compile().fetch:typeof n==`function`?n:(()=>{throw new Error(`Invalid handler`)})(),a=({request:e,path:t})=>i(new Request(ev(e.url,t),{method:e.method,headers:e.headers,signal:e.signal,credentials:e.credentials,referrerPolicy:e.referrerPolicy,duplex:e.duplex,redirect:e.redirect,mode:e.mode,keepalive:e.keepalive,integrity:e.integrity,body:e.body}));return this.route(`ALL`,`/*`,a,{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this}let i=n instanceof e?n.compile().fetch:typeof n==`function`?n:(()=>{throw new Error(`Invalid handler`)})(),a=t.length-(t.endsWith(`*`)?1:0),o=({request:e,path:t})=>i(new Request(ev(e.url,t.slice(a)||`/`),{method:e.method,headers:e.headers,signal:e.signal,credentials:e.credentials,referrerPolicy:e.referrerPolicy,duplex:e.duplex,redirect:e.redirect,mode:e.mode,keepalive:e.keepalive,integrity:e.integrity,body:e.body}));return this.route(`ALL`,t,o,{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this.route(`ALL`,t+(t.endsWith(`/`)?`*`:`/*`),o,{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this}get(e,t,n){return this.add(`GET`,e,t,n),this}post(e,t,n){return this.add(`POST`,e,t,n),this}put(e,t,n){return this.add(`PUT`,e,t,n),this}patch(e,t,n){return this.add(`PATCH`,e,t,n),this}delete(e,t,n){return this.add(`DELETE`,e,t,n),this}options(e,t,n){return this.add(`OPTIONS`,e,t,n),this}all(e,t,n){return this.add(`ALL`,e,t,n),this}head(e,t,n){return this.add(`HEAD`,e,t,n),this}connect(e,t,n){return this.add(`CONNECT`,e,t,n),this}route(e,t,n,r){return this.add(e.toUpperCase(),t,n,r,r?.config),this}ws(e,t){return this[`~adapter`].ws?this[`~adapter`].ws(this,e,t):console.warn(`Current adapter doesn't support WebSocket`),this}state(e,t,n){t===void 0?(n=e,e={as:`append`},t=``):n===void 0&&(typeof e==`string`?(n=t,t=e,e={as:`append`}):typeof e==`object`&&(n=t,t=``));let{as:r}=e;if(typeof t!=`string`)return this;switch(typeof n){case`object`:return!n||!X(n)?this:t?(t in this.singleton.store?this.singleton.store[t]=rv(this.singleton.store[t],n,{override:r===`override`}):this.singleton.store[t]=n,this):n===null?this:(this.singleton.store=rv(this.singleton.store,n,{override:r===`override`}),this);case`function`:return t?(r===`override`||!(t in this.singleton.store))&&(this.singleton.store[t]=n):this.singleton.store=n(this.singleton.store),this;default:return(r===`override`||!(t in this.singleton.store))&&(this.singleton.store[t]=n),this}}decorate(e,t,n){t===void 0?(n=e,e={as:`append`},t=``):n===void 0&&(typeof e==`string`?(n=t,t=e,e={as:`append`}):typeof e==`object`&&(n=t,t=``));let{as:r}=e;if(typeof t!=`string`)return this;switch(typeof n){case`object`:return t?(t in this.singleton.decorator?this.singleton.decorator[t]=rv(this.singleton.decorator[t],n,{override:r===`override`}):this.singleton.decorator[t]=n,this):n===null?this:(this.singleton.decorator=rv(this.singleton.decorator,n,{override:r===`override`}),this);case`function`:return t?(r===`override`||!(t in this.singleton.decorator))&&(this.singleton.decorator[t]=n):this.singleton.decorator=n(this.singleton.decorator),this;default:return(r===`override`||!(t in this.singleton.decorator))&&(this.singleton.decorator[t]=n),this}}derive(e,t){t||(t=e,e={as:`local`});let n={subType:`derive`,fn:t};return this.onTransform(e,n)}model(e,t){switch(typeof e){case`object`:let n={},r=Object.entries(e);if(!r.length)return this;for(let[e,t]of r)e in this.definitions.type||(n[e]=this.definitions.type[e]=t,n[e].$id??=`#/components/schemas/${e}`);return this.definitions.typebox=Q.Module({...this.definitions.typebox.$defs,...n}),this;case`function`:let i=e(this.definitions.type);return this.definitions.type=i,this.definitions.typebox=Q.Module(i),this;case`string`:if(!t)break;let a={...t,id:t.$id??`#/components/schemas/${e}`};return this.definitions.type[e]=t,this.definitions.typebox=Q.Module({...this.definitions.typebox.$defs,...a}),this}return this.definitions.type[e]=t,this.definitions.typebox=Q.Module({...this.definitions.typebox.$defs,[e]:t}),this}Ref(e){return Q.Ref(e)}mapDerive(e,t){t||(t=e,e={as:`local`});let n={subType:`mapDerive`,fn:t};return this.onTransform(e,n)}affix(e,t,n){if(n===``)return this;let r=[`_`,`-`,` `],i=e=>e[0].toUpperCase()+e.slice(1),a=e===`prefix`?(e,t)=>r.includes(e.at(-1)??``)?e+t:e+i(t):r.includes(n.at(-1)??``)?(e,t)=>t+e:(e,t)=>t+i(e),o=e=>{let t={};switch(e){case`decorator`:for(let e in this.singleton.decorator)t[a(n,e)]=this.singleton.decorator[e];this.singleton.decorator=t;break;case`state`:for(let e in this.singleton.store)t[a(n,e)]=this.singleton.store[e];this.singleton.store=t;break;case`model`:for(let e in this.definitions.type)t[a(n,e)]=this.definitions.type[e];this.definitions.type=t;break;case`error`:for(let e in this.definitions.error)t[a(n,e)]=this.definitions.error[e];this.definitions.error=t;break}},s=Array.isArray(t)?t:[t];for(let e of s.some(e=>e===`all`)?[`decorator`,`state`,`model`,`error`]:s)o(e);return this}prefix(e,t){return this.affix(`prefix`,e,t)}suffix(e,t){return this.affix(`suffix`,e,t)}compile(){return this[`~adapter`].isWebStandard?(this.fetch=this.config.aot?Ib(this):sx(this),typeof this.server?.reload==`function`&&this.server.reload({...this.server||{},fetch:this.fetch}),this):(typeof this.server?.reload==`function`&&this.server.reload(this.server||{}),this._handle=Ib(this),this)}get modules(){return this.promisedModules}},dx=ux;
/**
* @license
*
* MIT License
*
* Copyright (c) 2020 Evgeny Poberezkin
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*/
new dx().get(`/`,`Hi`).get(`/user/:id`,e=>e.params.id).post(`/body`,e=>e.body,{type:`json`}).fetch(new Request(`http://127.0.0.1`));